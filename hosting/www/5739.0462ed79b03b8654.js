"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5739],{7053:(lf,oi,O)=>{O.d(oi,{$:()=>ci});var De=O(655),q=O(4650),ai=O(4074),ui=O(502);let ci=(()=>{class Me{constructor(ne,Ke){this.router=ne,this.alertController=Ke,this.tokens=["admin","9895257528","1245257528"],this.token=""}validarToken(ne,Ke){"admin"===ne?this.router.navigate(["/home"]):(window.localStorage.setItem("myObject",JSON.stringify(Ke)),this.router.navigate(["/tabs/checkin"]))}presentAlert(){return(0,De.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:"El token ingresado no es v\xe1lido",buttons:["OK"]})).present()})}borrarToken(ne){this.tokens.forEach((Ke,li)=>{Ke!==ne||this.tokens.splice(li,1)})}getToken(){return this.token}}return Me.\u0275fac=function(ne){return new(ne||Me)(q.LFG(ai.F0),q.LFG(ui.Br))},Me.\u0275prov=q.Yz7({token:Me,factory:Me.\u0275fac,providedIn:"root"}),Me})()},5739:(lf,oi,O)=>{O.d(oi,{l:()=>Fv});var De=O(4004),q=O(4650),ai=O(7053),ui=O(4986),ci=O(9751),Me=O(8996),Lr=O(9646),ne=O(2122),Ke=O(8675),li=O(4482),hf=O(5403);function hi(){return(0,li.e)((n,e)=>{let t,r=!1;n.subscribe((0,hf.x)(e,s=>{const i=t;t=s,r&&e.next([i,s]),r=!0}))})}var S,di=O(5026),df=O(1884),gu=O(9300),Or=O(2011),ff=O(6895),mf=(O(9169),O(3942)),p=O(5861),Vr=O(9681),pu=O(4859),_t=O(1877),K=O(2090),gf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},je={},fi=fi||{},D=gf||self;function Pr(){}function qr(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function Nn(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var mi="closure_uid_"+(1e9*Math.random()>>>0),yf=0;function vf(n,e,t){return n.call.apply(n.bind,arguments)}function wf(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,r),n.apply(e,s)}}return function(){return n.apply(e,arguments)}}function we(n,e,t){return(we=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?vf:wf).apply(null,arguments)}function Ur(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function me(n,e){function t(){}t.prototype=e.prototype,n.X=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.Wb=function(r,s,i){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[s].apply(r,o)}}function Je(){this.s=this.s,this.o=this.o}Je.prototype.s=!1,Je.prototype.na=function(){!this.s&&(this.s=!0,this.M(),0)&&function pf(n){Object.prototype.hasOwnProperty.call(n,mi)&&n[mi]||(n[mi]=++yf)}(this)},Je.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const yu=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function gi(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function vu(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(qr(r)){const s=n.length||0,i=r.length||0;n.length=s+i;for(let o=0;o<i;o++)n[s+o]=r[o]}else n.push(r)}}function _e(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}_e.prototype.h=function(){this.defaultPrevented=!0};var If=function(){if(!D.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{D.addEventListener("test",Pr,e),D.removeEventListener("test",Pr,e)}catch(t){}return n}();function Br(n){return/^[\s\xa0]*$/.test(n)}var wu=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function pi(n,e){return n<e?-1:n>e?1:0}function Gr(){var n=D.navigator;return n&&(n=n.userAgent)?n:""}function Oe(n){return-1!=Gr().indexOf(n)}function yi(n){return yi[" "](n),n}yi[" "]=Pr;var Kr,n,Ef=Oe("Opera"),Wt=Oe("Trident")||Oe("MSIE"),_u=Oe("Edge"),vi=_u||Wt,Iu=Oe("Gecko")&&!(-1!=Gr().toLowerCase().indexOf("webkit")&&!Oe("Edge"))&&!(Oe("Trident")||Oe("MSIE"))&&!Oe("Edge"),Tf=-1!=Gr().toLowerCase().indexOf("webkit")&&!Oe("Edge");function xu(){var n=D.document;return n?n.documentMode:void 0}e:{var wi="",_i=(n=Gr(),Iu?/rv:([^\);]+)(\)|;)/.exec(n):_u?/Edge\/([\d\.]+)/.exec(n):Wt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):Tf?/WebKit\/(\S+)/.exec(n):Ef?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(_i&&(wi=_i?_i[1]:""),Wt){var Ii=xu();if(null!=Ii&&Ii>parseFloat(wi)){Kr=String(Ii);break e}}Kr=wi}var Sf={};var Cf=D.document&&Wt&&(xu()||parseInt(Kr,10))||void 0;function kn(n,e){if(_e.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(Iu){e:{try{yi(e.nodeName);var s=!0;break e}catch(i){}s=!1}s||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:Df[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&kn.X.h.call(this)}}me(kn,_e);var Df={2:"touch",3:"pen",4:"mouse"};kn.prototype.h=function(){kn.X.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Rn="closure_listenable_"+(1e6*Math.random()|0),Af=0;function Nf(n,e,t,r,s){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.ha=s,this.key=++Af,this.ba=this.ea=!1}function jr(n){n.ba=!0,n.listener=null,n.proxy=null,n.src=null,n.ha=null}function Ei(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function Tu(n){const e={};for(const t in n)e[t]=n[t];return e}const Su="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function bu(n,e){let t,r;for(let s=1;s<arguments.length;s++){for(t in r=arguments[s],r)n[t]=r[t];for(let i=0;i<Su.length;i++)t=Su[i],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function $r(n){this.src=n,this.g={},this.h=0}function Ti(n,e){var t=e.type;if(t in n.g){var i,r=n.g[t],s=yu(r,e);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(jr(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function Si(n,e,t,r){for(var s=0;s<n.length;++s){var i=n[s];if(!i.ba&&i.listener==e&&i.capture==!!t&&i.ha==r)return s}return-1}$r.prototype.add=function(n,e,t,r,s){var i=n.toString();(n=this.g[i])||(n=this.g[i]=[],this.h++);var o=Si(n,e,r,s);return-1<o?(e=n[o],t||(e.ea=!1)):((e=new Nf(e,this.src,i,!!r,s)).ea=t,n.push(e)),e};var bi="closure_lm_"+(1e6*Math.random()|0),Ci={};function Cu(n,e,t,r,s){if(r&&r.once)return Au(n,e,t,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)Cu(n,e[i],t,r,s);return null}return t=ki(t),n&&n[Rn]?n.N(e,t,Nn(r)?!!r.capture:!!r,s):Du(n,e,t,!1,r,s)}function Du(n,e,t,r,s,i){if(!e)throw Error("Invalid event type");var o=Nn(s)?!!s.capture:!!s,a=Ai(n);if(a||(n[bi]=a=new $r(n)),(t=a.add(e,t,r,o,i)).proxy)return t;if(r=function kf(){const e=Rf;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)If||(s=o),void 0===s&&(s=!1),n.addEventListener(e.toString(),r,s);else if(n.attachEvent)n.attachEvent(ku(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function Au(n,e,t,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)Au(n,e[i],t,r,s);return null}return t=ki(t),n&&n[Rn]?n.O(e,t,Nn(r)?!!r.capture:!!r,s):Du(n,e,t,!0,r,s)}function Nu(n,e,t,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)Nu(n,e[i],t,r,s);else r=Nn(r)?!!r.capture:!!r,t=ki(t),n&&n[Rn]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=Si(i=n.g[e],t,r,s))&&(jr(i[t]),Array.prototype.splice.call(i,t,1),0==i.length&&(delete n.g[e],n.h--))):n&&(n=Ai(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Si(e,t,r,s)),(t=-1<n?e[n]:null)&&Di(t))}function Di(n){if("number"!=typeof n&&n&&!n.ba){var e=n.src;if(e&&e[Rn])Ti(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(ku(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=Ai(e))?(Ti(t,n),0==t.h&&(t.src=null,e[bi]=null)):jr(n)}}}function ku(n){return n in Ci?Ci[n]:Ci[n]="on"+n}function Rf(n,e){if(n.ba)n=!0;else{e=new kn(e,this);var t=n.listener,r=n.ha||n.src;n.ea&&Di(n),n=t.call(r,e)}return n}function Ai(n){return(n=n[bi])instanceof $r?n:null}var Ni="__closure_events_fn_"+(1e9*Math.random()>>>0);function ki(n){return"function"==typeof n?n:(n[Ni]||(n[Ni]=function(e){return n.handleEvent(e)}),n[Ni])}function le(){Je.call(this),this.i=new $r(this),this.P=this,this.I=null}function ge(n,e){var t,r=n.I;if(r)for(t=[];r;r=r.I)t.push(r);if(n=n.P,r=e.type||e,"string"==typeof e)e=new _e(e,n);else if(e instanceof _e)e.target=e.target||n;else{var s=e;bu(e=new _e(r,n),s)}if(s=!0,t)for(var i=t.length-1;0<=i;i--){var o=e.g=t[i];s=zr(o,r,!0,e)&&s}if(s=zr(o=e.g=n,r,!0,e)&&s,s=zr(o,r,!1,e)&&s,t)for(i=0;i<t.length;i++)s=zr(o=e.g=t[i],r,!1,e)&&s}function zr(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.ba&&o.capture==t){var a=o.listener,u=o.ha||o.src;o.ea&&Ti(n.i,o),s=!1!==a.call(u,r)&&s}}return s&&!r.defaultPrevented}me(le,Je),le.prototype[Rn]=!0,le.prototype.removeEventListener=function(n,e,t,r){Nu(this,n,e,t,r)},le.prototype.M=function(){if(le.X.M.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)jr(t[r]);delete n.g[e],n.h--}}this.I=null},le.prototype.N=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},le.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var Ri=D.JSON.stringify;function Ff(){var n=Mu;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var Fi,Ru=new class{constructor(n,e){this.i=n,this.j=e,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new Lf,n=>n.reset());class Lf{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Of(n){D.setTimeout(()=>{throw n},0)}function Fu(n,e){Fi||function Vf(){var n=D.Promise.resolve(void 0);Fi=function(){n.then(Pf)}}(),Mi||(Fi(),Mi=!0),Mu.add(n,e)}var Mi=!1,Mu=new class Mf{constructor(){this.h=this.g=null}add(e,t){const r=Ru.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}};function Pf(){for(var n;n=Ff();){try{n.h.call(n.g)}catch(t){Of(t)}var e=Ru;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}Mi=!1}function Qr(n,e){le.call(this),this.h=n||1,this.g=e||D,this.j=we(this.lb,this),this.l=Date.now()}function Li(n){n.ca=!1,n.R&&(n.g.clearTimeout(n.R),n.R=null)}function Oi(n,e,t){if("function"==typeof n)t&&(n=we(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=we(n.handleEvent,n)}return 2147483647<Number(e)?-1:D.setTimeout(n,e||0)}function Lu(n){n.g=Oi(()=>{n.g=null,n.i&&(n.i=!1,Lu(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}me(Qr,le),(S=Qr.prototype).ca=!1,S.R=null,S.lb=function(){if(this.ca){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-n):(this.R&&(this.g.clearTimeout(this.R),this.R=null),ge(this,"tick"),this.ca&&(Li(this),this.start()))}},S.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},S.M=function(){Qr.X.M.call(this),Li(this),delete this.g};class qf extends Je{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Lu(this)}M(){super.M(),this.g&&(D.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Fn(n){Je.call(this),this.h=n,this.g={}}me(Fn,Je);var Ou=[];function Vu(n,e,t,r){Array.isArray(t)||(t&&(Ou[0]=t.toString()),t=Ou);for(var s=0;s<t.length;s++){var i=Cu(e,t[s],r||n.handleEvent,!1,n.h||n);if(!i)break;n.g[i.key]=i}}function Pu(n){Ei(n.g,function(e,t){this.g.hasOwnProperty(t)&&Di(e)},n),n.g={}}function Zr(){this.g=!0}function Yt(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function Kf(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return Ri(t)}catch(a){return e}}(n,t)+(r?" "+r:"")})}Fn.prototype.M=function(){Fn.X.M.call(this),Pu(this)},Fn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Zr.prototype.Aa=function(){this.g=!1},Zr.prototype.info=function(){};var It={},qu=null;function Hr(){return qu=qu||new le}function Uu(n){_e.call(this,It.Pa,n)}function Mn(n){const e=Hr();ge(e,new Uu(e))}function Bu(n,e){_e.call(this,It.STAT_EVENT,n),this.stat=e}function Ie(n){const e=Hr();ge(e,new Bu(e,n))}function Gu(n,e){_e.call(this,It.Qa,n),this.size=e}function Ln(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return D.setTimeout(function(){n()},e)}It.Pa="serverreachability",me(Uu,_e),It.STAT_EVENT="statevent",me(Bu,_e),It.Qa="timingevent",me(Gu,_e);var Wr={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},Ku={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function Vi(){}function $u(){}Vi.prototype.h=null;var Ui,On={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function Pi(){_e.call(this,"d")}function qi(){_e.call(this,"c")}function Yr(){}function Vn(n,e,t,r){this.l=n,this.j=e,this.m=t,this.U=r||1,this.S=new Fn(this),this.O=jf,this.T=new Qr(n=vi?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new zu}function zu(){this.i=null,this.g="",this.h=!1}me(Pi,_e),me(qi,_e),me(Yr,Vi),Yr.prototype.g=function(){return new XMLHttpRequest},Yr.prototype.i=function(){return{}},Ui=new Yr;var jf=45e3,Bi={},Xr={};function Gi(n,e,t){n.K=1,n.v=ns($e(e)),n.s=t,n.P=!0,Qu(n,null)}function Qu(n,e){n.F=Date.now(),Pn(n),n.A=$e(n.v);var t=n.A,r=n.U;Array.isArray(r)||(r=[String(r)]),rc(t.i,"t",r),n.C=0,t=n.l.H,n.h=new zu,n.g=Cc(n.l,t?e:null,!n.s),0<n.N&&(n.L=new qf(we(n.La,n,n.g),n.N)),Vu(n.S,n.g,"readystatechange",n.ib),e=n.H?Tu(n.H):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.da(n.A,n.u,n.s,e)):(n.u="GET",n.g.da(n.A,n.u,null,e)),Mn(),function Uf(n,e,t,r,s,i){n.info(function(){if(n.g)if(i)for(var o="",a=i.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+c+"&":o+(l+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+t+"\n"+o})}(n.j,n.u,n.A,n.m,n.U,n.s)}function Zu(n){return!!n.g&&"GET"==n.u&&2!=n.K&&n.l.Da}function Hu(n,e,t){let s,r=!0;for(;!n.I&&n.C<t.length;){if(s=$f(n,t),s==Xr){4==e&&(n.o=4,Ie(14),r=!1),Yt(n.j,n.m,null,"[Incomplete Response]");break}if(s==Bi){n.o=4,Ie(15),Yt(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}Yt(n.j,n.m,s,null),Ki(n,s)}Zu(n)&&s!=Xr&&s!=Bi&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,Ie(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.$&&(n.$=!0,(e=n.l).g==n&&e.$&&!e.K&&(e.j.info("Great, no buffering proxy detected. Bytes received: "+t.length),Yi(e),e.K=!0,Ie(11))):(Yt(n.j,n.m,t,"[Invalid Chunked Response]"),xt(n),qn(n))}function $f(n,e){var t=n.C,r=e.indexOf("\n",t);return-1==r?Xr:(t=Number(e.substring(t,r)),isNaN(t)?Bi:(r+=1)+t>e.length?Xr:(e=e.substr(r,t),n.C=r+t,e))}function Pn(n){n.V=Date.now()+n.O,Wu(n,n.O)}function Wu(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=Ln(we(n.gb,n),e)}function Jr(n){n.B&&(D.clearTimeout(n.B),n.B=null)}function qn(n){0==n.l.G||n.I||Ec(n.l,n)}function xt(n){Jr(n);var e=n.L;e&&"function"==typeof e.na&&e.na(),n.L=null,Li(n.T),Pu(n.S),n.g&&(e=n.g,n.g=null,e.abort(),e.na())}function Ki(n,e){try{var t=n.l;if(0!=t.G&&(t.g==n||ji(t.h,n)))if(!n.J&&ji(t.h,n)&&3==t.G){try{var r=t.Fa.g.parse(e)}catch(c){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){e:if(!t.u){if(t.g){if(!(t.g.F+3e3<n.F))break e;us(t),os(t)}Wi(t),Ie(18)}}else t.Ba=s[1],0<t.Ba-t.T&&37500>s[2]&&t.L&&0==t.A&&!t.v&&(t.v=Ln(we(t.cb,t),6e3));if(1>=oc(t.h)&&t.ja){try{t.ja()}catch(c){}t.ja=void 0}}else Tt(t,11)}else if((n.J||t.g==n)&&us(t),!Br(e))for(s=t.Fa.g.parse(e),e=0;e<s.length;e++){let c=s[e];if(t.T=c[0],c=c[1],2==t.G)if("c"==c[0]){t.I=c[1],t.ka=c[2];const l=c[3];null!=l&&(t.ma=l,t.j.info("VER="+t.ma));const h=c[4];null!=h&&(t.Ca=h,t.j.info("SVER="+t.Ca));const d=c[5];null!=d&&"number"==typeof d&&0<d&&(t.J=r=1.5*d,t.j.info("backChannelRequestTimeoutMs_="+r)),r=t;const g=n.g;if(g){const v=g.g?g.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(v){var i=r.h;i.g||-1==v.indexOf("spdy")&&-1==v.indexOf("quic")&&-1==v.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&($i(i,i.h),i.h=null))}if(r.D){const x=g.g?g.g.getResponseHeader("X-HTTP-Session-Id"):null;x&&(r.za=x,Q(r.F,r.D,x))}}t.G=3,t.l&&t.l.xa(),t.$&&(t.P=Date.now()-n.F,t.j.info("Handshake RTT: "+t.P+"ms"));var o=n;if((r=t).sa=bc(r,r.H?r.ka:null,r.V),o.J){ac(r.h,o);var a=o,u=r.J;u&&a.setTimeout(u),a.B&&(Jr(a),Pn(a)),r.g=o}else Ic(r);0<t.i.length&&as(t)}else"stop"!=c[0]&&"close"!=c[0]||Tt(t,7);else 3==t.G&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?Tt(t,7):Hi(t):"noop"!=c[0]&&t.l&&t.l.wa(c),t.A=0)}Mn()}catch(c){}}function Yu(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(qr(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function Qf(n){if(n.oa&&"function"==typeof n.oa)return n.oa();if(!n.W||"function"!=typeof n.W){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(qr(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}(n),r=function zf(n){if(n.W&&"function"==typeof n.W)return n.W();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(qr(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),s=r.length,i=0;i<s;i++)e.call(void 0,r[i],t&&t[i],n)}(S=Vn.prototype).setTimeout=function(n){this.O=n},S.ib=function(n){n=n.target;const e=this.L;e&&3==ze(n)?e.l():this.La(n)},S.La=function(n){try{if(n==this.g)e:{const l=ze(this.g);var e=this.g.Ea();if(this.g.aa(),!(3>l)&&(3!=l||vi||this.g&&(this.h.h||this.g.fa()||gc(this.g)))){this.I||4!=l||7==e||Mn(),Jr(this);var t=this.g.aa();this.Y=t;t:if(Zu(this)){var r=gc(this.g);n="";var s=r.length,i=4==ze(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){xt(this),qn(this);var o="";break t}this.h.i=new D.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:i&&e==s-1});r.splice(0,s),this.h.g+=n,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==t,function Bf(n,e,t,r,s,i,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+t+"\n"+i+" "+o})}(this.j,this.u,this.A,this.m,this.U,l,t),this.i){if(this.Z&&!this.J){t:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Br(a)){var c=a;break t}}c=null}if(!(t=c)){this.i=!1,this.o=3,Ie(12),xt(this),qn(this);break e}Yt(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Ki(this,t)}this.P?(Hu(this,l,o),vi&&this.i&&3==l&&(Vu(this.S,this.T,"tick",this.hb),this.T.start())):(Yt(this.j,this.m,o,null),Ki(this,o)),4==l&&xt(this),this.i&&!this.I&&(4==l?Ec(this.l,this):(this.i=!1,Pn(this)))}else 400==t&&0<o.indexOf("Unknown SID")?(this.o=3,Ie(12)):(this.o=0,Ie(13)),xt(this),qn(this)}}}catch(l){}},S.hb=function(){if(this.g){var n=ze(this.g),e=this.g.fa();this.C<e.length&&(Jr(this),Hu(this,n,e),this.i&&4!=n&&Pn(this))}},S.cancel=function(){this.I=!0,xt(this)},S.gb=function(){this.B=null;const n=Date.now();0<=n-this.V?(function Gf(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(Mn(),Ie(17)),xt(this),this.o=2,qn(this)):Wu(this,this.V-n)};var Xu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Et(n,e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Et){this.h=void 0!==e?e:n.h,es(this,n.j),this.s=n.s,this.g=n.g,ts(this,n.m),this.l=n.l,e=n.i;var t=new Gn;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),Ju(this,t),this.o=n.o}else n&&(t=String(n).match(Xu))?(this.h=!!e,es(this,t[1]||"",!0),this.s=Un(t[2]||""),this.g=Un(t[3]||"",!0),ts(this,t[4]),this.l=Un(t[5]||"",!0),Ju(this,t[6]||"",!0),this.o=Un(t[7]||"")):(this.h=!!e,this.i=new Gn(null,this.h))}function $e(n){return new Et(n)}function es(n,e,t){n.j=t?Un(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function ts(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Ju(n,e,t){e instanceof Gn?(n.i=e,function em(n,e){e&&!n.j&&(et(n),n.i=null,n.g.forEach(function(t,r){var s=r.toLowerCase();r!=s&&(tc(this,r),rc(this,s,t))},n)),n.j=e}(n.i,n.h)):(t||(e=Bn(e,Xf)),n.i=new Gn(e,n.h))}function Q(n,e,t){n.i.set(e,t)}function ns(n){return Q(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Un(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Bn(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,Hf),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Hf(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}Et.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Bn(e,ec,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(Bn(e,ec,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(Bn(t,"/"==t.charAt(0)?Yf:Wf,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Bn(t,Jf)),n.join("")};var ec=/[#\/\?@]/g,Wf=/[#\?:]/g,Yf=/[#\?]/g,Xf=/[#\?@]/g,Jf=/#/g;function Gn(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function et(n){n.g||(n.g=new Map,n.h=0,n.i&&function Zf(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),s=null;if(0<=r){var i=n[t].substring(0,r);s=n[t].substring(r+1)}else i=n[t];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function tc(n,e){et(n),e=Xt(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function nc(n,e){return et(n),e=Xt(n,e),n.g.has(e)}function rc(n,e,t){tc(n,e),0<t.length&&(n.i=null,n.g.set(Xt(n,e),gi(t)),n.h+=t.length)}function Xt(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function sc(n){this.l=n||nm,n=D.PerformanceNavigationTiming?0<(n=D.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(D.g&&D.g.Ga&&D.g.Ga()&&D.g.Ga().$b),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(S=Gn.prototype).add=function(n,e){et(this),this.i=null,n=Xt(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},S.forEach=function(n,e){et(this),this.g.forEach(function(t,r){t.forEach(function(s){n.call(e,s,r,this)},this)},this)},S.oa=function(){et(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const s=n[r];for(let i=0;i<s.length;i++)t.push(e[r])}return t},S.W=function(n){et(this);let e=[];if("string"==typeof n)nc(this,n)&&(e=e.concat(this.g.get(Xt(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},S.set=function(n,e){return et(this),this.i=null,nc(this,n=Xt(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},S.get=function(n,e){return n&&0<(n=this.W(n)).length?String(n[0]):e},S.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const i=encodeURIComponent(String(r)),o=this.W(r);for(r=0;r<o.length;r++){var s=i;""!==o[r]&&(s+="="+encodeURIComponent(String(o[r]))),n.push(s)}}return this.i=n.join("&")};var nm=10;function ic(n){return!!n.h||!!n.g&&n.g.size>=n.j}function oc(n){return n.h?1:n.g?n.g.size:0}function ji(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function $i(n,e){n.g?n.g.add(e):n.h=e}function ac(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function uc(n){if(null!=n.h)return n.i.concat(n.h.D);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.D);return e}return gi(n.i)}function zi(){}function rm(){this.g=new zi}function sm(n,e,t){const r=t||"";try{Yu(n,function(s,i){let o=s;Nn(s)&&(o=Ri(s)),e.push(r+i+"="+encodeURIComponent(o))})}catch(s){throw e.push(r+"type="+encodeURIComponent("_badmap")),s}}function rs(n,e,t,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch(i){}}function Kn(n){this.l=n.ac||null,this.j=n.jb||!1}function ss(n,e){le.call(this),this.D=n,this.u=e,this.m=void 0,this.readyState=Qi,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}sc.prototype.cancel=function(){if(this.i=uc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}},zi.prototype.stringify=function(n){return D.JSON.stringify(n,void 0)},zi.prototype.parse=function(n){return D.JSON.parse(n,void 0)},me(Kn,Vi),Kn.prototype.g=function(){return new ss(this.l,this.j)},Kn.prototype.i=function(n){return function(){return n}}({}),me(ss,le);var Qi=0;function cc(n){n.j.read().then(n.Ta.bind(n)).catch(n.ga.bind(n))}function jn(n){n.readyState=4,n.l=null,n.j=null,n.A=null,$n(n)}function $n(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(S=ss.prototype).open=function(n,e){if(this.readyState!=Qi)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,$n(this)},S.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.D||D).fetch(new Request(this.B,e)).then(this.Wa.bind(this),this.ga.bind(this))},S.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,jn(this)),this.readyState=Qi},S.Wa=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,$n(this)),this.g&&(this.readyState=3,$n(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(typeof D.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;cc(this)}else n.text().then(this.Va.bind(this),this.ga.bind(this))},S.Ta=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?jn(this):$n(this),3==this.readyState&&cc(this)}},S.Va=function(n){this.g&&(this.response=this.responseText=n,jn(this))},S.Ua=function(n){this.g&&(this.response=n,jn(this))},S.ga=function(){this.g&&jn(this)},S.setRequestHeader=function(n,e){this.v.append(n,e)},S.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},S.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(ss.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var om=D.JSON.parse;function Y(n){le.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=lc,this.K=this.L=!1}me(Y,le);var lc="",am=/^https?$/i,um=["POST","PUT"];function hc(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,dc(n),is(n)}function dc(n){n.D||(n.D=!0,ge(n,"complete"),ge(n,"error"))}function fc(n){if(n.h&&typeof fi<"u"&&(!n.C[1]||4!=ze(n)||2!=n.aa()))if(n.v&&4==ze(n))Oi(n.Ha,0,n);else if(ge(n,"readystatechange"),4==ze(n)){n.h=!1;try{const a=n.aa();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===a){var s=String(n.H).match(Xu)[1]||null;if(!s&&D.self&&D.self.location){var i=D.self.location.protocol;s=i.substr(0,i.length-1)}r=!am.test(s?s.toLowerCase():"")}t=r}if(t)ge(n,"complete"),ge(n,"success");else{n.m=6;try{var o=2<ze(n)?n.g.statusText:""}catch(u){o=""}n.j=o+" ["+n.aa()+"]",dc(n)}}finally{is(n)}}}function is(n,e){if(n.g){mc(n);const t=n.g,r=n.C[0]?Pr:null;n.g=null,n.C=null,e||ge(n,"ready");try{t.onreadystatechange=r}catch(s){}}}function mc(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(D.clearTimeout(n.A),n.A=null)}function ze(n){return n.g?n.g.readyState:0}function gc(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case lc:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch(e){return null}}function pc(n){let e="";return Ei(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}function Zi(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=pc(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):Q(n,e,t))}function zn(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function yc(n){this.Ca=0,this.i=[],this.j=new Zr,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=zn("failFast",!1,n),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=zn("baseRetryDelayMs",5e3,n),this.bb=zn("retryDelaySeedMs",1e4,n),this.$a=zn("forwardChannelMaxRetries",2,n),this.ta=zn("forwardChannelRequestTimeoutMs",2e4,n),this.ra=n&&n.xmlHttpFactory||void 0,this.Da=n&&n.Zb||!1,this.J=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.I="",this.h=new sc(n&&n.concurrentRequestLimit),this.Fa=new rm,this.O=n&&n.fastHandshake||!1,this.N=n&&n.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=n&&n.Xb||!1,n&&n.Aa&&this.j.Aa(),n&&n.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&n&&n.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function Hi(n){if(vc(n),3==n.G){var e=n.U++,t=$e(n.F);Q(t,"SID",n.I),Q(t,"RID",e),Q(t,"TYPE","terminate"),Qn(n,t),(e=new Vn(n,n.j,e,void 0)).K=2,e.v=ns($e(t)),t=!1,D.navigator&&D.navigator.sendBeacon&&(t=D.navigator.sendBeacon(e.v.toString(),"")),!t&&D.Image&&((new Image).src=e.v,t=!0),t||(e.g=Cc(e.l,null),e.g.da(e.v)),e.F=Date.now(),Pn(e)}Sc(n)}function os(n){n.g&&(Yi(n),n.g.cancel(),n.g=null)}function vc(n){os(n),n.u&&(D.clearTimeout(n.u),n.u=null),us(n),n.h.cancel(),n.m&&("number"==typeof n.m&&D.clearTimeout(n.m),n.m=null)}function as(n){ic(n.h)||n.m||(n.m=!0,Fu(n.Ja,n),n.C=0)}function wc(n,e){var t;t=e?e.m:n.U++;const r=$e(n.F);Q(r,"SID",n.I),Q(r,"RID",t),Q(r,"AID",n.T),Qn(n,r),n.o&&n.s&&Zi(r,n.o,n.s),t=new Vn(n,n.j,t,n.C+1),null===n.o&&(t.H=n.s),e&&(n.i=e.D.concat(n.i)),e=_c(n,t,1e3),t.setTimeout(Math.round(.5*n.ta)+Math.round(.5*n.ta*Math.random())),$i(n.h,t),Gi(t,r,e)}function Qn(n,e){n.ia&&Ei(n.ia,function(t,r){Q(e,r,t)}),n.l&&Yu({},function(t,r){Q(e,r,t)})}function _c(n,e,t){t=Math.min(n.i.length,t);var r=n.l?we(n.l.Ra,n.l,n):null;e:{var s=n.i;let i=-1;for(;;){const o=["count="+t];-1==i?0<t?(i=s[0].h,o.push("ofs="+i)):i=0:o.push("ofs="+i);let a=!0;for(let u=0;u<t;u++){let c=s[u].h;const l=s[u].g;if(c-=i,0>c)i=Math.max(0,s[u].h-100),a=!1;else try{sm(l,o,"req"+c+"_")}catch(h){r&&r(l)}}if(a){r=o.join("&");break e}}}return n=n.i.splice(0,t),e.D=n,r}function Ic(n){n.g||n.u||(n.Z=1,Fu(n.Ia,n),n.A=0)}function Wi(n){return!(n.g||n.u||3<=n.A||(n.Z++,n.u=Ln(we(n.Ia,n),Tc(n,n.A)),n.A++,0))}function Yi(n){null!=n.B&&(D.clearTimeout(n.B),n.B=null)}function xc(n){n.g=new Vn(n,n.j,"rpc",n.Z),null===n.o&&(n.g.H=n.s),n.g.N=0;var e=$e(n.sa);Q(e,"RID","rpc"),Q(e,"SID",n.I),Q(e,"CI",n.L?"0":"1"),Q(e,"AID",n.T),Q(e,"TYPE","xmlhttp"),Qn(n,e),n.o&&n.s&&Zi(e,n.o,n.s),n.J&&n.g.setTimeout(n.J);var t=n.g;n=n.ka,t.K=1,t.v=ns($e(e)),t.s=null,t.P=!0,Qu(t,n)}function us(n){null!=n.v&&(D.clearTimeout(n.v),n.v=null)}function Ec(n,e){var t=null;if(n.g==e){us(n),Yi(n),n.g=null;var r=2}else{if(!ji(n.h,e))return;t=e.D,ac(n.h,e),r=1}if(0!=n.G)if(n.pa=e.Y,e.i)if(1==r){t=e.s?e.s.length:0,e=Date.now()-e.F;var s=n.C;ge(r=Hr(),new Gu(r,t)),as(n)}else Ic(n);else if(3==(s=e.o)||0==s&&0<n.pa||!(1==r&&function lm(n,e){return!(oc(n.h)>=n.h.j-(n.m?1:0)||(n.m?(n.i=e.D.concat(n.i),0):1==n.G||2==n.G||n.C>=(n.Za?0:n.$a)||(n.m=Ln(we(n.Ja,n,e),Tc(n,n.C)),n.C++,0)))}(n,e)||2==r&&Wi(n)))switch(t&&0<t.length&&(e=n.h,e.i=e.i.concat(t)),s){case 1:Tt(n,5);break;case 4:Tt(n,10);break;case 3:Tt(n,6);break;default:Tt(n,2)}}function Tc(n,e){let t=n.Xa+Math.floor(Math.random()*n.bb);return n.l||(t*=2),t*e}function Tt(n,e){if(n.j.info("Error code "+e),2==e){var t=null;n.l&&(t=null);var r=we(n.kb,n);t||(t=new Et("//www.google.com/images/cleardot.gif"),D.location&&"http"==D.location.protocol||es(t,"https"),ns(t)),function im(n,e){const t=new Zr;if(D.Image){const r=new Image;r.onload=Ur(rs,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Ur(rs,t,r,"TestLoadImage: error",!1,e),r.onabort=Ur(rs,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Ur(rs,t,r,"TestLoadImage: timeout",!1,e),D.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else Ie(2);n.G=0,n.l&&n.l.va(e),Sc(n),vc(n)}function Sc(n){if(n.G=0,n.la=[],n.l){const e=uc(n.h);(0!=e.length||0!=n.i.length)&&(vu(n.la,e),vu(n.la,n.i),n.h.i.length=0,gi(n.i),n.i.length=0),n.l.ua()}}function bc(n,e,t){var r=t instanceof Et?$e(t):new Et(t,void 0);if(""!=r.g)e&&(r.g=e+"."+r.g),ts(r,r.m);else{var s=D.location;r=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var i=new Et(null,void 0);r&&es(i,r),e&&(i.g=e),s&&ts(i,s),t&&(i.l=t),r=i}return e=n.za,(t=n.D)&&e&&Q(r,t,e),Q(r,"VER",n.ma),Qn(n,r),r}function Cc(n,e,t){if(e&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Y(t&&n.Da&&!n.ra?new Kn({jb:!0}):n.ra)).Ka(n.H),e}function Dc(){}function cs(){if(Wt&&!(10<=Number(Cf)))throw Error("Environmental error: no available transport.")}function Ae(n,e){le.call(this),this.g=new yc(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(n?n["X-WebChannel-Client-Profile"]=e.ya:n={"X-WebChannel-Client-Profile":e.ya}),this.g.S=n,(n=e&&e.Yb)&&!Br(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Br(e)&&(this.g.D=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new Jt(this)}function Ac(n){Pi.call(this);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function Nc(){qi.call(this),this.status=1}function Jt(n){this.g=n}(S=Y.prototype).Ka=function(n){this.L=n},S.da=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);e=e?e.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Ui.g(),this.C=function ju(n){return n.h||(n.h=n.i())}(this.u?this.u:Ui),this.g.onreadystatechange=we(this.Ha,this);try{this.F=!0,this.g.open(e,String(n),!0),this.F=!1}catch(i){return void hc(this,i)}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)t.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const i of r.keys())t.set(i,r.get(i))}r=Array.from(t.keys()).find(i=>"content-type"==i.toLowerCase()),s=D.FormData&&n instanceof D.FormData,!(0<=yu(um,e))||r||s||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,o]of t)this.g.setRequestHeader(i,o);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{mc(this),0<this.B&&((this.K=function cm(n){return Wt&&function bf(){return function xf(n){var e=Sf;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=n(9)}(function(){let n=0;const e=wu(String(Kr)).split("."),t=wu("9").split("."),r=Math.max(e.length,t.length);for(let o=0;0==n&&o<r;o++){var s=e[o]||"",i=t[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],0==s[0].length&&0==i[0].length)break;n=pi(0==s[1].length?0:parseInt(s[1],10),0==i[1].length?0:parseInt(i[1],10))||pi(0==s[2].length,0==i[2].length)||pi(s[2],i[2]),s=s[3],i=i[3]}while(0==n)}return 0<=n})}()&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=we(this.qa,this)):this.A=Oi(this.qa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(i){hc(this,i)}},S.qa=function(){typeof fi<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ge(this,"timeout"),this.abort(8))},S.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,ge(this,"complete"),ge(this,"abort"),is(this))},S.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),is(this,!0)),Y.X.M.call(this)},S.Ha=function(){this.s||(this.F||this.v||this.l?fc(this):this.fb())},S.fb=function(){fc(this)},S.aa=function(){try{return 2<ze(this)?this.g.status:-1}catch(n){return-1}},S.fa=function(){try{return this.g?this.g.responseText:""}catch(n){return""}},S.Sa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),om(e)}},S.Ea=function(){return this.m},S.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(S=yc.prototype).ma=8,S.G=1,S.Ja=function(n){if(this.m)if(this.m=null,1==this.G){if(!n){this.U=Math.floor(1e5*Math.random()),n=this.U++;const s=new Vn(this,this.j,n,void 0);let i=this.s;if(this.S&&(i?(i=Tu(i),bu(i,this.S)):i=this.S),null!==this.o||this.N||(s.H=i,i=null),this.O)e:{for(var e=0,t=0;t<this.i.length;t++){var r=this.i[t];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.i.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=_c(this,s,e),Q(t=$e(this.F),"RID",n),Q(t,"CVER",22),this.D&&Q(t,"X-HTTP-Session-Id",this.D),Qn(this,t),i&&(this.N?e="headers="+encodeURIComponent(String(pc(i)))+"&"+e:this.o&&Zi(t,this.o,i)),$i(this.h,s),this.Ya&&Q(t,"TYPE","init"),this.O?(Q(t,"$req",e),Q(t,"SID","null"),s.Z=!0,Gi(s,t,null)):Gi(s,t,e),this.G=2}}else 3==this.G&&(n?wc(this,n):0==this.i.length||ic(this.h)||wc(this))},S.Ia=function(){if(this.u=null,xc(this),this.$&&!(this.K||null==this.g||0>=this.P)){var n=2*this.P;this.j.info("BP detection timer enabled: "+n),this.B=Ln(we(this.eb,this),n)}},S.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,Ie(10),os(this),xc(this))},S.cb=function(){null!=this.v&&(this.v=null,os(this),Wi(this),Ie(19))},S.kb=function(n){n?(this.j.info("Successfully pinged google.com"),Ie(2)):(this.j.info("Failed to ping google.com"),Ie(1))},(S=Dc.prototype).xa=function(){},S.wa=function(){},S.va=function(){},S.ua=function(){},S.Ra=function(){},cs.prototype.g=function(n,e){return new Ae(n,e)},me(Ae,le),Ae.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var n=this.g,e=this.l,t=this.h||void 0;Ie(0),n.V=e,n.ia=t||{},n.L=n.Y,n.F=bc(n,null,n.V),as(n)},Ae.prototype.close=function(){Hi(this.g)},Ae.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=Ri(n),n=t);e.i.push(new class{constructor(n,e){this.h=n,this.g=e}}(e.ab++,n)),3==e.G&&as(e)},Ae.prototype.M=function(){this.g.l=null,delete this.j,Hi(this.g),delete this.g,Ae.X.M.call(this)},me(Ac,Pi),me(Nc,qi),me(Jt,Dc),Jt.prototype.xa=function(){ge(this.g,"a")},Jt.prototype.wa=function(n){ge(this.g,new Ac(n))},Jt.prototype.va=function(n){ge(this.g,new Nc)},Jt.prototype.ua=function(){ge(this.g,"b")},cs.prototype.createWebChannel=cs.prototype.g,Ae.prototype.send=Ae.prototype.u,Ae.prototype.open=Ae.prototype.m,Ae.prototype.close=Ae.prototype.close,Wr.NO_ERROR=0,Wr.TIMEOUT=8,Wr.HTTP_ERROR=6,Ku.COMPLETE="complete",$u.EventType=On,On.OPEN="a",On.CLOSE="b",On.ERROR="c",On.MESSAGE="d",le.prototype.listen=le.prototype.N,Y.prototype.listenOnce=Y.prototype.O,Y.prototype.getLastError=Y.prototype.Oa,Y.prototype.getLastErrorCode=Y.prototype.Ea,Y.prototype.getStatus=Y.prototype.aa,Y.prototype.getResponseJson=Y.prototype.Sa,Y.prototype.getResponseText=Y.prototype.fa,Y.prototype.send=Y.prototype.da,Y.prototype.setWithCredentials=Y.prototype.Ka;var hm=je.createWebChannelTransport=function(){return new cs},dm=je.getStatEventTarget=function(){return Hr()},Xi=je.ErrorCode=Wr,fm=je.EventType=Ku,mm=je.Event=It,kc=je.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},gm=je.FetchXmlHttpFactory=Kn,ls=je.WebChannel=$u,pm=je.XhrIo=Y;const Rc="@firebase/firestore";class he{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}he.UNAUTHENTICATED=new he(null),he.GOOGLE_CREDENTIALS=new he("google-credentials-uid"),he.FIRST_PARTY=new he("first-party-uid"),he.MOCK_USER=new he("mock-user");let en="9.15.0";const tt=new _t.Yd("@firebase/firestore");function Ji(){return tt.logLevel}function w(n,...e){if(tt.logLevel<=_t.in.DEBUG){const t=e.map(eo);tt.debug(`Firestore (${en}): ${n}`,...t)}}function re(n,...e){if(tt.logLevel<=_t.in.ERROR){const t=e.map(eo);tt.error(`Firestore (${en}): ${n}`,...t)}}function St(n,...e){if(tt.logLevel<=_t.in.WARN){const t=e.map(eo);tt.warn(`Firestore (${en}): ${n}`,...t)}}function eo(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch(t){return n}}function E(n="Unexpected state"){const e=`FIRESTORE (${en}) INTERNAL ASSERTION FAILED: `+n;throw re(e),new Error(e)}function T(n,e){n||E()}function I(n,e){return n}const m={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class y extends K.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ae{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Fc{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class wm{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(he.UNAUTHENTICATED))}shutdown(){}}class _m{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Im{constructor(e){this.t=e,this.currentUser=he.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let s=this.i;const i=c=>this.i!==s?(s=this.i,t(c)):Promise.resolve();let o=new ae;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new ae,e.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const c=o;e.enqueueRetryable((0,p.Z)(function*(){yield c.promise,yield i(r.currentUser)}))},u=c=>{w("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?u(c):(w("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new ae)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(w("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(T("string"==typeof r.accessToken),new Fc(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return T(null===e||"string"==typeof e),new he(e)}}class xm{constructor(e,t,r,s){this.h=e,this.l=t,this.m=r,this.g=s,this.type="FirstParty",this.user=he.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(T(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class Em{constructor(e,t,r,s){this.h=e,this.l=t,this.m=r,this.g=s}getToken(){return Promise.resolve(new xm(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable(()=>t(he.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Mc{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Tm{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,t){const r=i=>{null!=i.error&&w("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.A;return this.A=i.token,w("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{w("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.appCheck.addTokenListener(this.o)};this.T.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.T.getImmediate({optional:!0});i?s(i):w("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(T("string"==typeof t.token),this.A=t.token,new Mc(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Sm(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Lc{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=Sm(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function A(n,e){return n<e?-1:n>e?1:0}function tn(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function Oc(n){return n+"\0"}class Z{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new y(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new y(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new y(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new y(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Z.fromMillis(Date.now())}static fromDate(e){return Z.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Z(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?A(this.nanoseconds,e.nanoseconds):A(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class C{constructor(e){this.timestamp=e}static fromTimestamp(e){return new C(e)}static min(){return new C(new Z(0,0))}static max(){return new C(new Z(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Zn{constructor(e,t,r){void 0===t?t=0:t>e.length&&E(),void 0===r?r=e.length-t:r>e.length-t&&E(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===Zn.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Zn?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class F extends Zn{construct(e,t,r){return new F(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new y(m.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new F(t)}static emptyPath(){return new F([])}}const bm=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class X extends Zn{construct(e,t,r){return new X(e,t,r)}static isValidIdentifier(e){return bm.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),X.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new X(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(0===r.length)throw new y(m.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if("\\"===a){if(s+1===e.length)throw new y(m.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new y(m.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,s+=2}else"`"===a?(o=!o,s++):"."!==a||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new y(m.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new X(t)}static emptyPath(){return new X([])}}class _{constructor(e){this.path=e}static fromPath(e){return new _(F.fromString(e))}static fromName(e){return new _(F.fromString(e).popFirst(5))}static empty(){return new _(F.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===F.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return F.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new _(new F(e.slice()))}}class hs{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function to(n){return n.fields.find(e=>2===e.kind)}function bt(n){return n.fields.filter(e=>2!==e.kind)}hs.UNKNOWN_ID=-1;class ds{constructor(e,t){this.fieldPath=e,this.kind=t}}class Hn{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Hn(0,Ne.min())}}function Vc(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=C.fromTimestamp(1e9===r?new Z(t+1,0):new Z(t,r));return new Ne(s,_.empty(),e)}function Pc(n){return new Ne(n.readTime,n.key,-1)}class Ne{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Ne(C.min(),_.empty(),-1)}static max(){return new Ne(C.max(),_.empty(),-1)}}function no(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=_.comparator(n.documentKey,e.documentKey),0!==t?t:A(n.largestBatchId,e.largestBatchId))}const qc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Uc{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function nt(n){return ro.apply(this,arguments)}function ro(){return ro=(0,p.Z)(function*(n){if(n.code!==m.FAILED_PRECONDITION||n.message!==qc)throw n;w("LocalStore","Unexpectedly lost primary lease")}),ro.apply(this,arguments)}class f{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&E(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new f((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof f?t:f.resolve(t)}catch(t){return f.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):f.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):f.reject(t)}static resolve(e){return new f((t,r)=>{t(e)})}static reject(e){return new f((t,r)=>{r(e)})}static waitFor(e){return new f((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},u=>r(u))}),o=!0,i===s&&t()})}static or(e){let t=f.resolve(!1);for(const r of e)t=t.next(s=>s?f.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new f((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let u=0;u<i;u++){const c=u;t(e[c]).next(l=>{o[c]=l,++a,a===i&&r(o)},l=>s(l))}})}static doWhile(e,t){return new f((r,s)=>{const i=()=>{!0===e()?t().next(()=>{i()},s):r()};i()})}}class fs{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.P=new ae,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{t.error?this.P.reject(new Wn(e,t.error)):this.P.resolve()},this.transaction.onerror=r=>{const s=so(r.target.error);this.P.reject(new Wn(e,s))}}static open(e,t,r,s){try{return new fs(t,e.transaction(s,r))}catch(i){throw new Wn(t,i)}}get v(){return this.P.promise}abort(e){e&&this.P.reject(e),this.aborted||(w("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Nm(t)}}class Le{constructor(e,t,r){this.name=e,this.version=t,this.S=r,12.2===Le.D((0,K.z$)())&&re("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return w("SimpleDb","Removing database:",e),Ct(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!(0,K.hl)())return!1;if(Le.N())return!0;const e=(0,K.z$)(),t=Le.D(e),r=0<t&&t<10,s=Le.k(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static N(){var e;return typeof process<"u"&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.O)}static M(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static k(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}F(e){var t=this;return(0,p.Z)(function*(){return t.db||(w("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,s)=>{const i=indexedDB.open(t.name,t.version);i.onsuccess=o=>{r(o.target.result)},i.onblocked=()=>{s(new Wn(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=o=>{const a=o.target.error;s("VersionError"===a.name?new y(m.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===a.name?new y(m.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a):new Wn(e,a))},i.onupgradeneeded=o=>{w("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',o.oldVersion),t.S.$(o.target.result,i.transaction,o.oldVersion,t.version).next(()=>{w("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.B&&(t.db.onversionchange=r=>t.B(r)),t.db})()}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,s){var i=this;return(0,p.Z)(function*(){const o="readonly"===t;let a=0;for(;;){++a;try{i.db=yield i.F(e);const u=fs.open(i.db,e,o?"readonly":"readwrite",r),c=s(u).next(l=>(u.V(),l)).catch(l=>(u.abort(l),f.reject(l))).toPromise();return c.catch(()=>{}),yield u.v,c}catch(u){const c=u,l="FirebaseError"!==c.name&&a<3;if(w("SimpleDb","Transaction failed with error:",c.message,"Retrying:",l),i.close(),!l)return Promise.reject(c)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class Am{constructor(e){this.q=e,this.U=!1,this.K=null}get isDone(){return this.U}get G(){return this.K}set cursor(e){this.q=e}done(){this.U=!0}j(e){this.K=e}delete(){return Ct(this.q.delete())}}class Wn extends y{constructor(e,t){super(m.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function rt(n){return"IndexedDbTransactionError"===n.name}class Nm{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(w("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(w("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Ct(r)}add(e){return w("SimpleDb","ADD",this.store.name,e,e),Ct(this.store.add(e))}get(e){return Ct(this.store.get(e)).next(t=>(void 0===t&&(t=null),w("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return w("SimpleDb","DELETE",this.store.name,e),Ct(this.store.delete(e))}count(){return w("SimpleDb","COUNT",this.store.name),Ct(this.store.count())}W(e,t){const r=this.options(e,t);if(r.index||"function"!=typeof this.store.getAll){const s=this.cursor(r),i=[];return this.H(s,(o,a)=>{i.push(a)}).next(()=>i)}{const s=this.store.getAll(r.range);return new f((i,o)=>{s.onerror=a=>{o(a.target.error)},s.onsuccess=a=>{i(a.target.result)}})}}J(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new f((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}Y(e,t){w("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.X=!1;const s=this.cursor(r);return this.H(s,(i,o,a)=>a.delete())}Z(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.H(s,t)}tt(e){const t=this.cursor({});return new f((r,s)=>{t.onerror=i=>{const o=so(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}H(e,t){const r=[];return new f((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const u=new Am(a),c=t(a.primaryKey,a.value,u);if(c instanceof f){const l=c.catch(h=>(u.done(),f.reject(h)));r.push(l)}u.isDone?s():null===u.G?a.continue():a.continue(u.G)}}).next(()=>f.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Ct(n){return new f((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const s=so(r.target.error);t(s)}})}let Bc=!1;function so(n){const e=Le.D((0,K.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new y("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Bc||(Bc=!0,setTimeout(()=>{throw r},0)),r}}return n}class km{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(e){var t=this;w("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,p.Z)(function*(){t.task=null;try{w("IndexBackiller",`Documents written: ${yield t.et.st()}`)}catch(r){rt(r)?w("IndexBackiller","Ignoring IndexedDB error during index backfill: ",r):yield nt(r)}yield t.nt(6e4)}))}}class Rm{constructor(e,t){this.localStore=e,this.persistence=t}st(e=50){var t=this;return(0,p.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>t.it(r,e))})()}it(e,t){const r=new Set;let s=t,i=!0;return f.doWhile(()=>!0===i&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(null!==o&&!r.has(o))return w("IndexBackiller",`Processing collection: ${o}`),this.rt(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}rt(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.ot(s,i)).next(a=>(w("IndexBackiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}ot(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=Pc(i);no(o,r)>0&&(r=o)}),new Ne(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}let ke=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=s=>this.ut(s),this.ct=s=>r.writeSequenceNumber(s))}ut(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ct&&this.ct(t),t}}return n.at=-1,n})();class Fm{constructor(e,t,r,s,i,o,a,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.useFetchStreams=u}}class st{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new st("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof st&&e.projectId===this.projectId&&e.database===this.database}}function Gc(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Dt(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Kc(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Yn(n){return null==n}function Xn(n){return 0===n&&1/n==-1/0}function jc(n){return"number"==typeof n&&Number.isInteger(n)&&!Xn(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}class ue{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new ue(t)}static fromUint8Array(e){const t=function(r){let s="";for(let i=0;i<r.length;++i)s+=String.fromCharCode(r[i]);return s}(e);return new ue(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return A(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ue.EMPTY_BYTE_STRING=new ue("");const Lm=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function it(n){if(T(!!n),"string"==typeof n){let e=0;const t=Lm.exec(n);if(T(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:J(n.seconds),nanos:J(n.nanos)}}function J(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function At(n){return"string"==typeof n?ue.fromBase64String(n):ue.fromUint8Array(n)}function io(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==n?void 0:n.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function $c(n){const e=n.mapValue.fields.__previous_value__;return io(e)?$c(e):e}function Jn(n){const e=it(n.mapValue.fields.__local_write_time__.timestampValue);return new Z(e.seconds,e.nanos)}const ot={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},ms={nullValue:"NULL_VALUE"};function Nt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?io(n)?4:Hc(n)?9007199254740991:10:E()}function Ve(n,e){if(n===e)return!0;const t=Nt(n);if(t!==Nt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Jn(n).isEqual(Jn(e));case 3:return function(r,s){if("string"==typeof r.timestampValue&&"string"==typeof s.timestampValue&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;const i=it(r.timestampValue),o=it(s.timestampValue);return i.seconds===o.seconds&&i.nanos===o.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return s=e,At(n.bytesValue).isEqual(At(s.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,s){return J(r.geoPointValue.latitude)===J(s.geoPointValue.latitude)&&J(r.geoPointValue.longitude)===J(s.geoPointValue.longitude)}(n,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return J(r.integerValue)===J(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){const i=J(r.doubleValue),o=J(s.doubleValue);return i===o?Xn(i)===Xn(o):isNaN(i)&&isNaN(o)}return!1}(n,e);case 9:return tn(n.arrayValue.values||[],e.arrayValue.values||[],Ve);case 10:return function(r,s){const i=r.mapValue.fields||{},o=s.mapValue.fields||{};if(Gc(i)!==Gc(o))return!1;for(const a in i)if(i.hasOwnProperty(a)&&(void 0===o[a]||!Ve(i[a],o[a])))return!1;return!0}(n,e);default:return E()}var s}function er(n,e){return void 0!==(n.values||[]).find(t=>Ve(t,e))}function at(n,e){if(n===e)return 0;const t=Nt(n),r=Nt(e);if(t!==r)return A(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return A(n.booleanValue,e.booleanValue);case 2:return function(s,i){const o=J(s.integerValue||s.doubleValue),a=J(i.integerValue||i.doubleValue);return o<a?-1:o>a?1:o===a?0:isNaN(o)?isNaN(a)?0:-1:1}(n,e);case 3:return zc(n.timestampValue,e.timestampValue);case 4:return zc(Jn(n),Jn(e));case 5:return A(n.stringValue,e.stringValue);case 6:return function(s,i){const o=At(s),a=At(i);return o.compareTo(a)}(n.bytesValue,e.bytesValue);case 7:return function(s,i){const o=s.split("/"),a=i.split("/");for(let u=0;u<o.length&&u<a.length;u++){const c=A(o[u],a[u]);if(0!==c)return c}return A(o.length,a.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,i){const o=A(J(s.latitude),J(i.latitude));return 0!==o?o:A(J(s.longitude),J(i.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,i){const o=s.values||[],a=i.values||[];for(let u=0;u<o.length&&u<a.length;++u){const c=at(o[u],a[u]);if(c)return c}return A(o.length,a.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,i){if(s===ot.mapValue&&i===ot.mapValue)return 0;if(s===ot.mapValue)return 1;if(i===ot.mapValue)return-1;const o=s.fields||{},a=Object.keys(o),u=i.fields||{},c=Object.keys(u);a.sort(),c.sort();for(let l=0;l<a.length&&l<c.length;++l){const h=A(a[l],c[l]);if(0!==h)return h;const d=at(o[a[l]],u[c[l]]);if(0!==d)return d}return A(a.length,c.length)}(n.mapValue,e.mapValue);default:throw E()}}function zc(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return A(n,e);const t=it(n),r=it(e),s=A(t.seconds,r.seconds);return 0!==s?s:A(t.nanos,r.nanos)}function nn(n){return oo(n)}function oo(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(r){const s=it(r);return`time(${s.seconds},${s.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?At(n.bytesValue).toBase64():"referenceValue"in n?_.fromName(n.referenceValue).toString():"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(r){let s="[",i=!0;for(const o of r.values||[])i?i=!1:s+=",",s+=oo(o);return s+"]"}(n.arrayValue):"mapValue"in n?function(r){const s=Object.keys(r.fields||{}).sort();let i="{",o=!0;for(const a of s)o?o=!1:i+=",",i+=`${a}:${oo(r.fields[a])}`;return i+"}"}(n.mapValue):E();var e}function kt(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function ao(n){return!!n&&"integerValue"in n}function tr(n){return!!n&&"arrayValue"in n}function Qc(n){return!!n&&"nullValue"in n}function Zc(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function gs(n){return!!n&&"mapValue"in n}function nr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Dt(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=nr(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=nr(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Hc(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function Om(n){return"nullValue"in n?ms:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?kt(st.empty(),_.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:E()}function Vm(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?kt(st.empty(),_.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?ot:E()}function Wc(n,e){const t=at(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Yc(n,e){const t=at(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class ut{constructor(e,t){this.position=e,this.inclusive=t}}function Xc(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(r=i.field.isKeyField()?_.comparator(_.fromName(o.referenceValue),t.key):at(o,t.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function Jc(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ve(n.position[t],e.position[t]))return!1;return!0}class el{}class k extends el{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new Pm(e,t,r):"array-contains"===t?new Bm(e,r):"in"===t?new ul(e,r):"not-in"===t?new Gm(e,r):"array-contains-any"===t?new Km(e,r):new k(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new qm(e,r):new Um(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(at(t,this.value)):null!==t&&Nt(this.value)===Nt(t)&&this.matchesComparison(at(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return E()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class U extends el{constructor(e,t){super(),this.filters=e,this.op=t,this.ht=null}static create(e,t){return new U(e,t)}matches(e){return rn(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ht||(this.ht=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ht}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.lt(t=>t.isInequality());return null!==e?e.field:null}lt(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function rn(n){return"and"===n.op}function uo(n){return"or"===n.op}function tl(n){return nl(n)&&rn(n)}function nl(n){for(const e of n.filters)if(e instanceof U)return!1;return!0}function rl(n){if(n instanceof k)return n.field.canonicalString()+n.op.toString()+nn(n.value);{const e=n.filters.map(t=>rl(t)).join(",");return`${n.op}(${e})`}}function sl(n,e){return n instanceof k?(t=n,(r=e)instanceof k&&t.op===r.op&&t.field.isEqual(r.field)&&Ve(t.value,r.value)):n instanceof U?function(t,r){return r instanceof U&&t.op===r.op&&t.filters.length===r.filters.length&&t.filters.reduce((s,i,o)=>s&&sl(i,r.filters[o]),!0)}(n,e):void E();var t,r}function il(n,e){const t=n.filters.concat(e);return U.create(t,n.op)}function ol(n){return n instanceof k?`${(e=n).field.canonicalString()} ${e.op} ${nn(e.value)}`:n instanceof U?function(e){return e.op.toString()+" {"+e.getFilters().map(ol).join(" ,")+"}"}(n):"Filter";var e}class Pm extends k{constructor(e,t,r){super(e,t,r),this.key=_.fromName(r.referenceValue)}matches(e){const t=_.comparator(e.key,this.key);return this.matchesComparison(t)}}class qm extends k{constructor(e,t){super(e,"in",t),this.keys=al(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Um extends k{constructor(e,t){super(e,"not-in",t),this.keys=al(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function al(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>_.fromName(r.referenceValue))}class Bm extends k{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return tr(t)&&er(t.arrayValue,this.value)}}class ul extends k{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&er(this.value.arrayValue,t)}}class Gm extends k{constructor(e,t){super(e,"not-in",t)}matches(e){if(er(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!er(this.value.arrayValue,t)}}class Km extends k{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!tr(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>er(this.value.arrayValue,r))}}class sn{constructor(e,t="asc"){this.field=e,this.dir=t}}function jm(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class ee{constructor(e,t){this.comparator=e,this.root=t||pe.EMPTY}insert(e,t){return new ee(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,pe.BLACK,null,null))}remove(e){return new ee(this.comparator,this.root.remove(e,this.comparator).copy(null,null,pe.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(0===s)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ps(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ps(this.root,e,this.comparator,!1)}getReverseIterator(){return new ps(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ps(this.root,e,this.comparator,!0)}}class ps{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class pe{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=null!=r?r:pe.RED,this.left=null!=s?s:pe.EMPTY,this.right=null!=i?i:pe.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new pe(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=s?s:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):0===i?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return pe.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===t(e,s.key)){if(s.right.isEmpty())return pe.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,pe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,pe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw E();const e=this.left.check();if(e!==this.right.check())throw E();return e+(this.isRed()?0:1)}}pe.EMPTY=null,pe.RED=!0,pe.BLACK=!1,pe.EMPTY=new class{constructor(){this.size=0}get key(){throw E()}get value(){throw E()}get color(){throw E()}get left(){throw E()}get right(){throw E()}copy(n,e,t,r,s){return this}insert(n,e,t){return new pe(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class B{constructor(e){this.comparator=e,this.data=new ee(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new cl(this.data.getIterator())}getIteratorFrom(e){return new cl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof B)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(0!==this.comparator(s,i))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new B(this.comparator);return t.data=e,t}}class cl{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function on(n){return n.hasNext()?n.getNext():void 0}class Re{constructor(e){this.fields=e,e.sort(X.comparator)}static empty(){return new Re([])}unionWith(e){let t=new B(X.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Re(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return tn(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class ye{constructor(e){this.value=e}static empty(){return new ye({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!gs(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=nr(t)}setAll(e){let t=X.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const u=this.getFieldsMap(t);this.applyChanges(u,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=nr(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());gs(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ve(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];gs(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Dt(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new ye(nr(this.value))}}function ll(n){const e=[];return Dt(n.fields,(t,r)=>{const s=new X([t]);if(gs(r)){const i=ll(r.mapValue).fields;if(0===i.length)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Re(e)}class j{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new j(e,0,C.min(),C.min(),C.min(),ye.empty(),0)}static newFoundDocument(e,t,r,s){return new j(e,1,t,C.min(),r,s,0)}static newNoDocument(e,t){return new j(e,2,t,C.min(),C.min(),ye.empty(),0)}static newUnknownDocument(e,t){return new j(e,3,t,C.min(),C.min(),ye.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(C.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ye.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ye.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=C.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof j&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new j(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class $m{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ft=null}}function co(n,e=null,t=[],r=[],s=null,i=null,o=null){return new $m(n,e,t,r,s,i,o)}function Rt(n){const e=I(n);if(null===e.ft){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>rl(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),Yn(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>nn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>nn(r)).join(",")),e.ft=t}return e.ft}function rr(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!jm(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!sl(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Jc(n.startAt,e.startAt)&&Jc(n.endAt,e.endAt)}function ys(n){return _.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function vs(n,e){return n.filters.filter(t=>t instanceof k&&t.field.isEqual(e))}function hl(n,e,t){let r=ms,s=!0;for(const i of vs(n,e)){let o=ms,a=!0;switch(i.op){case"<":case"<=":o=Om(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=ms}Wc({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(null!==t)for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Wc({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}return{value:r,inclusive:s}}function dl(n,e,t){let r=ot,s=!0;for(const i of vs(n,e)){let o=ot,a=!0;switch(i.op){case">=":case">":o=Vm(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=ot}Yc({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(null!==t)for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Yc({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}return{value:r,inclusive:s}}class Qe{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=u,this.dt=null,this._t=null}}function fl(n,e,t,r,s,i,o,a){return new Qe(n,e,t,r,s,i,o,a)}function an(n){return new Qe(n)}function ml(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function lo(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function ws(n){for(const e of n.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}function ho(n){return null!==n.collectionGroup}function Ft(n){const e=I(n);if(null===e.dt){e.dt=[];const t=ws(e),r=lo(e);if(null!==t&&null===r)t.isKeyField()||e.dt.push(new sn(t)),e.dt.push(new sn(X.keyField(),"asc"));else{let s=!1;for(const i of e.explicitOrderBy)e.dt.push(i),i.field.isKeyField()&&(s=!0);if(!s){const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.dt.push(new sn(X.keyField(),i))}}}return e.dt}function xe(n){const e=I(n);if(!e._t)if("F"===e.limitType)e._t=co(e.path,e.collectionGroup,Ft(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const i of Ft(e))t.push(new sn(i.field,"desc"===i.dir?"asc":"desc"));const r=e.endAt?new ut(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new ut(e.startAt.position,e.startAt.inclusive):null;e._t=co(e.path,e.collectionGroup,t,e.filters,e.limit,r,s)}return e._t}function fo(n,e){e.getFirstInequalityField(),ws(n);const t=n.filters.concat([e]);return new Qe(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function _s(n,e,t){return new Qe(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function sr(n,e){return rr(xe(n),xe(e))&&n.limitType===e.limitType}function gl(n){return`${Rt(xe(n))}|lt:${n.limitType}`}function mo(n){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(r=>ol(r)).join(", ")}]`),Yn(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(r=>{return`${(s=r).field.canonicalString()} (${s.dir})`;var s}).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>nn(r)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>nn(r)).join(",")),`Target(${t})`}(xe(n))}; limitType=${n.limitType})`}function go(n,e){return e.isFoundDocument()&&function(t,r){const s=r.key.path;return null!==t.collectionGroup?r.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(s):_.isDocumentKey(t.path)?t.path.isEqual(s):t.path.isImmediateParentOf(s)}(n,e)&&function(t,r){for(const s of Ft(t))if(!s.field.isKeyField()&&null===r.data.field(s.field))return!1;return!0}(n,e)&&function(t,r){for(const s of t.filters)if(!s.matches(r))return!1;return!0}(n,e)&&(r=e,!((t=n).startAt&&!function(s,i,o){const a=Xc(s,i,o);return s.inclusive?a<=0:a<0}(t.startAt,Ft(t),r)||t.endAt&&!function(s,i,o){const a=Xc(s,i,o);return s.inclusive?a>=0:a>0}(t.endAt,Ft(t),r)));var t,r}function pl(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function yl(n){return(e,t)=>{let r=!1;for(const s of Ft(n)){const i=zm(s,e,t);if(0!==i)return i;r=r||s.field.isKeyField()}return 0}}function zm(n,e,t){const r=n.field.isKeyField()?_.comparator(e.key,t.key):function(s,i,o){const a=i.data.field(s),u=o.data.field(s);return null!==a&&null!==u?at(a,u):E()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return E()}}function vl(n,e){if(n.wt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Xn(e)?"-0":e}}function wl(n){return{integerValue:""+n}}function _l(n,e){return jc(e)?wl(e):vl(n,e)}class Is{constructor(){this._=void 0}}function Qm(n,e,t){return n instanceof un?function(r,s){const i={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&(i.fields.__previous_value__=s),{mapValue:i}}(t,e):n instanceof Mt?xl(n,e):n instanceof Lt?El(n,e):function(r,s){const i=Il(r,s),o=Tl(i)+Tl(r.gt);return ao(i)&&ao(r.gt)?wl(o):vl(r.yt,o)}(n,e)}function Zm(n,e,t){return n instanceof Mt?xl(n,e):n instanceof Lt?El(n,e):t}function Il(n,e){return n instanceof cn?ao(t=e)||(r=t)&&"doubleValue"in r?e:{integerValue:0}:null;var r,t}class un extends Is{}class Mt extends Is{constructor(e){super(),this.elements=e}}function xl(n,e){const t=Sl(e);for(const r of n.elements)t.some(s=>Ve(s,r))||t.push(r);return{arrayValue:{values:t}}}class Lt extends Is{constructor(e){super(),this.elements=e}}function El(n,e){let t=Sl(e);for(const r of n.elements)t=t.filter(s=>!Ve(s,r));return{arrayValue:{values:t}}}class cn extends Is{constructor(e,t){super(),this.yt=e,this.gt=t}}function Tl(n){return J(n.integerValue||n.doubleValue)}function Sl(n){return tr(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class ir{constructor(e,t){this.field=e,this.transform=t}}class Wm{constructor(e,t){this.version=e,this.transformResults=t}}class H{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new H}static exists(e){return new H(void 0,e)}static updateTime(e){return new H(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function xs(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class Es{}function bl(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new hn(n.key,H.none()):new ln(n.key,n.data,H.none());{const t=n.data,r=ye.empty();let s=new B(X.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);null===o&&i.length>1&&(i=i.popLast(),o=t.field(i)),null===o?r.delete(i):r.set(i,o),s=s.add(i)}return new Ze(n.key,r,new Re(s.toArray()),H.none())}}function Ym(n,e,t){n instanceof ln?function(r,s,i){const o=r.value.clone(),a=Al(r.fieldTransforms,s,i.transformResults);o.setAll(a),s.convertToFoundDocument(i.version,o).setHasCommittedMutations()}(n,e,t):n instanceof Ze?function(r,s,i){if(!xs(r.precondition,s))return void s.convertToUnknownDocument(i.version);const o=Al(r.fieldTransforms,s,i.transformResults),a=s.data;a.setAll(Dl(r)),a.setAll(o),s.convertToFoundDocument(i.version,a).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function or(n,e,t,r){return n instanceof ln?function(s,i,o,a){if(!xs(s.precondition,i))return o;const u=s.value.clone(),c=Nl(s.fieldTransforms,a,i);return u.setAll(c),i.convertToFoundDocument(i.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof Ze?function(s,i,o,a){if(!xs(s.precondition,i))return o;const u=Nl(s.fieldTransforms,a,i),c=i.data;return c.setAll(Dl(s)),c.setAll(u),i.convertToFoundDocument(i.version,c).setHasLocalMutations(),null===o?null:o.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(l=>l.field))}(n,e,t,r):(o=t,xs(n.precondition,i=e)?(i.convertToNoDocument(i.version).setHasLocalMutations(),null):o);var i,o}function Xm(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=Il(r.transform,s||null);null!=i&&(null===t&&(t=ye.empty()),t.set(r.field,i))}return t||null}function Cl(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(r=e.fieldTransforms,!!(void 0===(t=n.fieldTransforms)&&void 0===r||t&&r&&tn(t,r,(s,i)=>function Hm(n,e){return n.field.isEqual(e.field)&&(r=e.transform,(t=n.transform)instanceof Mt&&r instanceof Mt||t instanceof Lt&&r instanceof Lt?tn(t.elements,r.elements,Ve):t instanceof cn&&r instanceof cn?Ve(t.gt,r.gt):t instanceof un&&r instanceof un);var t,r}(s,i))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var t,r}class ln extends Es{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Ze extends Es{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Dl(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Al(n,e,t){const r=new Map;T(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,Zm(o,a,t[s]))}return r}function Nl(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,Qm(i,o,e))}return r}class hn extends Es{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class po extends Es{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Jm{constructor(e){this.count=e}}var oe,M;function kl(n){switch(n){default:return E();case m.CANCELLED:case m.UNKNOWN:case m.DEADLINE_EXCEEDED:case m.RESOURCE_EXHAUSTED:case m.INTERNAL:case m.UNAVAILABLE:case m.UNAUTHENTICATED:return!1;case m.INVALID_ARGUMENT:case m.NOT_FOUND:case m.ALREADY_EXISTS:case m.PERMISSION_DENIED:case m.FAILED_PRECONDITION:case m.ABORTED:case m.OUT_OF_RANGE:case m.UNIMPLEMENTED:case m.DATA_LOSS:return!0}}function Rl(n){if(void 0===n)return re("GRPC error has no .code"),m.UNKNOWN;switch(n){case oe.OK:return m.OK;case oe.CANCELLED:return m.CANCELLED;case oe.UNKNOWN:return m.UNKNOWN;case oe.DEADLINE_EXCEEDED:return m.DEADLINE_EXCEEDED;case oe.RESOURCE_EXHAUSTED:return m.RESOURCE_EXHAUSTED;case oe.INTERNAL:return m.INTERNAL;case oe.UNAVAILABLE:return m.UNAVAILABLE;case oe.UNAUTHENTICATED:return m.UNAUTHENTICATED;case oe.INVALID_ARGUMENT:return m.INVALID_ARGUMENT;case oe.NOT_FOUND:return m.NOT_FOUND;case oe.ALREADY_EXISTS:return m.ALREADY_EXISTS;case oe.PERMISSION_DENIED:return m.PERMISSION_DENIED;case oe.FAILED_PRECONDITION:return m.FAILED_PRECONDITION;case oe.ABORTED:return m.ABORTED;case oe.OUT_OF_RANGE:return m.OUT_OF_RANGE;case oe.UNIMPLEMENTED:return m.UNIMPLEMENTED;case oe.DATA_LOSS:return m.DATA_LOSS;default:return E()}}(M=oe||(oe={}))[M.OK=0]="OK",M[M.CANCELLED=1]="CANCELLED",M[M.UNKNOWN=2]="UNKNOWN",M[M.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",M[M.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",M[M.NOT_FOUND=5]="NOT_FOUND",M[M.ALREADY_EXISTS=6]="ALREADY_EXISTS",M[M.PERMISSION_DENIED=7]="PERMISSION_DENIED",M[M.UNAUTHENTICATED=16]="UNAUTHENTICATED",M[M.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",M[M.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",M[M.ABORTED=10]="ABORTED",M[M.OUT_OF_RANGE=11]="OUT_OF_RANGE",M[M.UNIMPLEMENTED=12]="UNIMPLEMENTED",M[M.INTERNAL=13]="INTERNAL",M[M.UNAVAILABLE=14]="UNAVAILABLE",M[M.DATA_LOSS=15]="DATA_LOSS";class ct{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[s,i]of r)if(this.equalsFn(s,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(void 0===s)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return 1===r.length?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Dt(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return Kc(this.inner)}size(){return this.innerSize}}const eg=new ee(_.comparator);function be(){return eg}const Fl=new ee(_.comparator);function ar(...n){let e=Fl;for(const t of n)e=e.insert(t.key,t);return e}function Ml(n){let e=Fl;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Pe(){return ur()}function Ll(){return ur()}function ur(){return new ct(n=>n.toString(),(n,e)=>n.isEqual(e))}const tg=new ee(_.comparator),ng=new B(_.comparator);function N(...n){let e=ng;for(const t of n)e=e.add(t);return e}const rg=new B(A);function Ts(){return rg}class cr{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,lr.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new cr(C.min(),s,Ts(),be(),N())}}class lr{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new lr(r,t,N(),N(),N())}}class Ss{constructor(e,t,r,s){this.It=e,this.removedTargetIds=t,this.key=r,this.Tt=s}}class Ol{constructor(e,t){this.targetId=e,this.Et=t}}class Vl{constructor(e,t,r=ue.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Pl{constructor(){this.At=0,this.Rt=Ul(),this.bt=ue.EMPTY_BYTE_STRING,this.Pt=!1,this.vt=!0}get current(){return this.Pt}get resumeToken(){return this.bt}get Vt(){return 0!==this.At}get St(){return this.vt}Dt(e){e.approximateByteSize()>0&&(this.vt=!0,this.bt=e)}Ct(){let e=N(),t=N(),r=N();return this.Rt.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:E()}}),new lr(this.bt,this.Pt,e,t,r)}xt(){this.vt=!1,this.Rt=Ul()}Nt(e,t){this.vt=!0,this.Rt=this.Rt.insert(e,t)}kt(e){this.vt=!0,this.Rt=this.Rt.remove(e)}Ot(){this.At+=1}Mt(){this.At-=1}Ft(){this.vt=!0,this.Pt=!0}}class sg{constructor(e){this.$t=e,this.Bt=new Map,this.Lt=be(),this.qt=ql(),this.Ut=new B(A)}Kt(e){for(const t of e.It)e.Tt&&e.Tt.isFoundDocument()?this.Gt(t,e.Tt):this.Qt(t,e.key,e.Tt);for(const t of e.removedTargetIds)this.Qt(t,e.key,e.Tt)}jt(e){this.forEachTarget(e,t=>{const r=this.Wt(t);switch(e.state){case 0:this.zt(t)&&r.Dt(e.resumeToken);break;case 1:r.Mt(),r.Vt||r.xt(),r.Dt(e.resumeToken);break;case 2:r.Mt(),r.Vt||this.removeTarget(t);break;case 3:this.zt(t)&&(r.Ft(),r.Dt(e.resumeToken));break;case 4:this.zt(t)&&(this.Ht(t),r.Dt(e.resumeToken));break;default:E()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Bt.forEach((r,s)=>{this.zt(s)&&t(s)})}Jt(e){const t=e.targetId,r=e.Et.count,s=this.Yt(t);if(s){const i=s.target;if(ys(i))if(0===r){const o=new _(i.path);this.Qt(t,o,j.newNoDocument(o,C.min()))}else T(1===r);else this.Xt(t)!==r&&(this.Ht(t),this.Ut=this.Ut.add(t))}}Zt(e){const t=new Map;this.Bt.forEach((i,o)=>{const a=this.Yt(o);if(a){if(i.current&&ys(a.target)){const u=new _(a.target.path);null!==this.Lt.get(u)||this.te(o,u)||this.Qt(o,u,j.newNoDocument(u,e))}i.St&&(t.set(o,i.Ct()),i.xt())}});let r=N();this.qt.forEach((i,o)=>{let a=!0;o.forEachWhile(u=>{const c=this.Yt(u);return!c||2===c.purpose||(a=!1,!1)}),a&&(r=r.add(i))}),this.Lt.forEach((i,o)=>o.setReadTime(e));const s=new cr(e,t,this.Ut,this.Lt,r);return this.Lt=be(),this.qt=ql(),this.Ut=new B(A),s}Gt(e,t){if(!this.zt(e))return;const r=this.te(e,t.key)?2:0;this.Wt(e).Nt(t.key,r),this.Lt=this.Lt.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ee(t.key).add(e))}Qt(e,t,r){if(!this.zt(e))return;const s=this.Wt(e);this.te(e,t)?s.Nt(t,1):s.kt(t),this.qt=this.qt.insert(t,this.ee(t).delete(e)),r&&(this.Lt=this.Lt.insert(t,r))}removeTarget(e){this.Bt.delete(e)}Xt(e){const t=this.Wt(e).Ct();return this.$t.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ot(e){this.Wt(e).Ot()}Wt(e){let t=this.Bt.get(e);return t||(t=new Pl,this.Bt.set(e,t)),t}ee(e){let t=this.qt.get(e);return t||(t=new B(A),this.qt=this.qt.insert(e,t)),t}zt(e){const t=null!==this.Yt(e);return t||w("WatchChangeAggregator","Detected inactive target",e),t}Yt(e){const t=this.Bt.get(e);return t&&t.Vt?null:this.$t.ne(e)}Ht(e){this.Bt.set(e,new Pl),this.$t.getRemoteKeysForTarget(e).forEach(t=>{this.Qt(e,t,null)})}te(e,t){return this.$t.getRemoteKeysForTarget(e).has(t)}}function ql(){return new ee(_.comparator)}function Ul(){return new ee(_.comparator)}const ig={asc:"ASCENDING",desc:"DESCENDING"},og={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ag={and:"AND",or:"OR"};class ug{constructor(e,t){this.databaseId=e,this.wt=t}}function dn(n,e){return n.wt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Bl(n,e){return n.wt?e.toBase64():e.toUint8Array()}function cg(n,e){return dn(n,e.toTimestamp())}function se(n){return T(!!n),C.fromTimestamp(function(e){const t=it(e);return new Z(t.seconds,t.nanos)}(n))}function yo(n,e){return(t=n,new F(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString();var t}function Gl(n){const e=F.fromString(n);return T(Yl(e)),e}function hr(n,e){return yo(n.databaseId,e.path)}function qe(n,e){const t=Gl(e);if(t.get(1)!==n.databaseId.projectId)throw new y(m.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new y(m.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new _(jl(t))}function vo(n,e){return yo(n.databaseId,e)}function Kl(n){const e=Gl(n);return 4===e.length?F.emptyPath():jl(e)}function dr(n){return new F(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function jl(n){return T(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function $l(n,e,t){return{name:hr(n,e),fields:t.value.mapValue.fields}}function zl(n,e,t){const r=qe(n,e.name),s=se(e.updateTime),i=e.createTime?se(e.createTime):C.min(),o=new ye({mapValue:{fields:e.fields}}),a=j.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function fr(n,e){let t;if(e instanceof ln)t={update:$l(n,e.key,e.value)};else if(e instanceof hn)t={delete:hr(n,e.key)};else if(e instanceof Ze)t={update:$l(n,e.key,e.data),updateMask:yg(e.fieldMask)};else{if(!(e instanceof po))return E();t={verify:hr(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,i){const o=i.transform;if(o instanceof un)return{fieldPath:i.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof Mt)return{fieldPath:i.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof Lt)return{fieldPath:i.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof cn)return{fieldPath:i.field.canonicalString(),increment:o.gt};throw E()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:cg(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:E()),t;var s}function wo(n,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?H.updateTime(se(s.updateTime)):void 0!==s.exists?H.exists(s.exists):H.none():H.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(i,o){let a=null;"setToServerValue"in o?(T("REQUEST_TIME"===o.setToServerValue),a=new un):"appendMissingElements"in o?a=new Mt(o.appendMissingElements.values||[]):"removeAllFromArray"in o?a=new Lt(o.removeAllFromArray.values||[]):"increment"in o?a=new cn(i,o.increment):E();const u=X.fromServerFormat(o.fieldPath);return new ir(u,a)}(n,s)):[];var s;if(e.update){const s=qe(n,e.update.name),i=new ye({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=new Re((e.updateMask.fieldPaths||[]).map(c=>X.fromServerFormat(c)));return new Ze(s,i,o,t,r)}return new ln(s,i,t,r)}if(e.delete){const s=qe(n,e.delete);return new hn(s,t)}if(e.verify){const s=qe(n,e.verify);return new po(s,t)}return E()}function Ql(n,e){return{documents:[vo(n,e.path)]}}function _o(n,e){const t={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(t.parent=vo(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=vo(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const s=function(u){if(0!==u.length)return Wl(U.create(u,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const i=function(u){if(0!==u.length)return u.map(c=>{return{field:fn((l=c).field),direction:mg(l.dir)};var l})}(e.orderBy);i&&(t.structuredQuery.orderBy=i);const o=(c=e.limit,n.wt||Yn(c)?c:{value:c});var c,a,u;return null!==o&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(t.structuredQuery.endAt={before:!(u=e.endAt).inclusive,values:u.position}),t}function Zl(n){let e=Kl(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){T(1===r);const l=t.from[0];l.allDescendants?s=l.collectionId:e=e.child(l.collectionId)}let i=[];t.where&&(i=function(l){const h=Hl(l);return h instanceof U&&tl(h)?h.getFilters():[h]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(l=>{return new sn(mn((h=l).field),function(d){switch(d){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(h.direction));var h}));let a=null;t.limit&&(a=function(l){let h;return h="object"==typeof l?l.value:l,Yn(h)?null:h}(t.limit));let u=null;var l;t.startAt&&(u=new ut((l=t.startAt).values||[],!!l.before));let c=null;return t.endAt&&(c=function(l){return new ut(l.values||[],!l.before)}(t.endAt)),fl(e,s,o,i,a,"F",u,c)}function Hl(n){return void 0!==n.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=mn(e.unaryFilter.field);return k.create(t,"==",{doubleValue:NaN});case"IS_NULL":const r=mn(e.unaryFilter.field);return k.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=mn(e.unaryFilter.field);return k.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=mn(e.unaryFilter.field);return k.create(i,"!=",{nullValue:"NULL_VALUE"});default:return E()}}(n):void 0!==n.fieldFilter?k.create(mn((e=n).fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return E()}}(e.fieldFilter.op),e.fieldFilter.value):void 0!==n.compositeFilter?function(e){return U.create(e.compositeFilter.filters.map(t=>Hl(t)),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return E()}}(e.compositeFilter.op))}(n):E();var e}function mg(n){return ig[n]}function gg(n){return og[n]}function pg(n){return ag[n]}function fn(n){return{fieldPath:n.canonicalString()}}function mn(n){return X.fromServerFormat(n.fieldPath)}function Wl(n){return n instanceof k?function(e){if("=="===e.op){if(Zc(e.value))return{unaryFilter:{field:fn(e.field),op:"IS_NAN"}};if(Qc(e.value))return{unaryFilter:{field:fn(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Zc(e.value))return{unaryFilter:{field:fn(e.field),op:"IS_NOT_NAN"}};if(Qc(e.value))return{unaryFilter:{field:fn(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:fn(e.field),op:gg(e.op),value:e.value}}}(n):n instanceof U?function(e){const t=e.getFilters().map(r=>Wl(r));return 1===t.length?t[0]:{compositeFilter:{op:pg(e.op),filters:t}}}(n):E()}function yg(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Yl(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}function Ee(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Xl(e)),e=vg(n.get(t),e);return Xl(e)}function vg(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=i}}return t}function Xl(n){return n+"\x01\x01"}function Ue(n){const e=n.length;if(T(e>=2),2===e)return T("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),F.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("\x01",i);switch((o<0||o>t)&&E(),n.charAt(o+1)){case"\x01":const a=n.substring(i,o);let u;0===s.length?u=a:(s+=a,u=s,s=""),r.push(u);break;case"\x10":s+=n.substring(i,o),s+="\0";break;case"\x11":s+=n.substring(i,o+1);break;default:E()}i=o+2}return new F(r)}const Jl=["userId","batchId"];function bs(n,e){return[n,Ee(e)]}function eh(n,e,t){return[n,Ee(e),t]}const wg={},_g=["prefixPath","collectionGroup","readTime","documentId"],Ig=["prefixPath","collectionGroup","documentId"],xg=["collectionGroup","readTime","prefixPath","documentId"],Eg=["canonicalId","targetId"],Tg=["targetId","path"],Sg=["path","targetId"],bg=["collectionId","parent"],Cg=["indexId","uid"],Dg=["uid","sequenceNumber"],Ag=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Ng=["indexId","uid","orderedDocumentKey"],kg=["userId","collectionPath","documentId"],Rg=["userId","collectionPath","largestBatchId"],Fg=["userId","collectionGroup","largestBatchId"],th=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Mg=[...th,"documentOverlays"],nh=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],rh=nh,Lg=[...rh,"indexConfiguration","indexState","indexEntries"];class Io extends Uc{constructor(e,t){super(),this.se=e,this.currentSequenceNumber=t}}function de(n,e){const t=I(n);return Le.M(t.se,e)}class xo{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&Ym(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=or(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=or(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Ll();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const u=bl(o,a);null!==u&&r.set(s.key,u),o.isValidDocument()||o.convertToNoDocument(C.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),N())}isEqual(e){return this.batchId===e.batchId&&tn(this.mutations,e.mutations,(t,r)=>Cl(t,r))&&tn(this.baseMutations,e.baseMutations,(t,r)=>Cl(t,r))}}class Eo{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){T(e.mutations.length===r.length);let s=tg;const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Eo(e,t,r,s)}}class To{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class lt{constructor(e,t,r,s,i=C.min(),o=C.min(),a=ue.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}withSequenceNumber(e){return new lt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new lt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new lt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class sh{constructor(e){this.ie=e}}function ih(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Cs(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document={name:hr(s=n.ie,(i=e).key),fields:i.data.value.mapValue.fields,updateTime:dn(s,i.version.toTimestamp()),createTime:dn(s,i.createTime.toTimestamp())};else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Ot(e.version)};else{if(!e.isUnknownDocument())return E();r.unknownDocument={path:t.path.toArray(),version:Ot(e.version)}}var s,i;return r}function Cs(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Ot(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Vt(n){const e=new Z(n.seconds,n.nanoseconds);return C.fromTimestamp(e)}function Pt(n,e){const t=(e.baseMutations||[]).map(i=>wo(n.ie,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];i+1<e.mutations.length&&void 0!==e.mutations[i+1].transform&&(o.updateTransforms=e.mutations[i+1].transform.fieldTransforms,e.mutations.splice(i+1,1),++i)}const r=e.mutations.map(i=>wo(n.ie,i)),s=Z.fromMillis(e.localWriteTimeMs);return new xo(e.batchId,s,t,r)}function mr(n){const e=Vt(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?Vt(n.lastLimboFreeSnapshotVersion):C.min();let r;var s;return void 0!==n.query.documents?(T(1===(s=n.query).documents.length),r=xe(an(Kl(s.documents[0])))):r=xe(Zl(n.query)),new lt(r,n.targetId,0,n.lastListenSequenceNumber,e,t,ue.fromBase64String(n.resumeToken))}function oh(n,e){const t=Ot(e.snapshotVersion),r=Ot(e.lastLimboFreeSnapshotVersion);let s;s=ys(e.target)?Ql(n.ie,e.target):_o(n.ie,e.target);const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Rt(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function So(n){const e=Zl({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?_s(e,e.limit,"L"):e}function bo(n,e){return new To(e.largestBatchId,wo(n.ie,e.overlayMutation))}function ah(n,e){const t=e.path.lastSegment();return[n,Ee(e.path.popLast()),t]}function uh(n,e,t,r){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:Ot(r.readTime),documentKey:Ee(r.documentKey.path),largestBatchId:r.largestBatchId}}class Vg{getBundleMetadata(e,t){return ch(e).get(t).next(r=>{if(r)return{id:(s=r).bundleId,createTime:Vt(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return ch(e).put({bundleId:(r=t).id,createTime:Ot(se(r.createTime)),version:r.version});var r}getNamedQuery(e,t){return lh(e).get(t).next(r=>{if(r)return{name:(s=r).name,query:So(s.bundledQuery),readTime:Vt(s.readTime)};var s})}saveNamedQuery(e,t){return lh(e).put({name:(r=t).name,readTime:Ot(se(r.readTime)),bundledQuery:r.bundledQuery});var r}}function ch(n){return de(n,"bundles")}function lh(n){return de(n,"namedQueries")}class Ds{constructor(e,t){this.yt=e,this.userId=t}static re(e,t){return new Ds(e,t.uid||"")}getOverlay(e,t){return gr(e).get(ah(this.userId,t)).next(r=>r?bo(this.yt,r):null)}getOverlays(e,t){const r=Pe();return f.forEach(t,s=>this.getOverlay(e,s).next(i=>{null!==i&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new To(t,o);s.push(this.oe(e,a))}),f.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(Ee(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(gr(e).Y("collectionPathOverlayIndex",a))}),f.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Pe(),i=Ee(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return gr(e).W("collectionPathOverlayIndex",o).next(a=>{for(const u of a){const c=bo(this.yt,u);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=Pe();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return gr(e).Z({index:"collectionGroupOverlayIndex",range:a},(u,c,l)=>{const h=bo(this.yt,c);i.size()<s||h.largestBatchId===o?(i.set(h.getKey(),h),o=h.largestBatchId):l.done()}).next(()=>i)}oe(e,t){return gr(e).put(function(r,s,i){const[o,a,u]=ah(s,i.mutation.key);return{userId:s,collectionPath:a,documentId:u,collectionGroup:i.mutation.key.getCollectionGroup(),largestBatchId:i.largestBatchId,overlayMutation:fr(r.ie,i.mutation)}}(this.yt,this.userId,t))}}function gr(n){return de(n,"documentOverlays")}class qt{constructor(){}ue(e,t){this.ce(e,t),t.ae()}ce(e,t){if("nullValue"in e)this.he(t,5);else if("booleanValue"in e)this.he(t,10),t.le(e.booleanValue?1:0);else if("integerValue"in e)this.he(t,15),t.le(J(e.integerValue));else if("doubleValue"in e){const r=J(e.doubleValue);isNaN(r)?this.he(t,13):(this.he(t,15),Xn(r)?t.le(0):t.le(r))}else if("timestampValue"in e){const r=e.timestampValue;this.he(t,20),"string"==typeof r?t.fe(r):(t.fe(`${r.seconds||""}`),t.le(r.nanos||0))}else if("stringValue"in e)this.de(e.stringValue,t),this._e(t);else if("bytesValue"in e)this.he(t,30),t.we(At(e.bytesValue)),this._e(t);else if("referenceValue"in e)this.me(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.he(t,45),t.le(r.latitude||0),t.le(r.longitude||0)}else"mapValue"in e?Hc(e)?this.he(t,Number.MAX_SAFE_INTEGER):(this.ge(e.mapValue,t),this._e(t)):"arrayValue"in e?(this.ye(e.arrayValue,t),this._e(t)):E()}de(e,t){this.he(t,25),this.pe(e,t)}pe(e,t){t.fe(e)}ge(e,t){const r=e.fields||{};this.he(t,55);for(const s of Object.keys(r))this.de(s,t),this.ce(r[s],t)}ye(e,t){const r=e.values||[];this.he(t,50);for(const s of r)this.ce(s,t)}me(e,t){this.he(t,37),_.fromName(e).path.forEach(r=>{this.he(t,60),this.pe(r,t)})}he(e,t){e.le(t)}_e(e){e.le(2)}}function Pg(n){if(0===n)return 8;let e=0;return n>>4==0&&(e+=4,n<<=4),n>>6==0&&(e+=2,n<<=2),n>>7==0&&(e+=1),e}function hh(n){const e=64-function(t){let r=0;for(let s=0;s<8;++s){const i=Pg(255&t[s]);if(r+=i,8!==i)break}return r}(n);return Math.ceil(e/8)}qt.Ie=new qt;class qg{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Te(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ee(r.value),r=t.next();this.Ae()}Re(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.be(r.value),r=t.next();this.Pe()}ve(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ee(r);else if(r<2048)this.Ee(960|r>>>6),this.Ee(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Ee(480|r>>>12),this.Ee(128|63&r>>>6),this.Ee(128|63&r);else{const s=t.codePointAt(0);this.Ee(240|s>>>18),this.Ee(128|63&s>>>12),this.Ee(128|63&s>>>6),this.Ee(128|63&s)}}this.Ae()}Ve(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.be(r);else if(r<2048)this.be(960|r>>>6),this.be(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.be(480|r>>>12),this.be(128|63&r>>>6),this.be(128|63&r);else{const s=t.codePointAt(0);this.be(240|s>>>18),this.be(128|63&s>>>12),this.be(128|63&s>>>6),this.be(128|63&s)}}this.Pe()}Se(e){const t=this.De(e),r=hh(t);this.Ce(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}xe(e){const t=this.De(e),r=hh(t);this.Ce(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}Ne(){this.ke(255),this.ke(255)}Oe(){this.Me(255),this.Me(255)}reset(){this.position=0}seed(e){this.Ce(e.length),this.buffer.set(e,this.position),this.position+=e.length}Fe(){return this.buffer.slice(0,this.position)}De(e){const t=function(s){const i=new DataView(new ArrayBuffer(8));return i.setFloat64(0,s,!1),new Uint8Array(i.buffer)}(e),r=0!=(128&t[0]);t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ee(e){const t=255&e;0===t?(this.ke(0),this.ke(255)):255===t?(this.ke(255),this.ke(0)):this.ke(t)}be(e){const t=255&e;0===t?(this.Me(0),this.Me(255)):255===t?(this.Me(255),this.Me(0)):this.Me(e)}Ae(){this.ke(0),this.ke(1)}Pe(){this.Me(0),this.Me(1)}ke(e){this.Ce(1),this.buffer[this.position++]=e}Me(e){this.Ce(1),this.buffer[this.position++]=~e}Ce(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class Ug{constructor(e){this.$e=e}we(e){this.$e.Te(e)}fe(e){this.$e.ve(e)}le(e){this.$e.Se(e)}ae(){this.$e.Ne()}}class Bg{constructor(e){this.$e=e}we(e){this.$e.Re(e)}fe(e){this.$e.Ve(e)}le(e){this.$e.xe(e)}ae(){this.$e.Oe()}}class pr{constructor(){this.$e=new qg,this.Be=new Ug(this.$e),this.Le=new Bg(this.$e)}seed(e){this.$e.seed(e)}qe(e){return 0===e?this.Be:this.Le}Fe(){return this.$e.Fe()}reset(){this.$e.reset()}}class Ut{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Ue(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Ut(this.indexId,this.documentKey,this.arrayValue,r)}}function ht(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=dh(n.arrayValue,e.arrayValue),0!==t?t:(t=dh(n.directionalValue,e.directionalValue),0!==t?t:_.comparator(n.documentKey,e.documentKey)))}function dh(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class Gg{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ke=e.orderBy,this.Ge=[];for(const t of e.filters){const r=t;r.isInequality()?this.Qe=r:this.Ge.push(r)}}je(e){T(e.collectionGroup===this.collectionId);const t=to(e);if(void 0!==t&&!this.We(t))return!1;const r=bt(e);let s=0,i=0;for(;s<r.length&&this.We(r[s]);++s);if(s===r.length)return!0;if(void 0!==this.Qe){const o=r[s];if(!this.ze(this.Qe,o)||!this.He(this.Ke[i++],o))return!1;++s}for(;s<r.length;++s){const o=r[s];if(i>=this.Ke.length||!this.He(this.Ke[i++],o))return!1}return!0}We(e){for(const t of this.Ge)if(this.ze(t,e))return!0;return!1}ze(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}He(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function fh(n){var e,t;if(T(n instanceof k||n instanceof U),n instanceof k){if(n instanceof ul){const s=(null===(t=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(i=>k.create(n.field,"==",i)))||[];return U.create(s,"or")}return n}const r=n.filters.map(s=>fh(s));return U.create(r,n.op)}function Kg(n){if(0===n.getFilters().length)return[];const e=Ao(fh(n));return T(mh(e)),Co(e)||Do(e)?[e]:e.getFilters()}function Co(n){return n instanceof k}function Do(n){return n instanceof U&&tl(n)}function mh(n){return Co(n)||Do(n)||function(e){if(e instanceof U&&uo(e)){for(const t of e.getFilters())if(!Co(t)&&!Do(t))return!1;return!0}return!1}(n)}function Ao(n){if(T(n instanceof k||n instanceof U),n instanceof k)return n;if(1===n.filters.length)return Ao(n.filters[0]);const e=n.filters.map(r=>Ao(r));let t=U.create(e,n.op);return t=As(t),mh(t)?t:(T(t instanceof U),T(rn(t)),T(t.filters.length>1),t.filters.reduce((r,s)=>No(r,s)))}function No(n,e){let t;return T(n instanceof k||n instanceof U),T(e instanceof k||e instanceof U),t=n instanceof k?e instanceof k?U.create([n,e],"and"):gh(n,e):e instanceof k?gh(e,n):function(r,s){if(T(r.filters.length>0&&s.filters.length>0),rn(r)&&rn(s))return il(r,s.getFilters());const i=uo(r)?r:s,o=uo(r)?s:r,a=i.filters.map(u=>No(u,o));return U.create(a,"or")}(n,e),As(t)}function gh(n,e){if(rn(e))return il(e,n.getFilters());{const t=e.filters.map(r=>No(n,r));return U.create(t,"or")}}function As(n){if(T(n instanceof k||n instanceof U),n instanceof k)return n;const e=n.getFilters();if(1===e.length)return As(e[0]);if(nl(n))return n;const t=e.map(s=>As(s)),r=[];return t.forEach(s=>{s instanceof k?r.push(s):s instanceof U&&(s.op===n.op?r.push(...s.filters):r.push(s))}),1===r.length?r[0]:U.create(r,n.op)}class jg{constructor(){this.Je=new ko}addToCollectionParentIndex(e,t){return this.Je.add(t),f.resolve()}getCollectionParents(e,t){return f.resolve(this.Je.getEntries(t))}addFieldIndex(e,t){return f.resolve()}deleteFieldIndex(e,t){return f.resolve()}getDocumentsMatchingTarget(e,t){return f.resolve(null)}getIndexType(e,t){return f.resolve(0)}getFieldIndexes(e,t){return f.resolve([])}getNextCollectionGroupToUpdate(e){return f.resolve(null)}getMinOffset(e,t){return f.resolve(Ne.min())}getMinOffsetFromCollectionGroup(e,t){return f.resolve(Ne.min())}updateCollectionGroup(e,t,r){return f.resolve()}updateIndexEntries(e,t){return f.resolve()}}class ko{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new B(F.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new B(F.comparator)).toArray()}}const Ns=new Uint8Array(0);class $g{constructor(e,t){this.user=e,this.databaseId=t,this.Ye=new ko,this.Xe=new ct(r=>Rt(r),(r,s)=>rr(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Ye.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.Ye.add(t)});const i={collectionId:r,parent:Ee(s)};return ph(e).put(i)}return f.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[Oc(t),""],!1,!0);return ph(e).W(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(Ue(o.parent))}return r})}addFieldIndex(e,t){const r=ks(e),s={indexId:(o=t).indexId,collectionGroup:o.collectionGroup,fields:o.fields.map(a=>[a.fieldPath.canonicalString(),a.kind])};var o;delete s.indexId;const i=r.add(s);if(t.indexState){const o=vr(e);return i.next(a=>{o.put(uh(a,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=ks(e),s=vr(e),i=yr(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){const r=yr(e);let s=!0;const i=new Map;return f.forEach(this.Ze(t),o=>this.tn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=N();const a=[];return f.forEach(i,(u,c)=>{var l;w("IndexedDbIndexManager",`Using index ${l=u,`id=${l.indexId}|cg=${l.collectionGroup}|f=${l.fields.map(L=>`${L.fieldPath}:${L.kind}`).join(",")}`} to execute ${Rt(t)}`);const h=function(L,te){const V=to(te);if(void 0===V)return null;for(const P of vs(L,V.fieldPath))switch(P.op){case"array-contains-any":return P.value.arrayValue.values||[];case"array-contains":return[P.value]}return null}(c,u),d=function(L,te){const V=new Map;for(const P of bt(te))for(const ce of vs(L,P.fieldPath))switch(ce.op){case"==":case"in":V.set(P.fieldPath.canonicalString(),ce.value);break;case"not-in":case"!=":return V.set(P.fieldPath.canonicalString(),ce.value),Array.from(V.values())}return null}(c,u),g=function(L,te){const V=[];let P=!0;for(const ce of bt(te)){const Mr=0===ce.kind?hl(L,ce.fieldPath,L.startAt):dl(L,ce.fieldPath,L.startAt);V.push(Mr.value),P&&(P=Mr.inclusive)}return new ut(V,P)}(c,u),v=function(L,te){const V=[];let P=!0;for(const ce of bt(te)){const Mr=0===ce.kind?dl(L,ce.fieldPath,L.endAt):hl(L,ce.fieldPath,L.endAt);V.push(Mr.value),P&&(P=Mr.inclusive)}return new ut(V,P)}(c,u),x=this.en(u,c,g),b=this.en(u,c,v),G=this.nn(u,c,d),W=this.sn(u.indexId,h,x,g.inclusive,b,v.inclusive,G);return f.forEach(W,L=>r.J(L,t.limit).next(te=>{te.forEach(V=>{const P=_.fromSegments(V.documentKey);o.has(P)||(o=o.add(P),a.push(P))})}))}).next(()=>a)}return f.resolve(null)})}Ze(e){let t=this.Xe.get(e);return t||(t=0===e.filters.length?[e]:Kg(U.create(e.filters,"and")).map(r=>co(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Xe.set(e,t),t)}sn(e,t,r,s,i,o,a){const u=(null!=t?t.length:1)*Math.max(r.length,i.length),c=u/(null!=t?t.length:1),l=[];for(let h=0;h<u;++h){const d=t?this.rn(t[h/c]):Ns,g=this.on(e,d,r[h%c],s),v=this.un(e,d,i[h%c],o),x=a.map(b=>this.on(e,d,b,!0));l.push(...this.createRange(g,v,x))}return l}on(e,t,r,s){const i=new Ut(e,_.empty(),t,r);return s?i:i.Ue()}un(e,t,r,s){const i=new Ut(e,_.empty(),t,r);return s?i.Ue():i}tn(e,t){const r=new Gg(t),s=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.je(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.Ze(t);return f.forEach(s,i=>this.tn(e,i).next(o=>{o?0!==r&&o.fields.length<function(a){let u=new B(X.comparator),c=!1;for(const l of a.filters)for(const h of l.getFlattenedFilters())h.field.isKeyField()||("array-contains"===h.op||"array-contains-any"===h.op?c=!0:u=u.add(h.field));for(const l of a.orderBy)l.field.isKeyField()||(u=u.add(l.field));return u.size+(c?1:0)}(i)&&(r=1):r=0})).next(()=>null!==t.limit&&s.length>1&&2===r?1:r)}cn(e,t){const r=new pr;for(const s of bt(e)){const i=t.data.field(s.fieldPath);if(null==i)return null;const o=r.qe(s.kind);qt.Ie.ue(i,o)}return r.Fe()}rn(e){const t=new pr;return qt.Ie.ue(e,t.qe(0)),t.Fe()}an(e,t){const r=new pr;return qt.Ie.ue(kt(this.databaseId,t),r.qe(function(s){const i=bt(s);return 0===i.length?0:i[i.length-1].kind}(e))),r.Fe()}nn(e,t,r){if(null===r)return[];let s=[];s.push(new pr);let i=0;for(const o of bt(e)){const a=r[i++];for(const u of s)if(this.hn(t,o.fieldPath)&&tr(a))s=this.ln(s,o,a);else{const c=u.qe(o.kind);qt.Ie.ue(a,c)}}return this.fn(s)}en(e,t,r){return this.nn(e,t,r.position)}fn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Fe();return t}ln(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const u=new pr;u.seed(a.Fe()),qt.Ie.ue(o,u.qe(t.kind)),i.push(u)}return i}hn(e,t){return!!e.filters.find(r=>r instanceof k&&r.field.isEqual(t)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(e,t){const r=ks(e),s=vr(e);return(t?r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.W()).next(i=>{const o=[];return f.forEach(i,a=>s.get([a.indexId,this.uid]).next(u=>{o.push(function(c,l){const h=l?new Hn(l.sequenceNumber,new Ne(Vt(l.readTime),new _(Ue(l.documentKey)),l.largestBatchId)):Hn.empty(),d=c.fields.map(([g,v])=>new ds(X.fromServerFormat(g),v));return new hs(c.indexId,c.collectionGroup,d,h)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return 0!==i?i:A(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=ks(e),i=vr(e);return this.dn(e).next(o=>s.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>f.forEach(a,u=>i.put(uh(u.indexId,this.user,o,r)))))}updateIndexEntries(e,t){const r=new Map;return f.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?f.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),f.forEach(a,u=>this._n(e,s,u).next(c=>{const l=this.wn(i,u);return c.isEqual(l)?f.resolve():this.mn(e,i,u,c,l)}))))})}gn(e,t,r,s){return yr(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.an(r,t.key),documentKey:t.key.path.toArray()})}yn(e,t,r,s){return yr(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.an(r,t.key),t.key.path.toArray()])}_n(e,t,r){const s=yr(e);let i=new B(ht);return s.Z({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.an(r,t)])},(o,a)=>{i=i.add(new Ut(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}wn(e,t){let r=new B(ht);const s=this.cn(t,e);if(null==s)return r;const i=to(t);if(null!=i){const o=e.data.field(i.fieldPath);if(tr(o))for(const a of o.arrayValue.values||[])r=r.add(new Ut(t.indexId,e.key,this.rn(a),s))}else r=r.add(new Ut(t.indexId,e.key,Ns,s));return r}mn(e,t,r,s,i){w("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(a,u,c,l,h){const d=a.getIterator(),g=u.getIterator();let v=on(d),x=on(g);for(;v||x;){let b=!1,G=!1;if(v&&x){const W=c(v,x);W<0?G=!0:W>0&&(b=!0)}else null!=v?G=!0:b=!0;b?(l(x),x=on(g)):G?(h(v),v=on(d)):(v=on(d),x=on(g))}}(s,i,ht,a=>{o.push(this.gn(e,t,r,a))},a=>{o.push(this.yn(e,t,r,a))}),f.waitFor(o)}dn(e){let t=1;return vr(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>ht(o,a)).filter((o,a,u)=>!a||0!==ht(o,u[a-1]));const s=[];s.push(e);for(const o of r){const a=ht(o,e),u=ht(o,t);if(0===a)s[0]=e.Ue();else if(a>0&&u<0)s.push(o),s.push(o.Ue());else if(u>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.pn(s[o],s[o+1]))return[];i.push(IDBKeyRange.bound([s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,Ns,[]],[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,Ns,[]]))}return i}pn(e,t){return ht(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(yh)}getMinOffset(e,t){return f.mapArray(this.Ze(t),r=>this.tn(e,r).next(s=>s||E())).next(yh)}}function ph(n){return de(n,"collectionParents")}function yr(n){return de(n,"indexEntries")}function ks(n){return de(n,"indexConfiguration")}function vr(n){return de(n,"indexState")}function yh(n){T(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;no(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Ne(e.readTime,e.documentKey,t)}const vh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Ce{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Ce(e,Ce.DEFAULT_COLLECTION_PERCENTILE,Ce.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function wh(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const u=r.Z({range:o},(l,h,d)=>(a++,d.delete()));i.push(u.next(()=>{T(1===a)}));const c=[];for(const l of t.mutations){const h=eh(e,l.key.path,t.batchId);i.push(s.delete(h)),c.push(l.key)}return f.waitFor(i).next(()=>c)}function Rs(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw E();e=n.noDocument}return JSON.stringify(e).length}Ce.DEFAULT_COLLECTION_PERCENTILE=10,Ce.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ce.DEFAULT=new Ce(41943040,Ce.DEFAULT_COLLECTION_PERCENTILE,Ce.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ce.DISABLED=new Ce(-1,0,0);class Fs{constructor(e,t,r,s){this.userId=e,this.yt=t,this.indexManager=r,this.referenceDelegate=s,this.In={}}static re(e,t,r,s){T(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new Fs(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return dt(e).Z({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=gn(e),o=dt(e);return o.add({}).next(a=>{T("number"==typeof a);const u=new xo(a,t,r,s),c=function(d,g,v){const x=v.baseMutations.map(G=>fr(d.ie,G)),b=v.mutations.map(G=>fr(d.ie,G));return{userId:g,batchId:v.batchId,localWriteTimeMs:v.localWriteTime.toMillis(),baseMutations:x,mutations:b}}(this.yt,this.userId,u),l=[];let h=new B((d,g)=>A(d.canonicalString(),g.canonicalString()));for(const d of s){const g=eh(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),l.push(o.put(c)),l.push(i.put(g,wg))}return h.forEach(d=>{l.push(this.indexManager.addToCollectionParentIndex(e,d))}),e.addOnCommittedListener(()=>{this.In[a]=u.keys()}),f.waitFor(l).next(()=>u)})}lookupMutationBatch(e,t){return dt(e).get(t).next(r=>r?(T(r.userId===this.userId),Pt(this.yt,r)):null)}Tn(e,t){return this.In[t]?f.resolve(this.In[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.In[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return dt(e).Z({index:"userMutationsIndex",range:s},(o,a,u)=>{a.userId===this.userId&&(T(a.batchId>=r),i=Pt(this.yt,a)),u.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return dt(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return dt(e).W("userMutationsIndex",t).next(r=>r.map(s=>Pt(this.yt,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=bs(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return gn(e).Z({range:s},(o,a,u)=>{const[c,l,h]=o,d=Ue(l);if(c===this.userId&&t.path.isEqual(d))return dt(e).get(h).next(g=>{if(!g)throw E();T(g.userId===this.userId),i.push(Pt(this.yt,g))});u.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new B(A);const s=[];return t.forEach(i=>{const o=bs(this.userId,i.path),a=IDBKeyRange.lowerBound(o),u=gn(e).Z({range:a},(c,l,h)=>{const[d,g,v]=c,x=Ue(g);d===this.userId&&i.path.isEqual(x)?r=r.add(v):h.done()});s.push(u)}),f.waitFor(s).next(()=>this.En(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=bs(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new B(A);return gn(e).Z({range:o},(u,c,l)=>{const[h,d,g]=u,v=Ue(d);h===this.userId&&r.isPrefixOf(v)?v.length===s&&(a=a.add(g)):l.done()}).next(()=>this.En(e,a))}En(e,t){const r=[],s=[];return t.forEach(i=>{s.push(dt(e).get(i).next(o=>{if(null===o)throw E();T(o.userId===this.userId),r.push(Pt(this.yt,o))}))}),f.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return wh(e.se,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.An(t.batchId)}),f.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}An(e){delete this.In[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return f.resolve();const r=IDBKeyRange.lowerBound([this.userId]),s=[];return gn(e).Z({range:r},(i,o,a)=>{if(i[0]===this.userId){const u=Ue(i[1]);s.push(u)}else a.done()}).next(()=>{T(0===s.length)})})}containsKey(e,t){return _h(e,this.userId,t)}Rn(e){return Ih(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function _h(n,e,t){const r=bs(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return gn(n).Z({range:i,X:!0},(a,u,c)=>{const[l,h,d]=a;l===e&&h===s&&(o=!0),c.done()}).next(()=>o)}function dt(n){return de(n,"mutations")}function gn(n){return de(n,"documentMutations")}function Ih(n){return de(n,"mutationQueues")}class Bt{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new Bt(0)}static vn(){return new Bt(-1)}}class zg{constructor(e,t){this.referenceDelegate=e,this.yt=t}allocateTargetId(e){return this.Vn(e).next(t=>{const r=new Bt(t.highestTargetId);return t.highestTargetId=r.next(),this.Sn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Vn(e).next(t=>C.fromTimestamp(new Z(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Vn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Vn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Sn(e,s)))}addTargetData(e,t){return this.Dn(e,t).next(()=>this.Vn(e).next(r=>(r.targetCount+=1,this.Cn(t,r),this.Sn(e,r))))}updateTargetData(e,t){return this.Dn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>pn(e).delete(t.targetId)).next(()=>this.Vn(e)).next(r=>(T(r.targetCount>0),r.targetCount-=1,this.Sn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return pn(e).Z((o,a)=>{const u=mr(a);u.sequenceNumber<=t&&null===r.get(u.targetId)&&(s++,i.push(this.removeTargetData(e,u)))}).next(()=>f.waitFor(i)).next(()=>s)}forEachTarget(e,t){return pn(e).Z((r,s)=>{const i=mr(s);t(i)})}Vn(e){return xh(e).get("targetGlobalKey").next(t=>(T(null!==t),t))}Sn(e,t){return xh(e).put("targetGlobalKey",t)}Dn(e,t){return pn(e).put(oh(this.yt,t))}Cn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Vn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Rt(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return pn(e).Z({range:s,index:"queryTargetsIndex"},(o,a,u)=>{const c=mr(a);rr(t,c.target)&&(i=c,u.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=ft(e);return t.forEach(o=>{const a=Ee(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),f.waitFor(s)}removeMatchingKeys(e,t,r){const s=ft(e);return f.forEach(t,i=>{const o=Ee(i.path);return f.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=ft(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=ft(e);let i=N();return s.Z({range:r,X:!0},(o,a,u)=>{const c=Ue(o[1]),l=new _(c);i=i.add(l)}).next(()=>i)}containsKey(e,t){const r=Ee(t.path),s=IDBKeyRange.bound([r],[Oc(r)],!1,!0);let i=0;return ft(e).Z({index:"documentTargetsIndex",X:!0,range:s},([o,a],u,c)=>{0!==o&&(i++,c.done())}).next(()=>i>0)}ne(e,t){return pn(e).get(t).next(r=>r?mr(r):null)}}function pn(n){return de(n,"targets")}function xh(n){return de(n,"targetGlobal")}function ft(n){return de(n,"targetDocuments")}function Eh([n,e],[t,r]){const s=A(n,t);return 0===s?A(e,r):s}class Qg{constructor(e){this.xn=e,this.buffer=new B(Eh),this.Nn=0}kn(){return++this.Nn}On(e){const t=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Eh(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Zg{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Mn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return null!==this.Mn}Fn(e){var t=this;w("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,p.Z)(function*(){t.Mn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(r){rt(r)?w("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):yield nt(r)}yield t.Fn(3e5)}))}}class Hg{constructor(e,t){this.$n=e,this.params=t}calculateTargetCount(e,t){return this.$n.Bn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return f.resolve(ke.at);const r=new Qg(t);return this.$n.forEachTarget(e,s=>r.On(s.sequenceNumber)).next(()=>this.$n.Ln(e,s=>r.On(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.$n.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.$n.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(w("LruGarbageCollector","Garbage collection skipped; disabled"),f.resolve(vh)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(w("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),vh):this.qn(e,t))}getCacheSize(e){return this.$n.getCacheSize(e)}qn(e,t){let r,s,i,o,a,u,c;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(w("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),s=this.params.maximumSequenceNumbersToCollect):s=h,o=Date.now(),this.nthSequenceNumber(e,s))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,t))).next(h=>(i=h,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(c=Date.now(),Ji()<=_t.in.DEBUG&&w("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-l}ms\n\tDetermined least recently used ${s} in `+(a-o)+`ms\n\tRemoved ${i} targets in `+(u-a)+`ms\n\tRemoved ${h} documents in `+(c-u)+`ms\nTotal Duration: ${c-l}ms`),f.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:h})))}}class Wg{constructor(e,t){this.db=e,this.garbageCollector=new Hg(this,t)}Bn(e){const t=this.Un(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}Un(e){let t=0;return this.Ln(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ln(e,t){return this.Kn(e,(r,s)=>t(s))}addReference(e,t,r){return Ms(e,r)}removeReference(e,t,r){return Ms(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Ms(e,t)}Gn(e,t){return function(r,s){let i=!1;return Ih(r).tt(o=>_h(r,o,s).next(a=>(a&&(i=!0),f.resolve(!a)))).next(()=>i)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Kn(e,(o,a)=>{if(a<=t){const u=this.Gn(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,C.min()),ft(e).delete([0,Ee(o.path)])))});s.push(u)}}).next(()=>f.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Ms(e,t)}Kn(e,t){const r=ft(e);let s,i=ke.at;return r.Z({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{0===o?(i!==ke.at&&t(new _(Ue(s)),i),i=c,s=u):i=ke.at}).next(()=>{i!==ke.at&&t(new _(Ue(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Ms(n,e){return ft(n).put((r=n.currentSequenceNumber,{targetId:0,path:Ee(e.path),sequenceNumber:r}));var r}class Th{constructor(){this.changes=new ct(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,j.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?f.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Yg{constructor(e){this.yt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Gt(e).put(r)}removeEntry(e,t,r){return Gt(e).delete(function(s,i){const o=s.path.toArray();return[o.slice(0,o.length-2),o[o.length-2],Cs(i),o[o.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Qn(e,r)))}getEntry(e,t){let r=j.newInvalidDocument(t);return Gt(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(wr(t))},(s,i)=>{r=this.jn(t,i)}).next(()=>r)}Wn(e,t){let r={size:0,document:j.newInvalidDocument(t)};return Gt(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(wr(t))},(s,i)=>{r={document:this.jn(t,i),size:Rs(i)}}).next(()=>r)}getEntries(e,t){let r=be();return this.zn(e,t,(s,i)=>{const o=this.jn(s,i);r=r.insert(s,o)}).next(()=>r)}Hn(e,t){let r=be(),s=new ee(_.comparator);return this.zn(e,t,(i,o)=>{const a=this.jn(i,o);r=r.insert(i,a),s=s.insert(i,Rs(o))}).next(()=>({documents:r,Jn:s}))}zn(e,t,r){if(t.isEmpty())return f.resolve();let s=new B(Dh);t.forEach(u=>s=s.add(u));const i=IDBKeyRange.bound(wr(s.first()),wr(s.last())),o=s.getIterator();let a=o.getNext();return Gt(e).Z({index:"documentKeyIndex",range:i},(u,c,l)=>{const h=_.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&Dh(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?l.j(wr(a)):l.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getAllFromCollection(e,t,r){const s=[t.popLast().toArray(),t.lastSegment(),Cs(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],i=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Gt(e).W(IDBKeyRange.bound(s,i,!0)).next(o=>{let a=be();for(const u of o){const c=this.jn(_.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);a=a.insert(c.key,c)}return a})}getAllFromCollectionGroup(e,t,r,s){let i=be();const o=Ch(t,r),a=Ch(t,Ne.max());return Gt(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,l)=>{const h=this.jn(_.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(h.key,h),i.size===s&&l.done()}).next(()=>i)}newChangeBuffer(e){return new Xg(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return bh(e).get("remoteDocumentGlobalKey").next(t=>(T(!!t),t))}Qn(e,t){return bh(e).put("remoteDocumentGlobalKey",t)}jn(e,t){if(t){const r=function Og(n,e){let t;if(e.document)t=zl(n.ie,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=_.fromSegments(e.noDocument.path),s=Vt(e.noDocument.readTime);t=j.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return E();{const r=_.fromSegments(e.unknownDocument.path),s=Vt(e.unknownDocument.version);t=j.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(r){const s=new Z(r[0],r[1]);return C.fromTimestamp(s)}(e.readTime)),t}(this.yt,t);if(!r.isNoDocument()||!r.version.isEqual(C.min()))return r}return j.newInvalidDocument(e)}}function Sh(n){return new Yg(n)}class Xg extends Th{constructor(e,t){super(),this.Yn=e,this.trackRemovals=t,this.Xn=new ct(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new B((i,o)=>A(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.Xn.get(i);if(t.push(this.Yn.removeEntry(e,i,a.readTime)),o.isValidDocument()){const u=ih(this.Yn.yt,o);s=s.add(i.path.popLast());const c=Rs(u);r+=c-a.size,t.push(this.Yn.addEntry(e,i,u))}else if(r-=a.size,this.trackRemovals){const u=ih(this.Yn.yt,o.convertToNoDocument(C.min()));t.push(this.Yn.addEntry(e,i,u))}}),s.forEach(i=>{t.push(this.Yn.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.Yn.updateMetadata(e,r)),f.waitFor(t)}getFromCache(e,t){return this.Yn.Wn(e,t).next(r=>(this.Xn.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.Yn.Hn(e,t).next(({documents:r,Jn:s})=>(s.forEach((i,o)=>{this.Xn.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function bh(n){return de(n,"remoteDocumentGlobal")}function Gt(n){return de(n,"remoteDocumentsV14")}function wr(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Ch(n,e){const t=e.documentKey.path.toArray();return[n,Cs(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Dh(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=A(t[i],r[i]),s)return s;return s=A(t.length,r.length),s||(s=A(t[t.length-2],r[r.length-2]),s||A(t[t.length-1],r[r.length-1]))}class Jg{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Ah{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(null!==r&&or(r.mutation,s,Re.empty(),Z.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,N()).next(()=>r))}getLocalViewOfDocuments(e,t,r=N()){const s=Pe();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=ar();return i.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Pe();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,N()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=be();const o=ur(),a=ur();return t.forEach((u,c)=>{const l=r.get(c.key);s.has(c.key)&&(void 0===l||l.mutation instanceof Ze)?i=i.insert(c.key,c):void 0!==l&&(o.set(c.key,l.mutation.getFieldMask()),or(l.mutation,c,l.mutation.getFieldMask(),Z.now()))}),this.recalculateAndSaveOverlays(e,i).next(u=>(u.forEach((c,l)=>o.set(c,l)),t.forEach((c,l)=>{var h;return a.set(c,new Jg(l,null!==(h=o.get(c))&&void 0!==h?h:null))}),a))}recalculateAndSaveOverlays(e,t){const r=ur();let s=new ee((o,a)=>o-a),i=N();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(u=>{const c=t.get(u);if(null===c)return;let l=r.get(u)||Re.empty();l=a.applyToLocalView(c,l),r.set(u,l);const h=(s.get(a.batchId)||N()).add(u);s=s.insert(a.batchId,h)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const u=a.getNext(),c=u.key,l=u.value,h=Ll();l.forEach(d=>{if(!i.has(d)){const g=bl(t.get(d),r.get(d));null!==g&&h.set(d,g),i=i.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return f.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r){return _.isDocumentKey((s=t).path)&&null===s.collectionGroup&&0===s.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):ho(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r):this.getDocumentsMatchingCollectionQuery(e,t,r);var s}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):f.resolve(Pe());let a=-1,u=i;return o.next(c=>f.forEach(c,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),i.get(l)?f.resolve():this.remoteDocumentCache.getEntry(e,l).next(d=>{u=u.insert(l,d)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,u,c,N())).next(l=>({batchId:a,changes:Ml(l)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new _(t)).next(r=>{let s=ar();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r){const s=t.collectionGroup;let i=ar();return this.indexManager.getCollectionParents(e,s).next(o=>f.forEach(o,a=>{const u=(c=t,l=a.child(s),new Qe(l,null,c.explicitOrderBy.slice(),c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt));var c,l;return this.getDocumentsMatchingCollectionQuery(e,u,r).next(c=>{c.forEach((l,h)=>{i=i.insert(l,h)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,r){let s;return this.remoteDocumentCache.getAllFromCollection(e,t.path,r).next(i=>(s=i,this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId))).next(i=>{i.forEach((a,u)=>{const c=u.getKey();null===s.get(c)&&(s=s.insert(c,j.newInvalidDocument(c)))});let o=ar();return s.forEach((a,u)=>{const c=i.get(a);void 0!==c&&or(c.mutation,u,Re.empty(),Z.now()),go(t,u)&&(o=o.insert(a,u))}),o})}}class ep{constructor(e){this.yt=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,t){return f.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){var r;return this.Zn.set(t.id,{id:(r=t).id,version:r.version,createTime:se(r.createTime)}),f.resolve()}getNamedQuery(e,t){return f.resolve(this.ts.get(t))}saveNamedQuery(e,t){return this.ts.set(t.name,{name:(r=t).name,query:So(r.bundledQuery),readTime:se(r.readTime)}),f.resolve();var r}}class tp{constructor(){this.overlays=new ee(_.comparator),this.es=new Map}getOverlay(e,t){return f.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Pe();return f.forEach(t,s=>this.getOverlay(e,s).next(i=>{null!==i&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.oe(e,t,i)}),f.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.es.get(r);return void 0!==s&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.es.delete(r)),f.resolve()}getOverlaysForCollection(e,t,r){const s=Pe(),i=t.length+1,o=new _(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&u.largestBatchId>r&&s.set(u.getKey(),u)}return f.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new ee((c,l)=>c-l);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let l=i.get(c.largestBatchId);null===l&&(l=Pe(),i=i.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}const a=Pe(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=s)););return f.resolve(a)}oe(e,t,r){const s=this.overlays.get(r.key);if(null!==s){const o=this.es.get(s.largestBatchId).delete(r.key);this.es.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new To(t,r));let i=this.es.get(t);void 0===i&&(i=N(),this.es.set(t,i)),this.es.set(t,i.add(r.key))}}class Ro{constructor(){this.ns=new B(fe.ss),this.rs=new B(fe.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){const r=new fe(e,t);this.ns=this.ns.add(r),this.rs=this.rs.add(r)}us(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.cs(new fe(e,t))}hs(e,t){e.forEach(r=>this.removeReference(r,t))}ls(e){const t=new _(new F([])),r=new fe(t,e),s=new fe(t,e+1),i=[];return this.rs.forEachInRange([r,s],o=>{this.cs(o),i.push(o.key)}),i}fs(){this.ns.forEach(e=>this.cs(e))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){const t=new _(new F([])),r=new fe(t,e),s=new fe(t,e+1);let i=N();return this.rs.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new fe(e,0),r=this.ns.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class fe{constructor(e,t){this.key=e,this._s=t}static ss(e,t){return _.comparator(e.key,t.key)||A(e._s,t._s)}static os(e,t){return A(e._s,t._s)||_.comparator(e.key,t.key)}}class np{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this.gs=new B(fe.ss)}checkEmpty(e){return f.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,s){const i=this.ws;this.ws++;const o=new xo(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.gs=this.gs.add(new fe(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return f.resolve(o)}lookupMutationBatch(e,t){return f.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){const s=this.ps(t+1),i=s<0?0:s;return f.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return f.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(e){return f.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new fe(t,0),s=new fe(t,Number.POSITIVE_INFINITY),i=[];return this.gs.forEachInRange([r,s],o=>{const a=this.ys(o._s);i.push(a)}),f.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new B(A);return t.forEach(s=>{const i=new fe(s,0),o=new fe(s,Number.POSITIVE_INFINITY);this.gs.forEachInRange([i,o],a=>{r=r.add(a._s)})}),f.resolve(this.Is(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;_.isDocumentKey(i)||(i=i.child(""));const o=new fe(new _(i),0);let a=new B(A);return this.gs.forEachWhile(u=>{const c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(u._s)),!0)},o),f.resolve(this.Is(a))}Is(e){const t=[];return e.forEach(r=>{const s=this.ys(r);null!==s&&t.push(s)}),t}removeMutationBatch(e,t){T(0===this.Ts(t.batchId,"removed")),this.mutationQueue.shift();let r=this.gs;return f.forEach(t.mutations,s=>{const i=new fe(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.gs=r})}An(e){}containsKey(e,t){const r=new fe(t,0),s=this.gs.firstAfterOrEqual(r);return f.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return f.resolve()}Ts(e,t){return this.ps(e)}ps(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ys(e){const t=this.ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class rp{constructor(e){this.Es=e,this.docs=new ee(_.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Es(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return f.resolve(r?r.document.mutableCopy():j.newInvalidDocument(t))}getEntries(e,t){let r=be();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():j.newInvalidDocument(s))}),f.resolve(r)}getAllFromCollection(e,t,r){let s=be();const i=new _(t.child("")),o=this.docs.getIteratorFrom(i);for(;o.hasNext();){const{key:a,value:{document:u}}=o.getNext();if(!t.isPrefixOf(a.path))break;a.path.length>t.length+1||no(Pc(u),r)<=0||(s=s.insert(u.key,u.mutableCopy()))}return f.resolve(s)}getAllFromCollectionGroup(e,t,r,s){E()}As(e,t){return f.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new sp(this)}getSize(e){return f.resolve(this.size)}}class sp extends Th{constructor(e){super(),this.Yn=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.Yn.addEntry(e,s)):this.Yn.removeEntry(r)}),f.waitFor(t)}getFromCache(e,t){return this.Yn.getEntry(e,t)}getAllFromCache(e,t){return this.Yn.getEntries(e,t)}}class ip{constructor(e){this.persistence=e,this.Rs=new ct(t=>Rt(t),rr),this.lastRemoteSnapshotVersion=C.min(),this.highestTargetId=0,this.bs=0,this.Ps=new Ro,this.targetCount=0,this.vs=Bt.Pn()}forEachTarget(e,t){return this.Rs.forEach((r,s)=>t(s)),f.resolve()}getLastRemoteSnapshotVersion(e){return f.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return f.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),f.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.bs&&(this.bs=t),f.resolve()}Dn(e){this.Rs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.vs=new Bt(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.Dn(t),this.targetCount+=1,f.resolve()}updateTargetData(e,t){return this.Dn(t),f.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),this.targetCount-=1,f.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Rs.forEach((o,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.Rs.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),f.waitFor(i).next(()=>s)}getTargetCount(e){return f.resolve(this.targetCount)}getTargetData(e,t){const r=this.Rs.get(t)||null;return f.resolve(r)}addMatchingKeys(e,t,r){return this.Ps.us(t,r),f.resolve()}removeMatchingKeys(e,t,r){this.Ps.hs(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),f.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),f.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Ps.ds(t);return f.resolve(r)}containsKey(e,t){return f.resolve(this.Ps.containsKey(t))}}class Nh{constructor(e,t){this.Vs={},this.overlays={},this.Ss=new ke(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new ip(this),this.indexManager=new jg,this.remoteDocumentCache=new rp(r=>this.referenceDelegate.xs(r)),this.yt=new sh(t),this.Ns=new ep(this.yt)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new tp,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Vs[e.toKey()];return r||(r=new np(t,this.referenceDelegate),this.Vs[e.toKey()]=r),r}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,t,r){w("MemoryPersistence","Starting transaction:",e);const s=new op(this.Ss.next());return this.referenceDelegate.ks(),r(s).next(i=>this.referenceDelegate.Os(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ms(e,t){return f.or(Object.values(this.Vs).map(r=>()=>r.containsKey(e,t)))}}class op extends Uc{constructor(e){super(),this.currentSequenceNumber=e}}class Ls{constructor(e){this.persistence=e,this.Fs=new Ro,this.$s=null}static Bs(e){return new Ls(e)}get Ls(){if(this.$s)return this.$s;throw E()}addReference(e,t,r){return this.Fs.addReference(r,t),this.Ls.delete(r.toString()),f.resolve()}removeReference(e,t,r){return this.Fs.removeReference(r,t),this.Ls.add(r.toString()),f.resolve()}markPotentiallyOrphaned(e,t){return this.Ls.add(t.toString()),f.resolve()}removeTarget(e,t){this.Fs.ls(t.targetId).forEach(s=>this.Ls.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Ls.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}ks(){this.$s=new Set}Os(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return f.forEach(this.Ls,r=>{const s=_.fromPath(r);return this.qs(e,s).next(i=>{i||t.removeEntry(s,C.min())})}).next(()=>(this.$s=null,t.apply(e)))}updateLimboDocument(e,t){return this.qs(e,t).next(r=>{r?this.Ls.delete(t.toString()):this.Ls.add(t.toString())})}xs(e){return 0}qs(e,t){return f.or([()=>f.resolve(this.Fs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ms(e,t)])}}class ap{constructor(e){this.yt=e}$(e,t,r,s){const i=new fs("createOrUpgrade",t);var a;r<1&&s>=1&&(e.createObjectStore("owner"),(a=e).createObjectStore("mutationQueues",{keyPath:"userId"}),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Jl,{unique:!0}),a.createObjectStore("documentMutations"),kh(e),function(a){a.createObjectStore("remoteDocuments")}(e));let o=f.resolve();return r<3&&s>=3&&(0!==r&&(function(a){a.deleteObjectStore("targetDocuments"),a.deleteObjectStore("targets"),a.deleteObjectStore("targetGlobal")}(e),kh(e)),o=o.next(()=>function(a){const u=a.store("targetGlobal"),c={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:C.min().toTimestamp(),targetCount:0};return u.put("targetGlobalKey",c)}(i))),r<4&&s>=4&&(0!==r&&(o=o.next(()=>function(a,u){return u.store("mutations").W().next(c=>{a.deleteObjectStore("mutations"),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Jl,{unique:!0});const l=u.store("mutations"),h=c.map(d=>l.put(d));return f.waitFor(h)})}(e,i))),o=o.next(()=>{!function(a){a.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&s>=5&&(o=o.next(()=>this.Us(i))),r<6&&s>=6&&(o=o.next(()=>(function(a){a.createObjectStore("remoteDocumentGlobal")}(e),this.Ks(i)))),r<7&&s>=7&&(o=o.next(()=>this.Gs(i))),r<8&&s>=8&&(o=o.next(()=>this.Qs(e,i))),r<9&&s>=9&&(o=o.next(()=>{!function(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")}(e)})),r<10&&s>=10&&(o=o.next(()=>this.js(i))),r<11&&s>=11&&(o=o.next(()=>{(function(a){a.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(a){a.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{!function(a){const u=a.createObjectStore("documentOverlays",{keyPath:kg});u.createIndex("collectionPathOverlayIndex",Rg,{unique:!1}),u.createIndex("collectionGroupOverlayIndex",Fg,{unique:!1})}(e)})),r<13&&s>=13&&(o=o.next(()=>function(a){const u=a.createObjectStore("remoteDocumentsV14",{keyPath:_g});u.createIndex("documentKeyIndex",Ig),u.createIndex("collectionGroupIndex",xg)}(e)).next(()=>this.Ws(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.zs(e,i))),r<15&&s>=15&&(o=o.next(()=>function(a){a.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),a.createObjectStore("indexState",{keyPath:Cg}).createIndex("sequenceNumberIndex",Dg,{unique:!1}),a.createObjectStore("indexEntries",{keyPath:Ag}).createIndex("documentKeyIndex",Ng,{unique:!1})}(e))),o}Ks(e){let t=0;return e.store("remoteDocuments").Z((r,s)=>{t+=Rs(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Us(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.W().next(s=>f.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",o).next(a=>f.forEach(a,u=>{T(u.userId===i.userId);const c=Pt(this.yt,u);return wh(e,i.userId,c).next(()=>{})}))}))}Gs(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.Z((o,a)=>{const u=new F(o),c=[0,Ee(u)];i.push(t.get(c).next(l=>l?f.resolve():t.put({targetId:0,path:Ee(u),sequenceNumber:s.highestListenSequenceNumber})))}).next(()=>f.waitFor(i))})}Qs(e,t){e.createObjectStore("collectionParents",{keyPath:bg});const r=t.store("collectionParents"),s=new ko,i=o=>{if(s.add(o)){const a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:Ee(u)})}};return t.store("remoteDocuments").Z({X:!0},(o,a)=>{const u=new F(o);return i(u.popLast())}).next(()=>t.store("documentMutations").Z({X:!0},([o,a,u],c)=>{const l=Ue(a);return i(l.popLast())}))}js(e){const t=e.store("targets");return t.Z((r,s)=>{const i=mr(s),o=oh(this.yt,i);return t.put(o)})}Ws(e,t){const r=t.store("remoteDocuments"),s=[];return r.Z((i,o)=>{const a=t.store("remoteDocumentsV14"),u=(c=o,c.document?new _(F.fromString(c.document.name).popFirst(5)):c.noDocument?_.fromSegments(c.noDocument.path):c.unknownDocument?_.fromSegments(c.unknownDocument.path):E()).path.toArray();var c;const l={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(l))}).next(()=>f.waitFor(s))}zs(e,t){const r=t.store("mutations"),s=Sh(this.yt),i=new Nh(Ls.Bs,this.yt.ie);return r.W().next(o=>{const a=new Map;return o.forEach(u=>{var c;let l=null!==(c=a.get(u.userId))&&void 0!==c?c:N();Pt(this.yt,u).keys().forEach(h=>l=l.add(h)),a.set(u.userId,l)}),f.forEach(a,(u,c)=>{const l=new he(c),h=Ds.re(this.yt,l),d=i.getIndexManager(l),g=Fs.re(l,this.yt,d,i.referenceDelegate);return new Ah(s,g,h,d).recalculateAndSaveOverlaysForDocumentKeys(new Io(t,ke.at),u).next()})})}}function kh(n){n.createObjectStore("targetDocuments",{keyPath:Tg}).createIndex("documentTargetsIndex",Sg,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Eg,{unique:!0}),n.createObjectStore("targetGlobal")}const Fo="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Mo{constructor(e,t,r,s,i,o,a,u,c,l,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Hs=i,this.window=o,this.document=a,this.Js=c,this.Ys=l,this.Xs=h,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=d=>Promise.resolve(),!Mo.C())throw new y(m.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Wg(this,s),this.ii=t+"main",this.yt=new sh(u),this.ri=new Le(this.ii,this.Xs,new ap(this.yt)),this.Cs=new zg(this.referenceDelegate,this.yt),this.remoteDocumentCache=Sh(this.yt),this.Ns=new Vg,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,!1===l&&re("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new y(m.FAILED_PRECONDITION,Fo);return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Cs.getHighestSequenceNumber(e))}).then(e=>{this.Ss=new ke(e,this.Js)}).then(()=>{this.Ds=!0}).catch(e=>(this.ri&&this.ri.close(),Promise.reject(e)))}li(e){var t=this;return this.si=function(){var r=(0,p.Z)(function*(s){if(t.started)return e(s)});return function(s){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.ri.L(function(){var t=(0,p.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget((0,p.Z)(function*(){t.started&&(yield t.ui())})))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Os(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)))})}).next(()=>this.di(e)).next(t=>this.isPrimary&&!t?this._i(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(rt(e))return w("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return w("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Hs.enqueueRetryable(()=>this.si(e)),this.isPrimary=e})}fi(e){return _r(e).get("owner").next(t=>f.resolve(this.mi(t)))}gi(e){return Os(e).delete(this.clientId)}yi(){var e=this;return(0,p.Z)(function*(){if(e.isPrimary&&!e.pi(e.ni,18e5)){e.ni=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const s=de(r,"clientMetadata");return s.W().next(i=>{const o=e.Ii(i,18e5),a=i.filter(u=>-1===o.indexOf(u));return f.forEach(a,u=>s.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(e.oi)for(const r of t)e.oi.removeItem(e.Ti(r.clientId))}})()}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ui().then(()=>this.yi()).then(()=>this.hi()))}mi(e){return!!e&&e.ownerId===this.clientId}di(e){return this.Ys?f.resolve(!0):_r(e).get("owner").next(t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)){if(this.mi(t)&&this.networkEnabled)return!0;if(!this.mi(t)){if(!t.allowTabSynchronization)throw new y(m.FAILED_PRECONDITION,Fo);return!1}}return!(!this.networkEnabled||!this.inForeground)||Os(e).W().next(r=>void 0===this.Ii(r,5e3).find(s=>{if(this.clientId!==s.clientId){const o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(!this.networkEnabled&&s.networkEnabled||o&&a)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&w("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,p.Z)(function*(){e.Ds=!1,e.Ai(),e.ei&&(e.ei.cancel(),e.ei=null),e.Ri(),e.bi(),yield e.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const r=new Io(t,ke.at);return e._i(r).next(()=>e.gi(r))}),e.ri.close(),e.Pi()})()}Ii(e,t){return e.filter(r=>this.pi(r.updateTimeMs,t)&&!this.Ei(r.clientId))}vi(){return this.runTransaction("getActiveClients","readonly",e=>Os(e).W().next(t=>this.Ii(t,18e5).map(r=>r.clientId)))}get started(){return this.Ds}getMutationQueue(e,t){return Fs.re(e,this.yt,t,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new $g(e,this.yt.ie.databaseId)}getDocumentOverlayCache(e){return Ds.re(this.yt,e)}getBundleCache(){return this.Ns}runTransaction(e,t,r){w("IndexedDbPersistence","Starting transaction:",e);const s="readonly"===t?"readonly":"readwrite",i=15===(o=this.Xs)?Lg:14===o?rh:13===o?nh:12===o?Mg:11===o?th:void E();var o;let a;return this.ri.runTransaction(e,s,i,u=>(a=new Io(u,this.Ss?this.Ss.next():ke.at),"readwrite-primary"===t?this.fi(a).next(c=>!!c||this.di(a)).next(c=>{if(!c)throw re(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)),new y(m.FAILED_PRECONDITION,qc);return r(a)}).next(c=>this.wi(a).next(()=>c)):this.Vi(a).next(()=>r(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}Vi(e){return _r(e).get("owner").next(t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)&&!this.mi(t)&&!(this.Ys||this.allowTabSynchronization&&t.allowTabSynchronization))throw new y(m.FAILED_PRECONDITION,Fo)})}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return _r(e).put("owner",t)}static C(){return Le.C()}_i(e){const t=_r(e);return t.get("owner").next(r=>this.mi(r)?(w("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):f.resolve())}pi(e,t){const r=Date.now();return!(e<r-t||e>r&&(re(`Detected an update time that is in the future: ${e} > ${r}`),1))}ci(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ti=()=>{this.Hs.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.ui()))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground="visible"===this.document.visibilityState)}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Zs=()=>{this.Ai(),(0,K.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(e){var t;try{const r=null!==(null===(t=this.oi)||void 0===t?void 0:t.getItem(this.Ti(e)));return w("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return re("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){re("Failed to set zombie client id.",e)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch(e){}}Ti(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function _r(n){return de(n,"owner")}function Os(n){return de(n,"clientMetadata")}function Lo(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class Oo{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Si=r,this.Di=s}static Ci(e,t){let r=N(),s=N();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Oo(e,t.fromCache,r,s)}}class Rh{constructor(){this.xi=!1}initialize(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}getDocumentsMatchingQuery(e,t,r,s){return this.ki(e,t).next(i=>i||this.Oi(e,t,s,r)).next(i=>i||this.Mi(e,t))}ki(e,t){if(ml(t))return f.resolve(null);let r=xe(t);return this.indexManager.getIndexType(e,r).next(s=>0===s?null:(null!==t.limit&&1===s&&(t=_s(t,null,"F"),r=xe(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=N(...i);return this.Ni.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{const c=this.Fi(t,a);return this.$i(t,c,o,u.readTime)?this.ki(e,_s(t,null,"F")):this.Bi(e,c,t,u)}))})))}Oi(e,t,r,s){return ml(t)||s.isEqual(C.min())?this.Mi(e,t):this.Ni.getDocuments(e,r).next(i=>{const o=this.Fi(t,i);return this.$i(t,o,r,s)?this.Mi(e,t):(Ji()<=_t.in.DEBUG&&w("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),mo(t)),this.Bi(e,o,t,Vc(s,-1)))})}Fi(e,t){let r=new B(yl(e));return t.forEach((s,i)=>{go(e,i)&&(r=r.add(i))}),r}$i(e,t,r,s){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Mi(e,t){return Ji()<=_t.in.DEBUG&&w("QueryEngine","Using full collection scan to execute query:",mo(t)),this.Ni.getDocumentsMatchingQuery(e,t,Ne.min())}Bi(e,t,r,s){return this.Ni.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}class up{constructor(e,t,r,s){this.persistence=e,this.Li=t,this.yt=s,this.qi=new ee(A),this.Ui=new ct(i=>Rt(i),rr),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(r)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ah(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.qi))}}function Fh(n,e,t,r){return new up(n,e,t,r)}function Mh(n,e){return Vo.apply(this,arguments)}function Vo(){return Vo=(0,p.Z)(function*(n,e){const t=I(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.Qi(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let u=N();for(const c of s){o.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}for(const c of i){a.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}return t.localDocuments.getDocuments(r,u).next(c=>({ji:c,removedBatchIds:o,addedBatchIds:a}))})})}),Vo.apply(this,arguments)}function cp(n,e){const t=I(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.Gi.newChangeBuffer({trackRemovals:!0});return function(o,a,u,c){const l=u.batch,h=l.keys();let d=f.resolve();return h.forEach(g=>{d=d.next(()=>c.getEntry(a,g)).next(v=>{const x=u.docVersions.get(g);T(null!==x),v.version.compareTo(x)<0&&(l.applyToRemoteDocument(v,u),v.isValidDocument()&&(v.setReadTime(u.commitVersion),c.addEntry(v)))})}),d.next(()=>o.mutationQueue.removeMutationBatch(a,l))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(o){let a=N();for(let u=0;u<o.mutationResults.length;++u)o.mutationResults[u].transformResults.length>0&&(a=a.add(o.batch.mutations[u].key));return a}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function Lh(n){const e=I(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Cs.getLastRemoteSnapshotVersion(t))}function lp(n,e){const t=I(n),r=e.snapshotVersion;let s=t.qi;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Gi.newChangeBuffer({trackRemovals:!0});s=t.qi;const a=[];e.targetChanges.forEach((l,h)=>{const d=s.get(h);if(!d)return;a.push(t.Cs.removeMatchingKeys(i,l.removedDocuments,h).next(()=>t.Cs.addMatchingKeys(i,l.addedDocuments,h)));let g=d.withSequenceNumber(i.currentSequenceNumber);var v,x,b;e.targetMismatches.has(h)?g=g.withResumeToken(ue.EMPTY_BYTE_STRING,C.min()).withLastLimboFreeSnapshotVersion(C.min()):l.resumeToken.approximateByteSize()>0&&(g=g.withResumeToken(l.resumeToken,r)),s=s.insert(h,g),x=g,b=l,(0===(v=d).resumeToken.approximateByteSize()||x.snapshotVersion.toMicroseconds()-v.snapshotVersion.toMicroseconds()>=3e8||b.addedDocuments.size+b.modifiedDocuments.size+b.removedDocuments.size>0)&&a.push(t.Cs.updateTargetData(i,g))});let u=be(),c=N();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,l))}),a.push(Oh(i,o,e.documentUpdates).next(l=>{u=l.Wi,c=l.zi})),!r.isEqual(C.min())){const l=t.Cs.getLastRemoteSnapshotVersion(i).next(h=>t.Cs.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(l)}return f.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,u,c)).next(()=>u)}).then(i=>(t.qi=s,i))}function Oh(n,e,t){let r=N(),s=N();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=be();return t.forEach((a,u)=>{const c=i.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),u.isNoDocument()&&u.version.isEqual(C.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||0===u.version.compareTo(c.version)&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):w("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{Wi:o,zi:s}})}function hp(n,e){const t=I(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function yn(n,e){const t=I(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Cs.getTargetData(r,e).next(i=>i?(s=i,f.resolve(s)):t.Cs.allocateTargetId(r).next(o=>(s=new lt(e,o,0,r.currentSequenceNumber),t.Cs.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.qi.get(r.targetId);return(null===s||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.qi=t.qi.insert(r.targetId,r),t.Ui.set(e,r.targetId)),r})}function vn(n,e,t){return Po.apply(this,arguments)}function Po(){return Po=(0,p.Z)(function*(n,e,t){const r=I(n),s=r.qi.get(e),i=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s)))}catch(o){if(!rt(o))throw o;w("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.qi=r.qi.remove(e),r.Ui.delete(s.target)}),Po.apply(this,arguments)}function Vs(n,e,t){const r=I(n);let s=C.min(),i=N();return r.persistence.runTransaction("Execute query","readonly",o=>function(a,u,c){const l=I(a),h=l.Ui.get(c);return void 0!==h?f.resolve(l.qi.get(h)):l.Cs.getTargetData(u,c)}(r,o,xe(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Cs.getMatchingKeysForTargetId(o,a.targetId).next(u=>{i=u})}).next(()=>r.Li.getDocumentsMatchingQuery(o,e,t?s:C.min(),t?i:N())).next(a=>(qh(r,pl(e),a),{documents:a,Hi:i})))}function Vh(n,e){const t=I(n),r=I(t.Cs),s=t.qi.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ne(i,e).next(o=>o?o.target:null))}function Ph(n,e){const t=I(n),r=t.Ki.get(e)||C.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.Gi.getAllFromCollectionGroup(s,e,Vc(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(qh(t,e,s),s))}function qh(n,e,t){let r=n.Ki.get(e)||C.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.Ki.set(e,r)}function qo(){return qo=(0,p.Z)(function*(n,e,t,r){const s=I(n);let i=N(),o=be();for(const c of t){const l=e.Ji(c.metadata.name);c.document&&(i=i.add(l));const h=e.Yi(c);h.setReadTime(e.Xi(c.metadata.readTime)),o=o.insert(l,h)}const a=s.Gi.newChangeBuffer({trackRemovals:!0}),u=yield yn(s,(c=r,xe(an(F.fromString(`__bundle__/docs/${c}`)))));var c;return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>Oh(c,a,o).next(l=>(a.apply(c),l)).next(l=>s.Cs.removeMatchingKeysForTargetId(c,u.targetId).next(()=>s.Cs.addMatchingKeys(c,i,u.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,l.Wi,l.zi)).next(()=>l.Wi)))}),qo.apply(this,arguments)}function fp(n,e){return Uo.apply(this,arguments)}function Uo(){return Uo=(0,p.Z)(function*(n,e,t=N()){const r=yield yn(n,xe(So(e.bundledQuery))),s=I(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=se(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Ns.saveNamedQuery(i,e);const a=r.withResumeToken(ue.EMPTY_BYTE_STRING,o);return s.qi=s.qi.insert(a.targetId,a),s.Cs.updateTargetData(i,a).next(()=>s.Cs.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Cs.addMatchingKeys(i,t,r.targetId)).next(()=>s.Ns.saveNamedQuery(i,e))})}),Uo.apply(this,arguments)}function Uh(n,e){return`firestore_clients_${n}_${e}`}function Bh(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Bo(n,e){return`firestore_targets_${n}_${e}`}class Ps{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Zi(e,t,r){const s=JSON.parse(r);let i,o="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return o&&s.error&&(o="string"==typeof s.error.message&&"string"==typeof s.error.code,o&&(i=new y(s.error.code,s.error.message))),o?new Ps(e,t,s.state,i):(re("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ir{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Zi(e,t){const r=JSON.parse(t);let s,i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code,i&&(s=new y(r.error.code,r.error.message))),i?new Ir(e,r.state,s):(re("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class qs{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Zi(e,t){const r=JSON.parse(t);let s="object"==typeof r&&r.activeTargetIds instanceof Array,i=Ts();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=jc(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new qs(e,i):(re("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Go{constructor(e,t){this.clientId=e,this.onlineState=t}static Zi(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Go(t.clientId,t.onlineState):(re("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Ko{constructor(){this.activeTargetIds=Ts()}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class jo{constructor(e,t,r,s,i){this.window=e,this.Hs=t,this.persistenceKey=r,this.sr=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ir=this.rr.bind(this),this.ur=new ee(A),this.started=!1,this.cr=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ar=Uh(this.persistenceKey,this.sr),this.hr=`firestore_sequence_number_${this.persistenceKey}`,this.ur=this.ur.insert(this.sr,new Ko),this.lr=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.dr=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this._r=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.wr=`firestore_online_state_${this.persistenceKey}`,this.mr=function(a){return`firestore_bundle_loaded_v2_${a}`}(this.persistenceKey),this.window.addEventListener("storage",this.ir)}static C(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,p.Z)(function*(){const t=yield e.syncEngine.vi();for(const s of t){if(s===e.sr)continue;const i=e.getItem(Uh(e.persistenceKey,s));if(i){const o=qs.Zi(s,i);o&&(e.ur=e.ur.insert(o.clientId,o))}}e.gr();const r=e.storage.getItem(e.wr);if(r){const s=e.yr(r);s&&e.pr(s)}for(const s of e.cr)e.rr(s);e.cr=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.hr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ir(this.ur)}isActiveQueryTarget(e){let t=!1;return this.ur.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Tr(e,"pending")}updateMutationState(e,t,r){this.Tr(e,t,r),this.Er(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(Bo(this.persistenceKey,e));if(r){const s=Ir.Zi(e,r);s&&(t=s.state)}}return this.Ar.er(e),this.gr(),t}removeLocalQueryTarget(e){this.Ar.nr(e),this.gr()}isLocalQueryTarget(e){return this.Ar.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Bo(this.persistenceKey,e))}updateQueryState(e,t,r){this.Rr(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Er(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.br(e)}notifyBundleLoaded(e){this.Pr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ir),this.removeItem(this.ar),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return w("SharedClientState","READ",e,t),t}setItem(e,t){w("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){w("SharedClientState","REMOVE",e),this.storage.removeItem(e)}rr(e){var t=this;const r=e;if(r.storageArea===this.storage){if(w("SharedClientState","EVENT",r.key,r.newValue),r.key===this.ar)return void re("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Hs.enqueueRetryable((0,p.Z)(function*(){if(t.started){if(null!==r.key)if(t.lr.test(r.key)){if(null==r.newValue){const s=t.vr(r.key);return t.Vr(s,null)}{const s=t.Sr(r.key,r.newValue);if(s)return t.Vr(s.clientId,s)}}else if(t.dr.test(r.key)){if(null!==r.newValue){const s=t.Dr(r.key,r.newValue);if(s)return t.Cr(s)}}else if(t._r.test(r.key)){if(null!==r.newValue){const s=t.Nr(r.key,r.newValue);if(s)return t.kr(s)}}else if(r.key===t.wr){if(null!==r.newValue){const s=t.yr(r.newValue);if(s)return t.pr(s)}}else if(r.key===t.hr){const s=function(i){let o=ke.at;if(null!=i)try{const a=JSON.parse(i);T("number"==typeof a),o=a}catch(a){re("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(r.newValue);s!==ke.at&&t.sequenceNumberHandler(s)}else if(r.key===t.mr){const s=t.Or(r.newValue);yield Promise.all(s.map(i=>t.syncEngine.Mr(i)))}}else t.cr.push(r)}))}}get Ar(){return this.ur.get(this.sr)}gr(){this.setItem(this.ar,this.Ar.tr())}Tr(e,t,r){const s=new Ps(this.currentUser,e,t,r),i=Bh(this.persistenceKey,this.currentUser,e);this.setItem(i,s.tr())}Er(e){const t=Bh(this.persistenceKey,this.currentUser,e);this.removeItem(t)}br(e){this.storage.setItem(this.wr,JSON.stringify({clientId:this.sr,onlineState:e}))}Rr(e,t,r){const s=Bo(this.persistenceKey,e),i=new Ir(e,t,r);this.setItem(s,i.tr())}Pr(e){const t=JSON.stringify(Array.from(e));this.setItem(this.mr,t)}vr(e){const t=this.lr.exec(e);return t?t[1]:null}Sr(e,t){const r=this.vr(e);return qs.Zi(r,t)}Dr(e,t){const r=this.dr.exec(e),s=Number(r[1]);return Ps.Zi(new he(void 0!==r[2]?r[2]:null),s,t)}Nr(e,t){const r=this._r.exec(e),s=Number(r[1]);return Ir.Zi(s,t)}yr(e){return Go.Zi(e)}Or(e){return JSON.parse(e)}Cr(e){var t=this;return(0,p.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Fr(e.batchId,e.state,e.error);w("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}kr(e){return this.syncEngine.$r(e.targetId,e.state,e.error)}Vr(e,t){const r=t?this.ur.insert(e,t):this.ur.remove(e),s=this.Ir(this.ur),i=this.Ir(r),o=[],a=[];return i.forEach(u=>{s.has(u)||o.push(u)}),s.forEach(u=>{i.has(u)||a.push(u)}),this.syncEngine.Br(o,a).then(()=>{this.ur=r})}pr(e){this.ur.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ir(e){let t=Ts();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class Gh{constructor(){this.Lr=new Ko,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.Lr.er(e),this.qr[e]||"not-current"}updateQueryState(e,t,r){this.qr[e]=t}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.qr[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new Ko,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class mp{Ur(e){}shutdown(){}}class Kh{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}Ur(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){w("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){w("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const gp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class pp{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}class yp extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.oo=(e.ssl?"https":"http")+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(e,t,r,s,i){const o=this.ho(e,t);w("RestConnection","Sending: ",o,r);const a={};return this.lo(a,s,i),this.fo(e,o,a,r).then(u=>(w("RestConnection","Received: ",u),u),u=>{throw St("RestConnection",`${e} failed with error: `,u,"url: ",o,"request:",r),u})}_o(e,t,r,s,i,o){return this.ao(e,t,r,s,i)}lo(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+en,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}ho(e,t){return`${this.oo}/v1/${t}:${gp[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,t,r,s){return new Promise((i,o)=>{const a=new pm;a.setWithCredentials(!0),a.listenOnce(fm.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case Xi.NO_ERROR:const c=a.getResponseJson();w("Connection","XHR received:",JSON.stringify(c)),i(c);break;case Xi.TIMEOUT:w("Connection",'RPC "'+e+'" timed out'),o(new y(m.DEADLINE_EXCEEDED,"Request time out"));break;case Xi.HTTP_ERROR:const l=a.getStatus();if(w("Connection",'RPC "'+e+'" failed with status:',l,"response text:",a.getResponseText()),l>0){let h=a.getResponseJson();Array.isArray(h)&&(h=h[0]);const d=null==h?void 0:h.error;if(d&&d.status&&d.message){const g=function(v){const x=v.toLowerCase().replace(/_/g,"-");return Object.values(m).indexOf(x)>=0?x:m.UNKNOWN}(d.status);o(new y(g,d.message))}else o(new y(m.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new y(m.UNAVAILABLE,"Connection failed."));break;default:E()}}finally{w("Connection",'RPC "'+e+'" completed.')}});const u=JSON.stringify(s);a.send(t,"POST",u,r,15)})}wo(e,t,r){const s=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=hm(),o=dm(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new gm({})),this.lo(a.initMessageHeaders,t,r),a.encodeInitMessageHeaders=!0;const u=s.join("");w("Connection","Creating WebChannel: "+u,a);const c=i.createWebChannel(u,a);let l=!1,h=!1;const d=new pp({Hr:v=>{h?w("Connection","Not sending because WebChannel is closed:",v):(l||(w("Connection","Opening WebChannel transport."),c.open(),l=!0),w("Connection","WebChannel sending:",v),c.send(v))},Jr:()=>c.close()}),g=(v,x,b)=>{v.listen(x,G=>{try{b(G)}catch(W){setTimeout(()=>{throw W},0)}})};return g(c,ls.EventType.OPEN,()=>{h||w("Connection","WebChannel transport opened.")}),g(c,ls.EventType.CLOSE,()=>{h||(h=!0,w("Connection","WebChannel transport closed"),d.io())}),g(c,ls.EventType.ERROR,v=>{h||(h=!0,St("Connection","WebChannel transport errored:",v),d.io(new y(m.UNAVAILABLE,"The operation could not be completed")))}),g(c,ls.EventType.MESSAGE,v=>{var x;if(!h){const b=v.data[0];T(!!b);const G=b,W=G.error||(null===(x=G[0])||void 0===x?void 0:x.error);if(W){w("Connection","WebChannel received error:",W);const L=W.status;let te=function(P){const ce=oe[P];if(void 0!==ce)return Rl(ce)}(L),V=W.message;void 0===te&&(te=m.INTERNAL,V="Unknown error status: "+L+" with message "+W.message),h=!0,d.io(new y(te,V)),c.close()}else w("Connection","WebChannel received:",b),d.ro(b)}}),g(o,mm.STAT_EVENT,v=>{v.stat===kc.PROXY?w("Connection","Detected buffering proxy"):v.stat===kc.NOPROXY&&w("Connection","Detected no buffering proxy")}),setTimeout(()=>{d.so()},0),d}}function jh(){return typeof window<"u"?window:null}function Us(){return typeof document<"u"?document:null}function xr(n){return new ug(n,!0)}class $o{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Hs=e,this.timerId=t,this.mo=r,this.yo=s,this.po=i,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const t=Math.floor(this.Io+this.bo()),r=Math.max(0,Date.now()-this.Eo),s=Math.max(0,t-r);s>0&&w("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,s,()=>(this.Eo=Date.now(),e())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class $h{constructor(e,t,r,s,i,o,a,u){this.Hs=e,this.vo=r,this.Vo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new $o(e,t)}No(){return 1===this.state||5===this.state||this.ko()}ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}stop(){var e=this;return(0,p.Z)(function*(){e.No()&&(yield e.close(0))})()}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&null===this.Do&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,()=>this.$o()))}Bo(e){this.Lo(),this.stream.send(e)}$o(){var e=this;return(0,p.Z)(function*(){if(e.ko())return e.close(0)})()}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}qo(){this.Co&&(this.Co.cancel(),this.Co=null)}close(e,t){var r=this;return(0,p.Z)(function*(){r.Lo(),r.qo(),r.xo.cancel(),r.So++,4!==e?r.xo.reset():t&&t.code===m.RESOURCE_EXHAUSTED?(re(t.toString()),re("Using maximum backoff delay to prevent overloading the backend."),r.xo.Ao()):t&&t.code===m.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.Uo(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.Zr(t)})()}Uo(){}auth(){this.state=1;const e=this.Ko(this.So),t=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.So===t&&this.Go(r,s)},r=>{e(()=>{const s=new y(m.UNKNOWN,"Fetching auth token failed: "+r.message);return this.Qo(s)})})}Go(e,t){const r=this.Ko(this.So);this.stream=this.jo(e,t),this.stream.Yr(()=>{r(()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,()=>(this.ko()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(s=>{r(()=>this.Qo(s))}),this.stream.onMessage(s=>{r(()=>this.onMessage(s))})}Oo(){var e=this;this.state=5,this.xo.Ro((0,p.Z)(function*(){e.state=0,e.start()}))}Qo(e){return w("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Ko(e){return t=>{this.Hs.enqueueAndForget(()=>this.So===e?t():(w("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class vp extends $h{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.yt=i}jo(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.xo.reset();const t=function hg(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(u=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===u?1:"REMOVE"===u?2:"CURRENT"===u?3:"RESET"===u?4:E(),s=e.targetChange.targetIds||[],i=function(u,c){return u.wt?(T(void 0===c||"string"==typeof c),ue.fromBase64String(c||"")):(T(void 0===c||c instanceof Uint8Array),ue.fromUint8Array(c||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const c=void 0===u.code?m.UNKNOWN:Rl(u.code);return new y(c,u.message||"")}(o);t=new Vl(r,s,i,a||null)}else if("documentChange"in e){const r=e.documentChange,s=qe(n,r.document.name),i=se(r.document.updateTime),o=r.document.createTime?se(r.document.createTime):C.min(),a=new ye({mapValue:{fields:r.document.fields}}),u=j.newFoundDocument(s,i,o,a);t=new Ss(r.targetIds||[],r.removedTargetIds||[],u.key,u)}else if("documentDelete"in e){const r=e.documentDelete,s=qe(n,r.document),i=r.readTime?se(r.readTime):C.min(),o=j.newNoDocument(s,i);t=new Ss([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const r=e.documentRemove,s=qe(n,r.document);t=new Ss([],r.removedTargetIds||[],s,null)}else{if(!("filter"in e))return E();{const r=e.filter,i=new Jm(r.count||0);t=new Ol(r.targetId,i)}}var u;return t}(this.yt,e),r=function(s){if(!("targetChange"in s))return C.min();const i=s.targetChange;return i.targetIds&&i.targetIds.length?C.min():i.readTime?se(i.readTime):C.min()}(e);return this.listener.Wo(t,r)}zo(e){const t={};t.database=dr(this.yt),t.addTarget=function(s,i){let o;const a=i.target;return o=ys(a)?{documents:Ql(s,a)}:{query:_o(s,a)},o.targetId=i.targetId,i.resumeToken.approximateByteSize()>0?o.resumeToken=Bl(s,i.resumeToken):i.snapshotVersion.compareTo(C.min())>0&&(o.readTime=dn(s,i.snapshotVersion.toTimestamp())),o}(this.yt,e);const r=function fg(n,e){const t=function(r,s){switch(s){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return E()}}(0,e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.Bo(t)}Ho(e){const t={};t.database=dr(this.yt),t.removeTarget=e,this.Bo(t)}}class wp extends $h{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.yt=i,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}Uo(){this.Jo&&this.Xo([])}jo(e,t){return this.connection.wo("Write",e,t)}onMessage(e){if(T(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Jo){this.xo.reset();const t=function dg(n,e){return n&&n.length>0?(T(void 0!==e),n.map(t=>function(r,s){let i=se(r.updateTime?r.updateTime:s);return i.isEqual(C.min())&&(i=se(s)),new Wm(i,r.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=se(e.commitTime);return this.listener.Zo(r,t)}return T(!e.writeResults||0===e.writeResults.length),this.Jo=!0,this.listener.tu()}eu(){const e={};e.database=dr(this.yt),this.Bo(e)}Xo(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>fr(this.yt,r))};this.Bo(t)}}class _p extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.yt=s,this.nu=!1}su(){if(this.nu)throw new y(m.FAILED_PRECONDITION,"The client has already been terminated.")}ao(e,t,r){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,i])=>this.connection.ao(e,t,r,s,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===m.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new y(m.UNKNOWN,s.toString())})}_o(e,t,r,s){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection._o(e,t,r,i,o,s)).catch(i=>{throw"FirebaseError"===i.name?(i.code===m.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new y(m.UNKNOWN,i.toString())})}terminate(){this.nu=!0}}class xp{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){0===this.iu&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve())))}hu(e){"Online"===this.state?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.cu("Offline")))}set(e){this.lu(),this.iu=0,"Online"===e&&(this.ou=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}au(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(re(t),this.ou=!1):w("OnlineStateTracker",t)}lu(){null!==this.ru&&(this.ru.cancel(),this.ru=null)}}class Ep{constructor(e,t,r,s,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=i,this.mu.Ur(a=>{r.enqueueAndForget((0,p.Z)(function*(){var u;He(o)&&(w("RemoteStore","Restarting streams for network reachability change."),yield(u=(0,p.Z)(function*(c){const l=I(c);l._u.add(4),yield wn(l),l.gu.set("Unknown"),l._u.delete(4),yield Er(l)}),function(c){return u.apply(this,arguments)})(o))}))}),this.gu=new xp(r,s)}}function Er(n){return Qo.apply(this,arguments)}function Qo(){return Qo=(0,p.Z)(function*(n){if(He(n))for(const e of n.wu)yield e(!0)}),Qo.apply(this,arguments)}function wn(n){return Zo.apply(this,arguments)}function Zo(){return Zo=(0,p.Z)(function*(n){for(const e of n.wu)yield e(!1)}),Zo.apply(this,arguments)}function Bs(n,e){const t=I(n);t.du.has(e.targetId)||(t.du.set(e.targetId,e),Yo(t)?Wo(t):In(t).ko()&&Ho(t,e))}function Tr(n,e){const t=I(n),r=In(t);t.du.delete(e),r.ko()&&zh(t,e),0===t.du.size&&(r.ko()?r.Fo():He(t)&&t.gu.set("Unknown"))}function Ho(n,e){n.yu.Ot(e.targetId),In(n).zo(e)}function zh(n,e){n.yu.Ot(e),In(n).Ho(e)}function Wo(n){n.yu=new sg({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ne:e=>n.du.get(e)||null}),In(n).start(),n.gu.uu()}function Yo(n){return He(n)&&!In(n).No()&&n.du.size>0}function He(n){return 0===I(n)._u.size}function Qh(n){n.yu=void 0}function Tp(n){return Xo.apply(this,arguments)}function Xo(){return Xo=(0,p.Z)(function*(n){n.du.forEach((e,t)=>{Ho(n,e)})}),Xo.apply(this,arguments)}function Sp(n,e){return Jo.apply(this,arguments)}function Jo(){return Jo=(0,p.Z)(function*(n,e){Qh(n),Yo(n)?(n.gu.hu(e),Wo(n)):n.gu.set("Unknown")}),Jo.apply(this,arguments)}function bp(n,e,t){return ea.apply(this,arguments)}function ea(){return ea=(0,p.Z)(function*(n,e,t){if(n.gu.set("Online"),e instanceof Vl&&2===e.state&&e.cause)try{yield(r=(0,p.Z)(function*(s,i){const o=i.cause;for(const a of i.targetIds)s.du.has(a)&&(yield s.remoteSyncer.rejectListen(a,o),s.du.delete(a),s.yu.removeTarget(a))}),function(s,i){return r.apply(this,arguments)})(n,e)}catch(r){w("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Gs(n,r)}else if(e instanceof Ss?n.yu.Kt(e):e instanceof Ol?n.yu.Jt(e):n.yu.jt(e),!t.isEqual(C.min()))try{const r=yield Lh(n.localStore);t.compareTo(r)>=0&&(yield function(s,i){const o=s.yu.Zt(i);return o.targetChanges.forEach((a,u)=>{if(a.resumeToken.approximateByteSize()>0){const c=s.du.get(u);c&&s.du.set(u,c.withResumeToken(a.resumeToken,i))}}),o.targetMismatches.forEach(a=>{const u=s.du.get(a);if(!u)return;s.du.set(a,u.withResumeToken(ue.EMPTY_BYTE_STRING,u.snapshotVersion)),zh(s,a);const c=new lt(u.target,a,1,u.sequenceNumber);Ho(s,c)}),s.remoteSyncer.applyRemoteEvent(o)}(n,t))}catch(r){w("RemoteStore","Failed to raise snapshot:",r),yield Gs(n,r)}var r}),ea.apply(this,arguments)}function Gs(n,e,t){return ta.apply(this,arguments)}function ta(){return ta=(0,p.Z)(function*(n,e,t){if(!rt(e))throw e;n._u.add(1),yield wn(n),n.gu.set("Offline"),t||(t=()=>Lh(n.localStore)),n.asyncQueue.enqueueRetryable((0,p.Z)(function*(){w("RemoteStore","Retrying IndexedDB access"),yield t(),n._u.delete(1),yield Er(n)}))}),ta.apply(this,arguments)}function Zh(n,e){return e().catch(t=>Gs(n,t,e))}function _n(n){return na.apply(this,arguments)}function na(){return na=(0,p.Z)(function*(n){const e=I(n),t=mt(e);let r=e.fu.length>0?e.fu[e.fu.length-1].batchId:-1;for(;Cp(e);)try{const s=yield hp(e.localStore,r);if(null===s){0===e.fu.length&&t.Fo();break}r=s.batchId,Dp(e,s)}catch(s){yield Gs(e,s)}Hh(e)&&Wh(e)}),na.apply(this,arguments)}function Cp(n){return He(n)&&n.fu.length<10}function Dp(n,e){n.fu.push(e);const t=mt(n);t.ko()&&t.Yo&&t.Xo(e.mutations)}function Hh(n){return He(n)&&!mt(n).No()&&n.fu.length>0}function Wh(n){mt(n).start()}function Ap(n){return ra.apply(this,arguments)}function ra(){return ra=(0,p.Z)(function*(n){mt(n).eu()}),ra.apply(this,arguments)}function Np(n){return sa.apply(this,arguments)}function sa(){return sa=(0,p.Z)(function*(n){const e=mt(n);for(const t of n.fu)e.Xo(t.mutations)}),sa.apply(this,arguments)}function kp(n,e,t){return ia.apply(this,arguments)}function ia(){return ia=(0,p.Z)(function*(n,e,t){const r=n.fu.shift(),s=Eo.from(r,e,t);yield Zh(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),yield _n(n)}),ia.apply(this,arguments)}function Rp(n,e){return oa.apply(this,arguments)}function oa(){return oa=(0,p.Z)(function*(n,e){var t;e&&mt(n).Yo&&(yield(t=(0,p.Z)(function*(r,s){if(kl(i=s.code)&&i!==m.ABORTED){const o=r.fu.shift();mt(r).Mo(),yield Zh(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield _n(r)}var i}),function(r,s){return t.apply(this,arguments)})(n,e)),Hh(n)&&Wh(n)}),oa.apply(this,arguments)}function Yh(n,e){return aa.apply(this,arguments)}function aa(){return aa=(0,p.Z)(function*(n,e){const t=I(n);t.asyncQueue.verifyOperationInProgress(),w("RemoteStore","RemoteStore received new credentials");const r=He(t);t._u.add(3),yield wn(t),r&&t.gu.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t._u.delete(3),yield Er(t)}),aa.apply(this,arguments)}function ua(n,e){return ca.apply(this,arguments)}function ca(){return ca=(0,p.Z)(function*(n,e){const t=I(n);e?(t._u.delete(2),yield Er(t)):e||(t._u.add(2),yield wn(t),t.gu.set("Unknown"))}),ca.apply(this,arguments)}function In(n){return n.pu||(n.pu=function(e,t,r){const s=I(e);return s.su(),new vp(t,s.connection,s.authCredentials,s.appCheckCredentials,s.yt,r)}(n.datastore,n.asyncQueue,{Yr:Tp.bind(null,n),Zr:Sp.bind(null,n),Wo:bp.bind(null,n)}),n.wu.push(function(){var e=(0,p.Z)(function*(t){t?(n.pu.Mo(),Yo(n)?Wo(n):n.gu.set("Unknown")):(yield n.pu.stop(),Qh(n))});return function(t){return e.apply(this,arguments)}}())),n.pu}function mt(n){return n.Iu||(n.Iu=function(e,t,r){const s=I(e);return s.su(),new wp(t,s.connection,s.authCredentials,s.appCheckCredentials,s.yt,r)}(n.datastore,n.asyncQueue,{Yr:Ap.bind(null,n),Zr:Rp.bind(null,n),tu:Np.bind(null,n),Zo:kp.bind(null,n)}),n.wu.push(function(){var e=(0,p.Z)(function*(t){t?(n.Iu.Mo(),yield _n(n)):(yield n.Iu.stop(),n.fu.length>0&&(w("RemoteStore",`Stopping write stream with ${n.fu.length} pending writes`),n.fu=[]))});return function(t){return e.apply(this,arguments)}}())),n.Iu}class la{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new ae,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new la(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new y(m.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function xn(n,e){if(re("AsyncQueue",`${e}: ${n}`),rt(n))return new y(m.UNAVAILABLE,`${e}: ${n}`);throw n}class En{constructor(e){this.comparator=e?(t,r)=>e(t,r)||_.comparator(t.key,r.key):(t,r)=>_.comparator(t.key,r.key),this.keyedMap=ar(),this.sortedSet=new ee(this.comparator)}static emptySet(e){return new En(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof En)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new En;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Xh{constructor(){this.Tu=new ee(_.comparator)}track(e){const t=e.doc.key,r=this.Tu.get(t);r?0!==e.type&&3===r.type?this.Tu=this.Tu.insert(t,e):3===e.type&&1!==r.type?this.Tu=this.Tu.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.Tu=this.Tu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.Tu=this.Tu.remove(t):1===e.type&&2===r.type?this.Tu=this.Tu.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):E():this.Tu=this.Tu.insert(t,e)}Eu(){const e=[];return this.Tu.inorderTraversal((t,r)=>{e.push(r)}),e}}class Tn{constructor(e,t,r,s,i,o,a,u,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Tn(e,t,En.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&sr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class Fp{constructor(){this.Au=void 0,this.listeners=[]}}class Mp{constructor(){this.queries=new ct(e=>gl(e),sr),this.onlineState="Unknown",this.Ru=new Set}}function ha(n,e){return da.apply(this,arguments)}function da(){return da=(0,p.Z)(function*(n,e){const t=I(n),r=e.query;let s=!1,i=t.queries.get(r);if(i||(s=!0,i=new Fp),s)try{i.Au=yield t.onListen(r)}catch(o){const a=xn(o,`Initialization of query '${mo(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,i),i.listeners.push(e),e.bu(t.onlineState),i.Au&&e.Pu(i.Au)&&ga(t)}),da.apply(this,arguments)}function fa(n,e){return ma.apply(this,arguments)}function ma(){return ma=(0,p.Z)(function*(n,e){const t=I(n),r=e.query;let s=!1;const i=t.queries.get(r);if(i){const o=i.listeners.indexOf(e);o>=0&&(i.listeners.splice(o,1),s=0===i.listeners.length)}if(s)return t.queries.delete(r),t.onUnlisten(r)}),ma.apply(this,arguments)}function Lp(n,e){const t=I(n);let r=!1;for(const s of e){const o=t.queries.get(s.query);if(o){for(const a of o.listeners)a.Pu(s)&&(r=!0);o.Au=s}}r&&ga(t)}function Op(n,e,t){const r=I(n),s=r.queries.get(e);if(s)for(const i of s.listeners)i.onError(t);r.queries.delete(e)}function ga(n){n.Ru.forEach(e=>{e.next()})}class pa{constructor(e,t,r){this.query=e,this.vu=t,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=r||{}}Pu(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)3!==s.type&&r.push(s);e=new Tn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),t=!0):this.Cu(e,this.onlineState)&&(this.xu(e),t=!0),this.Su=e,t}onError(e){this.vu.error(e)}bu(e){this.onlineState=e;let t=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),t=!0),t}Cu(e,t){return!e.fromCache||(!this.options.Nu||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Du(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}xu(e){e=Tn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Vu=!0,this.vu.next(e)}}class Vp{constructor(e,t){this.ku=e,this.byteLength=t}Ou(){return"metadata"in this.ku}}class Jh{constructor(e){this.yt=e}Ji(e){return qe(this.yt,e)}Yi(e){return e.metadata.exists?zl(this.yt,e.document,!1):j.newNoDocument(this.Ji(e.metadata.name),this.Xi(e.metadata.readTime))}Xi(e){return se(e)}}class Pp{constructor(e,t,r){this.Mu=e,this.localStore=t,this.yt=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=ed(e)}Fu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ku.namedQuery)this.queries.push(e.ku.namedQuery);else if(e.ku.documentMetadata){this.documents.push({metadata:e.ku.documentMetadata}),e.ku.documentMetadata.exists||++t;const r=F.fromString(e.ku.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.ku.document&&(this.documents[this.documents.length-1].document=e.ku.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}$u(e){const t=new Map,r=new Jh(this.yt);for(const s of e)if(s.metadata.queries){const i=r.Ji(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||N()).add(i);t.set(o,a)}}return t}complete(){var e=this;return(0,p.Z)(function*(){const t=yield function dp(n,e,t,r){return qo.apply(this,arguments)}(e.localStore,new Jh(e.yt),e.documents,e.Mu.id),r=e.$u(e.documents);for(const s of e.queries)yield fp(e.localStore,s,r.get(s.name));return e.progress.taskState="Success",{progress:e.progress,Bu:e.collectionGroups,Lu:t}})()}}function ed(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class td{constructor(e){this.key=e}}class nd{constructor(e){this.key=e}}class rd{constructor(e,t){this.query=e,this.qu=t,this.Uu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=N(),this.mutatedKeys=N(),this.Gu=yl(e),this.Qu=new En(this.Gu)}get ju(){return this.qu}Wu(e,t){const r=t?t.zu:new Xh,s=t?t.Qu:this.Qu;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const u="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,c="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((l,h)=>{const d=s.get(l),g=go(this.query,h)?h:null,v=!!d&&this.mutatedKeys.has(d.key),x=!!g&&(g.hasLocalMutations||this.mutatedKeys.has(g.key)&&g.hasCommittedMutations);let b=!1;d&&g?d.data.isEqual(g.data)?v!==x&&(r.track({type:3,doc:g}),b=!0):this.Hu(d,g)||(r.track({type:2,doc:g}),b=!0,(u&&this.Gu(g,u)>0||c&&this.Gu(g,c)<0)&&(a=!0)):!d&&g?(r.track({type:0,doc:g}),b=!0):d&&!g&&(r.track({type:1,doc:d}),b=!0,(u||c)&&(a=!0)),b&&(g?(o=o.add(g),i=x?i.add(l):i.delete(l)):(o=o.delete(l),i=i.delete(l)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const l="F"===this.query.limitType?o.last():o.first();o=o.delete(l.key),i=i.delete(l.key),r.track({type:1,doc:l})}return{Qu:o,zu:r,$i:a,mutatedKeys:i}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r){const s=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const i=e.zu.Eu();i.sort((c,l)=>function(h,d){const g=v=>{switch(v){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return E()}};return g(h)-g(d)}(c.type,l.type)||this.Gu(c.doc,l.doc)),this.Ju(r);const o=t?this.Yu():[],a=0===this.Ku.size&&this.current?1:0,u=a!==this.Uu;return this.Uu=a,0!==i.length||u?{snapshot:new Tn(this.query,e.Qu,s,i,e.mutatedKeys,0===a,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),Xu:o}:{Xu:o}}bu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new Xh,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.qu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach(t=>this.qu=this.qu.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.qu=this.qu.delete(t)),this.current=e.current)}Yu(){if(!this.current)return[];const e=this.Ku;this.Ku=N(),this.Qu.forEach(r=>{this.Zu(r.key)&&(this.Ku=this.Ku.add(r.key))});const t=[];return e.forEach(r=>{this.Ku.has(r)||t.push(new nd(r))}),this.Ku.forEach(r=>{e.has(r)||t.push(new td(r))}),t}tc(e){this.qu=e.Hi,this.Ku=N();const t=this.Wu(e.documents);return this.applyChanges(t,!0)}ec(){return Tn.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.Uu,this.hasCachedResults)}}class qp{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Up{constructor(e){this.key=e,this.nc=!1}}class Bp{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.sc={},this.ic=new ct(a=>gl(a),sr),this.rc=new Map,this.oc=new Set,this.uc=new ee(_.comparator),this.cc=new Map,this.ac=new Ro,this.hc={},this.lc=new Map,this.fc=Bt.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return!0===this.dc}}function Gp(n,e){return ya.apply(this,arguments)}function ya(){return ya=(0,p.Z)(function*(n,e){const t=Ua(n);let r,s;const i=t.ic.get(e);if(i)r=i.targetId,t.sharedClientState.addLocalQueryTarget(r),s=i.view.ec();else{const o=yield yn(t.localStore,xe(e));t.isPrimaryClient&&Bs(t.remoteStore,o);const a=t.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,s=yield va(t,e,r,"current"===a,o.resumeToken)}return s}),ya.apply(this,arguments)}function va(n,e,t,r,s){return wa.apply(this,arguments)}function wa(){return wa=(0,p.Z)(function*(n,e,t,r,s){n._c=(h,d,g)=>{return(v=(0,p.Z)(function*(x,b,G,W){let L=b.view.Wu(G);L.$i&&(L=yield Vs(x.localStore,b.query,!1).then(({documents:P})=>b.view.Wu(P,L)));const te=W&&W.targetChanges.get(b.targetId),V=b.view.applyChanges(L,x.isPrimaryClient,te);return Aa(x,b.targetId,V.Xu),V.snapshot}),function(x,b,G,W){return v.apply(this,arguments)})(n,h,d,g);var v};const i=yield Vs(n.localStore,e,!0),o=new rd(e,i.Hi),a=o.Wu(i.documents),u=lr.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,s),c=o.applyChanges(a,n.isPrimaryClient,u);Aa(n,t,c.Xu);const l=new qp(e,t,o);return n.ic.set(e,l),n.rc.has(t)?n.rc.get(t).push(e):n.rc.set(t,[e]),c.snapshot}),wa.apply(this,arguments)}function Kp(n,e){return _a.apply(this,arguments)}function _a(){return _a=(0,p.Z)(function*(n,e){const t=I(n),r=t.ic.get(e),s=t.rc.get(r.targetId);if(s.length>1)return t.rc.set(r.targetId,s.filter(i=>!sr(i,e))),void t.ic.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield vn(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),Tr(t.remoteStore,r.targetId),Sn(t,r.targetId)}).catch(nt))):(Sn(t,r.targetId),yield vn(t.localStore,r.targetId,!0))}),_a.apply(this,arguments)}function Ia(){return Ia=(0,p.Z)(function*(n,e,t){const r=Ba(n);try{const s=yield function(i,o){const a=I(i),u=Z.now(),c=o.reduce((d,g)=>d.add(g.key),N());let l,h;return a.persistence.runTransaction("Locally write mutations","readwrite",d=>{let g=be(),v=N();return a.Gi.getEntries(d,c).next(x=>{g=x,g.forEach((b,G)=>{G.isValidDocument()||(v=v.add(b))})}).next(()=>a.localDocuments.getOverlayedDocuments(d,g)).next(x=>{l=x;const b=[];for(const G of o){const W=Xm(G,l.get(G.key).overlayedDocument);null!=W&&b.push(new Ze(G.key,W,ll(W.value.mapValue),H.exists(!0)))}return a.mutationQueue.addMutationBatch(d,u,b,o)}).next(x=>{h=x;const b=x.applyToLocalDocumentSet(l,v);return a.documentOverlayCache.saveOverlays(d,x.batchId,b)})}).then(()=>({batchId:h.batchId,changes:Ml(l)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(i,o,a){let u=i.hc[i.currentUser.toKey()];u||(u=new ee(A)),u=u.insert(o,a),i.hc[i.currentUser.toKey()]=u}(r,s.batchId,t),yield We(r,s.changes),yield _n(r.remoteStore)}catch(s){const i=xn(s,"Failed to persist write");t.reject(i)}}),Ia.apply(this,arguments)}function sd(n,e){return xa.apply(this,arguments)}function xa(){return xa=(0,p.Z)(function*(n,e){const t=I(n);try{const r=yield lp(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.cc.get(i);o&&(T(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.nc=!0:s.modifiedDocuments.size>0?T(o.nc):s.removedDocuments.size>0&&(T(o.nc),o.nc=!1))}),yield We(t,r,e)}catch(r){yield nt(r)}}),xa.apply(this,arguments)}function id(n,e,t){const r=I(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const s=[];r.ic.forEach((i,o)=>{const a=o.view.bu(e);a.snapshot&&s.push(a.snapshot)}),function(i,o){const a=I(i);a.onlineState=o;let u=!1;a.queries.forEach((c,l)=>{for(const h of l.listeners)h.bu(o)&&(u=!0)}),u&&ga(a)}(r.eventManager,e),s.length&&r.sc.Wo(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function $p(n,e,t){return Ea.apply(this,arguments)}function Ea(){return Ea=(0,p.Z)(function*(n,e,t){const r=I(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.cc.get(e),i=s&&s.key;if(i){let o=new ee(_.comparator);o=o.insert(i,j.newNoDocument(i,C.min()));const a=N().add(i),u=new cr(C.min(),new Map,new B(A),o,a);yield sd(r,u),r.uc=r.uc.remove(i),r.cc.delete(e),Na(r)}else yield vn(r.localStore,e,!1).then(()=>Sn(r,e,t)).catch(nt)}),Ea.apply(this,arguments)}function zp(n,e){return Ta.apply(this,arguments)}function Ta(){return Ta=(0,p.Z)(function*(n,e){const t=I(n),r=e.batch.batchId;try{const s=yield cp(t.localStore,e);Da(t,r,null),Ca(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield We(t,s)}catch(s){yield nt(s)}}),Ta.apply(this,arguments)}function Qp(n,e,t){return Sa.apply(this,arguments)}function Sa(){return Sa=(0,p.Z)(function*(n,e,t){const r=I(n);try{const s=yield function(i,o){const a=I(i);return a.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let c;return a.mutationQueue.lookupMutationBatch(u,o).next(l=>(T(null!==l),c=l.keys(),a.mutationQueue.removeMutationBatch(u,l))).next(()=>a.mutationQueue.performConsistencyCheck(u)).next(()=>a.documentOverlayCache.removeOverlaysForBatchId(u,c,o)).next(()=>a.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,c)).next(()=>a.localDocuments.getDocuments(u,c))})}(r.localStore,e);Da(r,e,t),Ca(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield We(r,s)}catch(s){yield nt(s)}}),Sa.apply(this,arguments)}function ba(){return ba=(0,p.Z)(function*(n,e){const t=I(n);He(t.remoteStore)||w("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(i){const o=I(i);return o.persistence.runTransaction("Get highest unacknowledged batch id","readonly",a=>o.mutationQueue.getHighestUnacknowledgedBatchId(a))}(t.localStore);if(-1===r)return void e.resolve();const s=t.lc.get(r)||[];s.push(e),t.lc.set(r,s)}catch(r){const s=xn(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}),ba.apply(this,arguments)}function Ca(n,e){(n.lc.get(e)||[]).forEach(t=>{t.resolve()}),n.lc.delete(e)}function Da(n,e,t){const r=I(n);let s=r.hc[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.hc[r.currentUser.toKey()]=s}}function Sn(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.rc.get(e))n.ic.delete(r),t&&n.sc.wc(r,t);n.rc.delete(e),n.isPrimaryClient&&n.ac.ls(e).forEach(r=>{n.ac.containsKey(r)||od(n,r)})}function od(n,e){n.oc.delete(e.path.canonicalString());const t=n.uc.get(e);null!==t&&(Tr(n.remoteStore,t),n.uc=n.uc.remove(e),n.cc.delete(t),Na(n))}function Aa(n,e,t){for(const r of t)r instanceof td?(n.ac.addReference(r.key,e),Hp(n,r)):r instanceof nd?(w("SyncEngine","Document no longer in limbo: "+r.key),n.ac.removeReference(r.key,e),n.ac.containsKey(r.key)||od(n,r.key)):E()}function Hp(n,e){const t=e.key,r=t.path.canonicalString();n.uc.get(t)||n.oc.has(r)||(w("SyncEngine","New document in limbo: "+t),n.oc.add(r),Na(n))}function Na(n){for(;n.oc.size>0&&n.uc.size<n.maxConcurrentLimboResolutions;){const e=n.oc.values().next().value;n.oc.delete(e);const t=new _(F.fromString(e)),r=n.fc.next();n.cc.set(r,new Up(t)),n.uc=n.uc.insert(t,r),Bs(n.remoteStore,new lt(xe(an(t.path)),r,2,ke.at))}}function We(n,e,t){return ka.apply(this,arguments)}function ka(){return ka=(0,p.Z)(function*(n,e,t){const r=I(n),s=[],i=[],o=[];var a;r.ic.isEmpty()||(r.ic.forEach((a,u)=>{o.push(r._c(u,e,t).then(c=>{if((c||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,null!=c&&c.fromCache?"not-current":"current"),c){s.push(c);const l=Oo.Ci(u.targetId,c);i.push(l)}}))}),yield Promise.all(o),r.sc.Wo(s),yield(a=(0,p.Z)(function*(u,c){const l=I(u);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>f.forEach(c,d=>f.forEach(d.Si,g=>l.persistence.referenceDelegate.addReference(h,d.targetId,g)).next(()=>f.forEach(d.Di,g=>l.persistence.referenceDelegate.removeReference(h,d.targetId,g)))))}catch(h){if(!rt(h))throw h;w("LocalStore","Failed to update sequence numbers: "+h)}for(const h of c){const d=h.targetId;if(!h.fromCache){const g=l.qi.get(d),x=g.withLastLimboFreeSnapshotVersion(g.snapshotVersion);l.qi=l.qi.insert(d,x)}}}),function(u,c){return a.apply(this,arguments)})(r.localStore,i))}),ka.apply(this,arguments)}function Wp(n,e){return Ra.apply(this,arguments)}function Ra(){return Ra=(0,p.Z)(function*(n,e){const t=I(n);if(!t.currentUser.isEqual(e)){w("SyncEngine","User change. New user:",e.toKey());const r=yield Mh(t.localStore,e);t.currentUser=e,(s=t).lc.forEach(o=>{o.forEach(a=>{a.reject(new y(m.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.lc.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield We(t,r.ji)}var s}),Ra.apply(this,arguments)}function Yp(n,e){const t=I(n),r=t.cc.get(e);if(r&&r.nc)return N().add(r.key);{let s=N();const i=t.rc.get(e);if(!i)return s;for(const o of i){const a=t.ic.get(o);s=s.unionWith(a.view.ju)}return s}}function Xp(n,e){return Fa.apply(this,arguments)}function Fa(){return Fa=(0,p.Z)(function*(n,e){const t=I(n),r=yield Vs(t.localStore,e.query,!0),s=e.view.tc(r);return t.isPrimaryClient&&Aa(t,e.targetId,s.Xu),s}),Fa.apply(this,arguments)}function Jp(n,e){return Ma.apply(this,arguments)}function Ma(){return Ma=(0,p.Z)(function*(n,e){const t=I(n);return Ph(t.localStore,e).then(r=>We(t,r))}),Ma.apply(this,arguments)}function ey(n,e,t,r){return La.apply(this,arguments)}function La(){return La=(0,p.Z)(function*(n,e,t,r){const s=I(n),i=yield function(o,a){const u=I(o),c=I(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",l=>c.Tn(l,a).next(h=>h?u.localDocuments.getDocuments(l,h):f.resolve(null)))}(s.localStore,e);var a;null!==i?("pending"===t?yield _n(s.remoteStore):"acknowledged"===t||"rejected"===t?(Da(s,e,r||null),Ca(s,e),a=e,I(I(s.localStore).mutationQueue).An(a)):E(),yield We(s,i)):w("SyncEngine","Cannot apply mutation batch with id: "+e)}),La.apply(this,arguments)}function Oa(){return Oa=(0,p.Z)(function*(n,e){const t=I(n);if(Ua(t),Ba(t),!0===e&&!0!==t.dc){const r=t.sharedClientState.getAllActiveQueryTargets(),s=yield ad(t,r.toArray());t.dc=!0,yield ua(t.remoteStore,!0);for(const i of s)Bs(t.remoteStore,i)}else if(!1===e&&!1!==t.dc){const r=[];let s=Promise.resolve();t.rc.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(Sn(t,o),vn(t.localStore,o,!0))),Tr(t.remoteStore,o)}),yield s,yield ad(t,r),function(i){const o=I(i);o.cc.forEach((a,u)=>{Tr(o.remoteStore,u)}),o.ac.fs(),o.cc=new Map,o.uc=new ee(_.comparator)}(t),t.dc=!1,yield ua(t.remoteStore,!1)}}),Oa.apply(this,arguments)}function ad(n,e,t){return Va.apply(this,arguments)}function Va(){return Va=(0,p.Z)(function*(n,e,t){const r=I(n),s=[],i=[];for(const o of e){let a;const u=r.rc.get(o);if(u&&0!==u.length){a=yield yn(r.localStore,xe(u[0]));for(const c of u){const l=r.ic.get(c),h=yield Xp(r,l);h.snapshot&&i.push(h.snapshot)}}else{const c=yield Vh(r.localStore,o);a=yield yn(r.localStore,c),yield va(r,ud(c),o,!1,a.resumeToken)}s.push(a)}return r.sc.Wo(i),s}),Va.apply(this,arguments)}function ud(n){return fl(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function ny(n){const e=I(n);return I(I(e.localStore).persistence).vi()}function ry(n,e,t,r){return Pa.apply(this,arguments)}function Pa(){return Pa=(0,p.Z)(function*(n,e,t,r){const s=I(n);if(s.dc)return void w("SyncEngine","Ignoring unexpected query state notification.");const i=s.rc.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=yield Ph(s.localStore,pl(i[0])),a=cr.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,ue.EMPTY_BYTE_STRING);yield We(s,o,a);break}case"rejected":yield vn(s.localStore,e,!0),Sn(s,e,r);break;default:E()}}),Pa.apply(this,arguments)}function sy(n,e,t){return qa.apply(this,arguments)}function qa(){return qa=(0,p.Z)(function*(n,e,t){const r=Ua(n);if(r.dc){for(const s of e){if(r.rc.has(s)){w("SyncEngine","Adding an already active target "+s);continue}const i=yield Vh(r.localStore,s),o=yield yn(r.localStore,i);yield va(r,ud(i),o.targetId,!1,o.resumeToken),Bs(r.remoteStore,o)}for(const s of t)r.rc.has(s)&&(yield vn(r.localStore,s,!1).then(()=>{Tr(r.remoteStore,s),Sn(r,s)}).catch(nt))}}),qa.apply(this,arguments)}function Ua(n){const e=I(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=sd.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Yp.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=$p.bind(null,e),e.sc.Wo=Lp.bind(null,e.eventManager),e.sc.wc=Op.bind(null,e.eventManager),e}function Ba(n){const e=I(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=zp.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Qp.bind(null,e),e}class cd{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,p.Z)(function*(){t.yt=xr(e.databaseInfo.databaseId),t.sharedClientState=t.gc(e),t.persistence=t.yc(e),yield t.persistence.start(),t.localStore=t.Ic(e),t.gcScheduler=t.Tc(e,t.localStore),t.indexBackfillerScheduler=t.Ec(e,t.localStore)})()}Tc(e,t){return null}Ec(e,t){return null}Ic(e){return Fh(this.persistence,new Rh,e.initialUser,this.yt)}yc(e){return new Nh(Ls.Bs,this.yt)}gc(e){return new Gh}terminate(){var e=this;return(0,p.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class ld extends cd{constructor(e,t,r){super(),this.Ac=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,p.Z)(function*(){yield t().call(r,e),yield r.Ac.initialize(r,e),yield Ba(r.Ac.syncEngine),yield _n(r.Ac.remoteStore),yield r.persistence.li(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()))})()}Ic(e){return Fh(this.persistence,new Rh,e.initialUser,this.yt)}Tc(e,t){return new Zg(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Ec(e,t){const r=new Rm(t,this.persistence);return new km(e.asyncQueue,r)}yc(e){const t=Lo(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?Ce.withCacheSize(this.cacheSizeBytes):Ce.DEFAULT;return new Mo(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,jh(),Us(),this.yt,this.sharedClientState,!!this.forceOwnership)}gc(e){return new Gh}}class oy extends ld{constructor(e,t){super(e,t,!1),this.Ac=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,p.Z)(function*(){yield t().call(r,e);const s=r.Ac.syncEngine;r.sharedClientState instanceof jo&&(r.sharedClientState.syncEngine={Fr:ey.bind(null,s),$r:ry.bind(null,s),Br:sy.bind(null,s),vi:ny.bind(null,s),Mr:Jp.bind(null,s)},yield r.sharedClientState.start()),yield r.persistence.li(function(){var i=(0,p.Z)(function*(o){yield function ty(n,e){return Oa.apply(this,arguments)}(r.Ac.syncEngine,o),r.gcScheduler&&(o&&!r.gcScheduler.started?r.gcScheduler.start():o||r.gcScheduler.stop()),r.indexBackfillerScheduler&&(o&&!r.indexBackfillerScheduler.started?r.indexBackfillerScheduler.start():o||r.indexBackfillerScheduler.stop())});return function(o){return i.apply(this,arguments)}}())})()}gc(e){const t=jh();if(!jo.C(t))throw new y(m.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Lo(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new jo(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Ga{initialize(e,t){var r=this;return(0,p.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=s=>id(r.syncEngine,s,1),r.remoteStore.remoteSyncer.handleCredentialChange=Wp.bind(null,r.syncEngine),yield ua(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Mp}createDatastore(e){const t=xr(e.databaseInfo.databaseId),r=new yp(e.databaseInfo);return new _p(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return t=this.localStore,r=this.datastore,s=e.asyncQueue,i=a=>id(this.syncEngine,a,0),o=Kh.C()?new Kh:new mp,new Ep(t,r,s,i,o);var t,r,s,i,o}createSyncEngine(e,t){return function(r,s,i,o,a,u,c){const l=new Bp(r,s,i,o,a,u);return c&&(l.dc=!0),l}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,p.Z)(function*(t){const r=I(t);w("RemoteStore","RemoteStore shutting down."),r._u.add(5),yield wn(r),r.mu.shutdown(),r.gu.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}function Ka(n,e,t){if(!t)throw new y(m.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function hd(n,e,t,r){if(!0===e&&!0===r)throw new y(m.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function dd(n){if(!_.isDocumentKey(n))throw new y(m.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function fd(n){if(_.isDocumentKey(n))throw new y(m.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Ks(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(t=n).constructor?t.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var t;return"function"==typeof n?"a function":E()}function R(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new y(m.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Ks(n);throw new y(m.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function md(n,e){if(e<=0)throw new y(m.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}const gd=new Map;class pd{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new y(m.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new y(m.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,hd("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Sr{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new pd({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new y(m.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new y(m.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new pd(e),void 0!==e.credentials&&(this._authCredentials=function(t){if(!t)return new wm;switch(t.type){case"gapi":return new Em(t.client,t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new y(m.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=gd.get(e);t&&(w("ComponentProvider","Removing Datastore"),gd.delete(e),t.terminate())}(this),Promise.resolve()}}class ${constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Be(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new $(this.firestore,e,this._key)}}class ve{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new ve(this.firestore,e,this._query)}}class Be extends ve{constructor(e,t,r){super(e,t,an(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new $(this.firestore,null,new _(e))}withConverter(e){return new Be(this.firestore,e,this._path)}}function vd(n,e,...t){if(n=(0,K.m9)(n),Ka("collection","path",e),n instanceof Sr){const r=F.fromString(e,...t);return fd(r),new Be(n,null,r)}{if(!(n instanceof $||n instanceof Be))throw new y(m.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(F.fromString(e,...t));return fd(r),new Be(n.firestore,null,r)}}function js(n,e,...t){if(n=(0,K.m9)(n),1===arguments.length&&(e=Lc.R()),Ka("doc","path",e),n instanceof Sr){const r=F.fromString(e,...t);return dd(r),new $(n,null,new _(r))}{if(!(n instanceof $||n instanceof Be))throw new y(m.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(F.fromString(e,...t));return dd(r),new $(n.firestore,n instanceof Be?n.converter:null,new _(r))}}function wd(n,e){return n=(0,K.m9)(n),e=(0,K.m9)(e),(n instanceof $||n instanceof Be)&&(e instanceof $||e instanceof Be)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function ja(n,e){return n=(0,K.m9)(n),e=(0,K.m9)(e),n instanceof ve&&e instanceof ve&&n.firestore===e.firestore&&sr(n._query,e._query)&&n.converter===e.converter}function _d(n,e=10240){let t=0;return{read:()=>(0,p.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,p.Z)(function*(){})(),releaseLock(){},closed:Promise.reject("unimplemented")}}class $s{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):re("Uncaught Error in snapshot listener:",e.toString())}bc(){this.muted=!0}Rc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class uy{constructor(e,t){this.Pc=e,this.yt=t,this.metadata=new ae,this.buffer=new Uint8Array,this.vc=new TextDecoder("utf-8"),this.Vc().then(r=>{r&&r.Ou()?this.metadata.resolve(r.ku.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==r?void 0:r.ku)}`))},r=>this.metadata.reject(r))}close(){return this.Pc.cancel()}getMetadata(){var e=this;return(0,p.Z)(function*(){return e.metadata.promise})()}mc(){var e=this;return(0,p.Z)(function*(){return yield e.getMetadata(),e.Vc()})()}Vc(){var e=this;return(0,p.Z)(function*(){const t=yield e.Sc();if(null===t)return null;const r=e.vc.decode(t),s=Number(r);isNaN(s)&&e.Dc(`length string (${r}) is not valid number`);const i=yield e.Cc(s);return new Vp(JSON.parse(i),t.length+s)})()}xc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}Sc(){var e=this;return(0,p.Z)(function*(){for(;e.xc()<0&&!(yield e.Nc()););if(0===e.buffer.length)return null;const t=e.xc();t<0&&e.Dc("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}Cc(e){var t=this;return(0,p.Z)(function*(){for(;t.buffer.length<e;)(yield t.Nc())&&t.Dc("Reached the end of bundle when more is expected.");const r=t.vc.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}Dc(e){throw this.Pc.cancel(),new Error(`Invalid bundle format: ${e}`)}Nc(){var e=this;return(0,p.Z)(function*(){const t=yield e.Pc.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class hy{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,p.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new y(m.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const r=yield(s=(0,p.Z)(function*(i,o){const a=I(i),u=dr(a.yt)+"/documents",c={documents:o.map(g=>hr(a.yt,g))},l=yield a._o("BatchGetDocuments",u,c,o.length),h=new Map;l.forEach(g=>{const v=function lg(n,e){return"found"in e?function(t,r){T(!!r.found);const s=qe(t,r.found.name),i=se(r.found.updateTime),o=r.found.createTime?se(r.found.createTime):C.min(),a=new ye({mapValue:{fields:r.found.fields}});return j.newFoundDocument(s,i,o,a)}(n,e):"missing"in e?function(t,r){T(!!r.missing),T(!!r.readTime);const s=qe(t,r.missing),i=se(r.readTime);return j.newNoDocument(s,i)}(n,e):E()}(a.yt,g);h.set(v.key.toString(),v)});const d=[];return o.forEach(g=>{const v=h.get(g.toString());T(!!v),d.push(v)}),d}),function(i,o){return s.apply(this,arguments)})(t.datastore,e);var s;return r.forEach(s=>t.recordVersion(s)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new hn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,p.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,s)=>{const i=_.fromPath(s);e.mutations.push(new po(i,e.precondition(i)))}),yield(r=(0,p.Z)(function*(s,i){const o=I(s),a=dr(o.yt)+"/documents",u={writes:i.map(c=>fr(o.yt,c))};yield o.ao("Commit",a,u)}),function(s,i){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw E();t=C.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new y(m.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(C.min())?H.exists(!1):H.updateTime(t):H.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(C.min()))throw new y(m.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return H.updateTime(t)}return H.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class dy{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this.kc=r.maxAttempts,this.xo=new $o(this.asyncQueue,"transaction_retry")}run(){this.kc-=1,this.Oc()}Oc(){var e=this;this.xo.Ro((0,p.Z)(function*(){const t=new hy(e.datastore),r=e.Mc(t);r&&r.then(s=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(s)}).catch(i=>{e.Fc(i)}))}).catch(s=>{e.Fc(s)})}))}Mc(e){try{const t=this.updateFunction(e);return!Yn(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Fc(e){this.kc>0&&this.$c(e)?(this.kc-=1,this.asyncQueue.enqueueAndForget(()=>(this.Oc(),Promise.resolve()))):this.deferred.reject(e)}$c(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!kl(t)}return!1}}class fy{constructor(e,t,r,s){var i=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=he.UNAUTHENTICATED,this.clientId=Lc.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var o=(0,p.Z)(function*(a){w("FirestoreClient","Received user=",a.uid),yield i.authCredentialListener(a),i.user=a});return function(a){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(r,o=>(w("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}getConfiguration(){var e=this;return(0,p.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new y(m.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new ae;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,p.Z)(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const s=xn(r,"Failed to shutdown persistence");t.reject(s)}})),t.promise}}function Id(n,e){return $a.apply(this,arguments)}function $a(){return $a=(0,p.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),w("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var s=(0,p.Z)(function*(i){r.isEqual(i)||(yield Mh(e.localStore,i),r=i)});return function(i){return s.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=e}),$a.apply(this,arguments)}function xd(n,e){return za.apply(this,arguments)}function za(){return za=(0,p.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield Qa(n);w("FirestoreClient","Initializing OnlineComponentProvider");const r=yield n.getConfiguration();yield e.initialize(t,r),n.setCredentialChangeListener(s=>Yh(e.remoteStore,s)),n.setAppCheckTokenChangeListener((s,i)=>Yh(e.remoteStore,i)),n.onlineComponents=e}),za.apply(this,arguments)}function Qa(n){return Za.apply(this,arguments)}function Za(){return Za=(0,p.Z)(function*(n){return n.offlineComponents||(w("FirestoreClient","Using default OfflineComponentProvider"),yield Id(n,new cd)),n.offlineComponents}),Za.apply(this,arguments)}function zs(n){return Ha.apply(this,arguments)}function Ha(){return Ha=(0,p.Z)(function*(n){return n.onlineComponents||(w("FirestoreClient","Using default OnlineComponentProvider"),yield xd(n,new Ga)),n.onlineComponents}),Ha.apply(this,arguments)}function Ed(n){return Qa(n).then(e=>e.persistence)}function Qs(n){return Qa(n).then(e=>e.localStore)}function Wa(n){return zs(n).then(e=>e.remoteStore)}function Ya(n){return zs(n).then(e=>e.syncEngine)}function bn(n){return Xa.apply(this,arguments)}function Xa(){return Xa=(0,p.Z)(function*(n){const e=yield zs(n),t=e.eventManager;return t.onListen=Gp.bind(null,e.syncEngine),t.onUnlisten=Kp.bind(null,e.syncEngine),t}),Xa.apply(this,arguments)}function Sd(n,e,t={}){const r=new ae;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function(s,i,o,a,u){const c=new $s({next:h=>{i.enqueueAndForget(()=>fa(s,l));const d=h.docs.has(o);!d&&h.fromCache?u.reject(new y(m.UNAVAILABLE,"Failed to get document because the client is offline.")):d&&h.fromCache&&a&&"server"===a.source?u.reject(new y(m.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(h)},error:h=>u.reject(h)}),l=new pa(an(o.path),c,{includeMetadataChanges:!0,Nu:!0});return ha(s,l)}(yield bn(n),n.asyncQueue,e,t,r)})),r.promise}function bd(n,e,t={}){const r=new ae;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function(s,i,o,a,u){const c=new $s({next:h=>{i.enqueueAndForget(()=>fa(s,l)),h.fromCache&&"server"===a.source?u.reject(new y(m.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(h)},error:h=>u.reject(h)}),l=new pa(o,c,{includeMetadataChanges:!0,Nu:!0});return ha(s,l)}(yield bn(n),n.asyncQueue,e,t,r)})),r.promise}class Iy{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.qc=!1,this.Uc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new $o(this,"async_queue_retry"),this.Wc=()=>{const t=Us();t&&w("AsyncQueue","Visibility state changed to "+t.visibilityState),this.xo.Po()};const e=Us();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.qc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.qc){this.qc=!0,this.Qc=e||!1;const t=Us();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.qc)return new Promise(()=>{});const t=new ae;return this.Hc(()=>this.qc&&this.Qc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Lc.push(e),this.Jc()))}Jc(){var e=this;return(0,p.Z)(function*(){if(0!==e.Lc.length){try{yield e.Lc[0](),e.Lc.shift(),e.xo.reset()}catch(t){if(!rt(t))throw t;w("AsyncQueue","Operation failed with retryable error: "+t)}e.Lc.length>0&&e.xo.Ro(()=>e.Jc())}})()}Hc(e){const t=this.Bc.then(()=>(this.Gc=!0,e().catch(r=>{throw this.Kc=r,this.Gc=!1,re("INTERNAL UNHANDLED ERROR: ",function(i){let o=i.message||"";return i.stack&&(o=i.stack.includes(i.message)?i.stack:i.message+"\n"+i.stack),o}(r)),r}).then(r=>(this.Gc=!1,r))));return this.Bc=t,t}enqueueAfterDelay(e,t,r){this.zc(),this.jc.indexOf(e)>-1&&(t=0);const s=la.createAndSchedule(this,e,t,r,i=>this.Yc(i));return this.Uc.push(s),s}zc(){this.Kc&&E()}verifyOperationInProgress(){}Xc(){var e=this;return(0,p.Z)(function*(){let t;do{t=e.Bc,yield t}while(t!==e.Bc)})()}Zc(e){for(const t of this.Uc)if(t.timerId===e)return!0;return!1}ta(e){return this.Xc().then(()=>{this.Uc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Uc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Xc()})}ea(e){this.jc.push(e)}Yc(e){const t=this.Uc.indexOf(e);this.Uc.splice(t,1)}}function Ja(n){return function(e,t){if("object"!=typeof e||null===e)return!1;const r=e;for(const s of["next","error","complete"])if(s in r&&"function"==typeof r[s])return!0;return!1}(n)}class xy{constructor(){this._progressObserver={},this._taskCompletionResolver=new ae,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class z extends Sr{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new Iy,this._persistenceKey=(null==s?void 0:s.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Cd(this),this._firestoreClient.terminate()}}function ie(n){return n._firestoreClient||Cd(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function Cd(n){var e;const t=n._freezeSettings(),r=(i=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new Fm(n._databaseId,i,n._persistenceKey,(a=t).host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,a.useFetchStreams));var i,a;n._firestoreClient=new fy(n._authCredentials,n._appCheckCredentials,n._queue,r)}function Dd(n,e,t){const r=new ae;return n.asyncQueue.enqueue((0,p.Z)(function*(){try{yield Id(n,t),yield xd(n,e),r.resolve()}catch(s){const i=s;if(!("FirebaseError"===(o=i).name?o.code===m.FAILED_PRECONDITION||o.code===m.UNIMPLEMENTED:!(typeof DOMException<"u"&&o instanceof DOMException)||22===o.code||20===o.code||11===o.code))throw i;St("Error enabling offline persistence. Falling back to persistence disabled: "+i),r.reject(i)}var o})).then(()=>r.promise)}function Ad(n){if(n._initialized||n._terminated)throw new y(m.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Ge{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ge(ue.fromBase64String(e))}catch(t){throw new y(m.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Ge(ue.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Ye{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new y(m.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new X(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Kt{constructor(e){this._methodName=e}}class Zs{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new y(m.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new y(m.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return A(this._lat,e._lat)||A(this._long,e._long)}}const Ry=/^__.*__$/;class Fy{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new Ze(e,this.data,this.fieldMask,t,this.fieldTransforms):new ln(e,this.data,t,this.fieldTransforms)}}class Nd{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Ze(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function kd(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw E()}}class Hs{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.yt=r,this.ignoreUndefinedProperties=s,void 0===i&&this.na(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new Hs(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.yt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.ia({path:r,oa:!1});return s.ua(e),s}ca(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.ia({path:r,oa:!1});return s.na(),s}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return Xs(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(0===e.length)throw this.ha("Document fields must not be empty");if(kd(this.sa)&&Ry.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class My{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.yt=r||xr(e)}da(e,t,r,s=!1){return new Hs({sa:e,methodName:t,fa:r,path:X.emptyPath(),oa:!1,la:s},this.databaseId,this.yt,this.ignoreUndefinedProperties)}}function jt(n){const e=n._freezeSettings(),t=xr(n._databaseId);return new My(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Ws(n,e,t,r,s,i={}){const o=n.da(i.merge||i.mergeFields?2:0,e,t,s);ru("Data must be an object, but it was:",o,r);const a=Md(r,o);let u,c;if(i.merge)u=new Re(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const l=[];for(const h of i.mergeFields){const d=su(e,h,t);if(!o.contains(d))throw new y(m.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);Od(l,d)||l.push(d)}u=new Re(l),c=o.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,c=o.fieldTransforms;return new Fy(new ye(a),u,c)}class br extends Kt{_toFieldTransform(e){if(2!==e.sa)throw e.ha(1===e.sa?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof br}}function Rd(n,e,t){return new Hs({sa:3,fa:e.settings.fa,methodName:n._methodName,oa:t},e.databaseId,e.yt,e.ignoreUndefinedProperties)}class eu extends Kt{_toFieldTransform(e){return new ir(e.path,new un)}isEqual(e){return e instanceof eu}}class Ly extends Kt{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=Rd(this,e,!0),r=this._a.map(i=>$t(i,t)),s=new Mt(r);return new ir(e.path,s)}isEqual(e){return this===e}}class Oy extends Kt{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=Rd(this,e,!0),r=this._a.map(i=>$t(i,t)),s=new Lt(r);return new ir(e.path,s)}isEqual(e){return this===e}}class Vy extends Kt{constructor(e,t){super(e),this.wa=t}_toFieldTransform(e){const t=new cn(e.yt,_l(e.yt,this.wa));return new ir(e.path,t)}isEqual(e){return this===e}}function tu(n,e,t,r){const s=n.da(1,e,t);ru("Data must be an object, but it was:",s,r);const i=[],o=ye.empty();Dt(r,(u,c)=>{const l=Ys(e,u,t);c=(0,K.m9)(c);const h=s.ca(l);if(c instanceof br)i.push(l);else{const d=$t(c,h);null!=d&&(i.push(l),o.set(l,d))}});const a=new Re(i);return new Nd(o,a,s.fieldTransforms)}function nu(n,e,t,r,s,i){const o=n.da(1,e,t),a=[su(e,r,t)],u=[s];if(i.length%2!=0)throw new y(m.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<i.length;d+=2)a.push(su(e,i[d])),u.push(i[d+1]);const c=[],l=ye.empty();for(let d=a.length-1;d>=0;--d)if(!Od(c,a[d])){const g=a[d];let v=u[d];v=(0,K.m9)(v);const x=o.ca(g);if(v instanceof br)c.push(g);else{const b=$t(v,x);null!=b&&(c.push(g),l.set(g,b))}}const h=new Re(c);return new Nd(l,h,o.fieldTransforms)}function Fd(n,e,t,r=!1){return $t(t,n.da(r?4:3,e))}function $t(n,e){if(Ld(n=(0,K.m9)(n)))return ru("Unsupported field value:",e,n),Md(n,e);if(n instanceof Kt)return function(t,r){if(!kd(r.sa))throw r.ha(`${t._methodName}() can only be used with update() and set()`);if(!r.path)throw r.ha(`${t._methodName}() is not currently supported inside arrays`);const s=t._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.oa&&4!==e.sa)throw e.ha("Nested arrays are not supported");return function(t,r){const s=[];let i=0;for(const o of t){let a=$t(o,r.aa(i));null==a&&(a={nullValue:"NULL_VALUE"}),s.push(a),i++}return{arrayValue:{values:s}}}(n,e)}return function(t,r){if(null===(t=(0,K.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return _l(r.yt,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const s=Z.fromDate(t);return{timestampValue:dn(r.yt,s)}}if(t instanceof Z){const s=new Z(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:dn(r.yt,s)}}if(t instanceof Zs)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Ge)return{bytesValue:Bl(r.yt,t._byteString)};if(t instanceof $){const s=r.databaseId,i=t.firestore._databaseId;if(!i.isEqual(s))throw r.ha(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:yo(t.firestore._databaseId||r.databaseId,t._key.path)}}throw r.ha(`Unsupported field value: ${Ks(t)}`)}(n,e)}function Md(n,e){const t={};return Kc(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Dt(n,(r,s)=>{const i=$t(s,e.ra(r));null!=i&&(t[r]=i)}),{mapValue:{fields:t}}}function Ld(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof Z||n instanceof Zs||n instanceof Ge||n instanceof $||n instanceof Kt)}function ru(n,e,t){if(!Ld(t)||"object"!=typeof(r=t)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r)){const r=Ks(t);throw e.ha("an object"===r?n+" a custom object":n+" "+r)}var r}function su(n,e,t){if((e=(0,K.m9)(e))instanceof Ye)return e._internalPath;if("string"==typeof e)return Ys(n,e);throw Xs("Field path arguments must be of type string or ",n,!1,void 0,t)}const Py=new RegExp("[~\\*/\\[\\]]");function Ys(n,e,t){if(e.search(Py)>=0)throw Xs(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Ye(...e.split("."))._internalPath}catch(r){throw Xs(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Xs(n,e,t,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(i||o)&&(u+=" (found",i&&(u+=` in field ${r}`),o&&(u+=` in document ${s}`),u+=")"),new y(m.INVALID_ARGUMENT,a+n+u)}function Od(n,e){return n.some(t=>t.isEqual(e))}class Cr{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new $(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new qy(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Js("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class qy extends Cr{data(){return super.data()}}function Js(n,e){return"string"==typeof e?Ys(n,e):e instanceof Ye?e._internalPath:e._delegate._internalPath}function Vd(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new y(m.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class iu{}class Dr extends iu{}function gt(n,e,...t){let r=[];e instanceof iu&&r.push(e),r=r.concat(t),function(s){const i=s.filter(a=>a instanceof Cn).length,o=s.filter(a=>a instanceof Ar).length;if(i>1||i>0&&o>0)throw new y(m.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Ar extends Dr{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Ar(e,t,r)}_apply(e){const t=this._parse(e);return Bd(e._query,t),new ve(e.firestore,e.converter,fo(e._query,t))}_parse(e){const t=jt(e.firestore);return function(s,i,o,a,u,c,l){let h;if(u.isKeyField()){if("array-contains"===c||"array-contains-any"===c)throw new y(m.INVALID_ARGUMENT,`Invalid Query. You can't perform '${c}' queries on documentId().`);if("in"===c||"not-in"===c){Ud(l,c);const d=[];for(const g of l)d.push(qd(a,s,g));h={arrayValue:{values:d}}}else h=qd(a,s,l)}else"in"!==c&&"not-in"!==c&&"array-contains-any"!==c||Ud(l,c),h=Fd(o,"where",l,"in"===c||"not-in"===c);return k.create(u,c,h)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class Cn extends iu{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Cn(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return 1===t.length?t[0]:U.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(r,s){let i=r;const o=s.getFlattenedFilters();for(const a of o)Bd(i,a),i=fo(i,a)}(e._query,t),new ve(e.firestore,e.converter,fo(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class ou extends Dr{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new ou(e,t)}_apply(e){const t=function(r,s,i){if(null!==r.startAt)throw new y(m.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==r.endAt)throw new y(m.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const o=new sn(s,i);return function(a,u){if(null===lo(a)){const c=ws(a);null!==c&&Gd(0,c,u.field)}}(r,o),o}(e._query,this._field,this._direction);return new ve(e.firestore,e.converter,function(r,s){const i=r.explicitOrderBy.concat([s]);return new Qe(r.path,r.collectionGroup,i,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}class ei extends Dr{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new ei(e,t,r)}_apply(e){return new ve(e.firestore,e.converter,_s(e._query,this._limit,this._limitType))}}class ti extends Dr{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new ti(e,t,r)}_apply(e){const t=Pd(e,this.type,this._docOrFields,this._inclusive);return new ve(e.firestore,e.converter,(s=t,new Qe((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,s,r.endAt)));var r,s}}class ni extends Dr{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new ni(e,t,r)}_apply(e){const t=Pd(e,this.type,this._docOrFields,this._inclusive);return new ve(e.firestore,e.converter,(s=t,new Qe((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,s)));var r,s}}function Pd(n,e,t,r){if(t[0]=(0,K.m9)(t[0]),t[0]instanceof Cr)return function(s,i,o,a,u){if(!a)throw new y(m.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${o}().`);const c=[];for(const l of Ft(s))if(l.field.isKeyField())c.push(kt(i,a.key));else{const h=a.data.field(l.field);if(io(h))throw new y(m.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+l.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===h){const d=l.field.canonicalString();throw new y(m.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${d}' (used as the orderBy) does not exist.`)}c.push(h)}return new ut(c,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=jt(n.firestore);return function(i,o,a,u,c,l){const h=i.explicitOrderBy;if(c.length>h.length)throw new y(m.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const d=[];for(let g=0;g<c.length;g++){const v=c[g];if(h[g].field.isKeyField()){if("string"!=typeof v)throw new y(m.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof v}`);if(!ho(i)&&-1!==v.indexOf("/"))throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${v}' contains a slash.`);const x=i.path.child(F.fromString(v));if(!_.isDocumentKey(x))throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${x}' is not because it contains an odd number of segments.`);const b=new _(x);d.push(kt(o,b))}else{const x=Fd(a,u,v);d.push(x)}}return new ut(d,l)}(n._query,n.firestore._databaseId,s,e,t,r)}}function qd(n,e,t){if("string"==typeof(t=(0,K.m9)(t))){if(""===t)throw new y(m.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ho(e)&&-1!==t.indexOf("/"))throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(F.fromString(t));if(!_.isDocumentKey(r))throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return kt(n,new _(r))}if(t instanceof $)return kt(n,t._key);throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ks(t)}.`)}function Ud(n,e){if(!Array.isArray(n)||0===n.length)throw new y(m.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(n.length>10)throw new y(m.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function Bd(n,e){if(e.isInequality()){const r=ws(n),s=e.field;if(null!==r&&!r.isEqual(s))throw new y(m.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${s.toString()}'`);const i=lo(n);null!==i&&Gd(0,s,i)}const t=function(r,s){for(const i of r)for(const o of i.getFlattenedFilters())if(s.indexOf(o.op)>=0)return o.op;return null}(n.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new y(m.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function Gd(n,e,t){if(!t.isEqual(e))throw new y(m.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class au{convertValue(e,t="none"){switch(Nt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return J(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(At(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw E()}}convertObject(e,t){const r={};return Dt(e.fields,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertGeoPoint(e){return new Zs(J(e.latitude),J(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=$c(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Jn(e));default:return null}}convertTimestamp(e){const t=it(e);return new Z(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=F.fromString(e);T(Yl(r));const s=new st(r.get(1),r.get(3)),i=new _(r.popFirst(5));return s.isEqual(t)||re(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function ri(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class Zy extends au{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ge(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new $(this.firestore,null,t)}}class zt{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Xe extends Cr{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Nr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Js("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Nr extends Xe{data(e={}){return super.data(e)}}class pt{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new zt(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Nr(this._firestore,this._userDataWriter,r.key,r,new zt(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new y(m.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let i=0;return r._snapshot.docChanges.map(o=>({type:"added",doc:new Nr(r._firestore,r._userDataWriter,o.doc.key,o.doc,new zt(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:i++}))}{let i=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(o=>s||3!==o.type).map(o=>{const a=new Nr(r._firestore,r._userDataWriter,o.doc.key,o.doc,new zt(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);let u=-1,c=-1;return 0!==o.type&&(u=i.indexOf(o.doc.key),i=i.delete(o.doc.key)),1!==o.type&&(i=i.add(o.doc),c=i.indexOf(o.doc.key)),{type:Hy(o.type),doc:a,oldIndex:u,newIndex:c}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Hy(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return E()}}function jd(n,e){return n instanceof Xe&&e instanceof Xe?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof pt&&e instanceof pt&&n._firestore===e._firestore&&ja(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}class yt extends au{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ge(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new $(this.firestore,null,t)}}function $d(n,e,t){n=R(n,$);const r=R(n.firestore,z),s=ri(n.converter,e,t);return Dn(r,[Ws(jt(r),"setDoc",n._key,s,null!==n.converter,t).toMutation(n._key,H.none())])}function zd(n,e,t,...r){n=R(n,$);const s=R(n.firestore,z),i=jt(s);let o;return o="string"==typeof(e=(0,K.m9)(e))||e instanceof Ye?nu(i,"updateDoc",n._key,e,t,r):tu(i,"updateDoc",n._key,e),Dn(s,[o.toMutation(n._key,H.exists(!0))])}function Qd(n,...e){var t,r,s;n=(0,K.m9)(n);let i={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||Ja(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges};if(Ja(e[o])){const h=e[o];e[o]=null===(t=h.next)||void 0===t?void 0:t.bind(h),e[o+1]=null===(r=h.error)||void 0===r?void 0:r.bind(h),e[o+2]=null===(s=h.complete)||void 0===s?void 0:s.bind(h)}let u,c,l;if(n instanceof $)c=R(n.firestore,z),l=an(n._key.path),u={next:h=>{e[o]&&e[o](uu(c,n,h))},error:e[o+1],complete:e[o+2]};else{const h=R(n,ve);c=R(h.firestore,z),l=h._query;const d=new yt(c);u={next:g=>{e[o]&&e[o](new pt(c,d,h,g))},error:e[o+1],complete:e[o+2]},Vd(n._query)}return function(h,d,g,v){const x=new $s(v),b=new pa(d,x,g);return h.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return ha(yield bn(h),b)})),()=>{x.bc(),h.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return fa(yield bn(h),b)}))}}(ie(c),l,a,u)}function Dn(n,e){return function(t,r){const s=new ae;return t.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function jp(n,e,t){return Ia.apply(this,arguments)}(yield Ya(t),r,s)})),s.promise}(ie(n),e)}function uu(n,e,t){const r=t.docs.get(e._key),s=new yt(n);return new Xe(n,s,e._key,r,new zt(t.hasPendingWrites,t.fromCache),e.converter)}const iv={maxAttempts:5};class Zd{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=jt(e)}set(e,t,r){this._verifyNotCommitted();const s=vt(e,this._firestore),i=ri(s.converter,t,r),o=Ws(this._dataReader,"WriteBatch.set",s._key,i,null!==s.converter,r);return this._mutations.push(o.toMutation(s._key,H.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=vt(e,this._firestore);let o;return o="string"==typeof(t=(0,K.m9)(t))||t instanceof Ye?nu(this._dataReader,"WriteBatch.update",i._key,t,r,s):tu(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,H.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=vt(e,this._firestore);return this._mutations=this._mutations.concat(new hn(t._key,H.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new y(m.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function vt(n,e){if((n=(0,K.m9)(n)).firestore!==e)throw new y(m.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class ov extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=jt(e)}get(e){const t=vt(e,this._firestore),r=new Zy(this._firestore);return this._transaction.lookup([t._key]).then(s=>{if(!s||1!==s.length)return E();const i=s[0];if(i.isFoundDocument())return new Cr(this._firestore,r,i.key,i,t.converter);if(i.isNoDocument())return new Cr(this._firestore,r,t._key,null,t.converter);throw E()})}set(e,t,r){const s=vt(e,this._firestore),i=ri(s.converter,t,r),o=Ws(this._dataReader,"Transaction.set",s._key,i,null!==s.converter,r);return this._transaction.set(s._key,o),this}update(e,t,r,...s){const i=vt(e,this._firestore);let o;return o="string"==typeof(t=(0,K.m9)(t))||t instanceof Ye?nu(this._dataReader,"Transaction.update",i._key,t,r,s):tu(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=vt(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=vt(e,this._firestore),r=new yt(this._firestore);return super.get(e).then(s=>new Xe(this._firestore,r,t._key,s._document,new zt(!1,!1),t.converter))}}function cu(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new y("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function Wd(){if(typeof Uint8Array>"u")throw new y("unimplemented","Uint8Arrays are not available in this environment.")}function Yd(){if(!function Mm(){return typeof atob<"u"}())throw new y("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(n,e=!0){en=Vr.SDK_VERSION,(0,Vr._registerComponent)(new pu.wA("firestore",(t,{instanceIdentifier:r,options:s})=>{const i=t.getProvider("app").getImmediate(),o=new z(new Im(t.getProvider("auth-internal")),new Tm(t.getProvider("app-check-internal")),function(a,u){if(!Object.prototype.hasOwnProperty.apply(a.options,["projectId"]))throw new y(m.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new st(a.options.projectId,u)}(i,r),i);return s=Object.assign({useFetchStreams:e},s),o._setSettings(s),o},"PUBLIC").setMultipleInstances(!0)),(0,Vr.registerVersion)(Rc,"3.8.0",n),(0,Vr.registerVersion)(Rc,"3.8.0","esm2017")}();class kr{constructor(e){this._delegate=e}static fromBase64String(e){return Yd(),new kr(Ge.fromBase64String(e))}static fromUint8Array(e){return Wd(),new kr(Ge.fromUint8Array(e))}toBase64(){return Yd(),this._delegate.toBase64()}toUint8Array(){return Wd(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function lu(n){return function gv(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of e)if(r in t&&"function"==typeof t[r])return!0;return!1}(n,["next","error","complete"])}class pv{enableIndexedDbPersistence(e,t){return function Ty(n,e){Ad(n=R(n,z));const t=ie(n),r=n._freezeSettings(),s=new Ga;return Dd(t,s,new ld(s,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function Sy(n){Ad(n=R(n,z));const e=ie(n),t=n._freezeSettings(),r=new Ga;return Dd(e,r,new oy(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function by(n){if(n._initialized&&!n._terminated)throw new y(m.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new ae;return n._queue.enqueueAndForgetEvenWhileRestricted((0,p.Z)(function*(){try{yield(t=(0,p.Z)(function*(r){if(!Le.C())return Promise.resolve();const s=r+"main";yield Le.delete(s)}),function(r){return t.apply(this,arguments)})(Lo(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class Xd{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof st||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&St("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){!function yd(n,e,t,r={}){var s;const i=(n=R(n,Sr))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&St("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},i),{host:`${e}:${t}`,ssl:!1})),r.mockUserToken){let o,a;if("string"==typeof r.mockUserToken)o=r.mockUserToken,a=he.MOCK_USER;else{o=(0,K.Sg)(r.mockUserToken,null===(s=n._app)||void 0===s?void 0:s.options.projectId);const u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new y(m.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new he(u)}n._authCredentials=new _m(new Fc(o,a))}}(this._delegate,e,t,r)}enableNetwork(){return function Dy(n){return function my(n){return n.asyncQueue.enqueue((0,p.Z)(function*(){const e=yield Ed(n),t=yield Wa(n);return e.setNetworkEnabled(!0),function(r){const s=I(r);return s._u.delete(0),Er(s)}(t)}))}(ie(n=R(n,z)))}(this._delegate)}disableNetwork(){return function Ay(n){return function gy(n){return n.asyncQueue.enqueue((0,p.Z)(function*(){const e=yield Ed(n),t=yield Wa(n);return e.setNetworkEnabled(!1),(r=(0,p.Z)(function*(s){const i=I(s);i._u.add(0),yield wn(i),i.gu.set("Offline")}),function(s){return r.apply(this,arguments)})(t);var r}))}(ie(n=R(n,z)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,hd("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function Cy(n){return function(e){const t=new ae;return e.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function Zp(n,e){return ba.apply(this,arguments)}(yield Ya(e),t)})),t.promise}(ie(n=R(n,z)))}(this._delegate)}onSnapshotsInSync(e){return function sv(n,e){return function vy(n,e){const t=new $s(e);return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return r=yield bn(n),s=t,I(r).Ru.add(s),void s.next();var r,s})),()=>{t.bc(),n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return r=yield bn(n),s=t,void I(r).Ru.delete(s);var r,s}))}}(ie(n=R(n,z)),Ja(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new y("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new An(this,vd(this._delegate,e))}catch(t){throw Te(t,"collection()","Firestore.collection()")}}doc(e){try{return new Fe(this,js(this._delegate,e))}catch(t){throw Te(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Se(this,function ay(n,e){if(n=R(n,Sr),Ka("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new y(m.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new ve(n,null,(t=e,new Qe(F.emptyPath(),t)));var t}(this._delegate,e))}catch(t){throw Te(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function av(n,e,t){n=R(n,z);const r=Object.assign(Object.assign({},iv),t);return function(s){if(s.maxAttempts<1)throw new y(m.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,i,o){const a=new ae;return s.asyncQueue.enqueueAndForget((0,p.Z)(function*(){const u=yield function Td(n){return zs(n).then(e=>e.datastore)}(s);new dy(s.asyncQueue,u,o,i,a).run()})),a.promise}(ie(n),s=>e(new ov(n,s)),r)}(this._delegate,t=>e(new Jd(this,t)))}batch(){return ie(this._delegate),new ef(new Zd(this._delegate,e=>Dn(this._delegate,e)))}loadBundle(e){return function Ny(n,e){const t=ie(n=R(n,z)),r=new xy;return function wy(n,e,t,r){const s=function(i,o){let a;return a="string"==typeof i?(new TextEncoder).encode(i):i,u=function(u,c){if(u instanceof Uint8Array)return _d(u,c);if(u instanceof ArrayBuffer)return _d(new Uint8Array(u),c);if(u instanceof ReadableStream)return u.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(a),new uy(u,o);var u}(t,xr(e));n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){!function iy(n,e,t){const r=I(n);var s;(s=(0,p.Z)(function*(i,o,a){try{const u=yield o.getMetadata();if(yield function(d,g){const v=I(d),x=se(g.createTime);return v.persistence.runTransaction("hasNewerBundle","readonly",b=>v.Ns.getBundleMetadata(b,g.id)).then(b=>!!b&&b.createTime.compareTo(x)>=0)}(i.localStore,u))return yield o.close(),a._completeWith({taskState:"Success",documentsLoaded:(d=u).totalDocuments,bytesLoaded:d.totalBytes,totalDocuments:d.totalDocuments,totalBytes:d.totalBytes}),Promise.resolve(new Set);a._updateProgress(ed(u));const c=new Pp(u,i.localStore,o.yt);let l=yield o.mc();for(;l;){const d=yield c.Fu(l);d&&a._updateProgress(d),l=yield o.mc()}const h=yield c.complete();return yield We(i,h.Lu,void 0),yield function(d,g){const v=I(d);return v.persistence.runTransaction("Save bundle","readwrite",x=>v.Ns.saveBundleMetadata(x,g))}(i.localStore,u),a._completeWith(h.progress),Promise.resolve(h.Bu)}catch(u){return St("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u),Promise.resolve(new Set)}var d}),function(i,o,a){return s.apply(this,arguments)})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}(yield Ya(n),s,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function ky(n,e){return function _y(n,e){return n.asyncQueue.enqueue((0,p.Z)(function*(){return function(t,r){const s=I(t);return s.persistence.runTransaction("Get named query","readonly",i=>s.Ns.getNamedQuery(i,r))}(yield Qs(n),e)}))}(ie(n=R(n,z)),e).then(t=>t?new ve(n,null,t.query):null)}(this._delegate,e).then(t=>t?new Se(this,t):null)}}class si extends au{constructor(e){super(),this.firestore=e}convertBytes(e){return new kr(new Ge(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Fe.forKey(t,this.firestore,null)}}class Jd{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new si(e)}get(e){const t=Zt(e);return this._delegate.get(t).then(r=>new Rr(this._firestore,new Xe(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const s=Zt(e);return r?(cu("Transaction.set",r),this._delegate.set(s,t,r)):this._delegate.set(s,t),this}update(e,t,r,...s){const i=Zt(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,r,...s),this}delete(e){const t=Zt(e);return this._delegate.delete(t),this}}class ef{constructor(e){this._delegate=e}set(e,t,r){const s=Zt(e);return r?(cu("WriteBatch.set",r),this._delegate.set(s,t,r)):this._delegate.set(s,t),this}update(e,t,r,...s){const i=Zt(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,r,...s),this}delete(e){const t=Zt(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Qt{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new Nr(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Fr(this._firestore,r),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=Qt.INSTANCES;let s=r.get(e);s||(s=new WeakMap,r.set(e,s));let i=s.get(t);return i||(i=new Qt(e,new si(e),t),s.set(t,i)),i}}Qt.INSTANCES=new WeakMap;class Fe{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new si(e)}static forPath(e,t,r){if(e.length%2!=0)throw new y("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Fe(t,new $(t._delegate,r,new _(e)))}static forKey(e,t,r){return new Fe(t,new $(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new An(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new An(this.firestore,vd(this._delegate,e))}catch(t){throw Te(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,K.m9)(e))instanceof $&&wd(this._delegate,e)}set(e,t){t=cu("DocumentReference.set",t);try{return t?$d(this._delegate,e,t):$d(this._delegate,e)}catch(r){throw Te(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?zd(this._delegate,e):zd(this._delegate,e,t,...r)}catch(s){throw Te(s,"updateDoc()","DocumentReference.update()")}}delete(){return function nv(n){return Dn(R(n.firestore,z),[new hn(n._key,H.none())])}(this._delegate)}onSnapshot(...e){const t=tf(e),r=nf(e,s=>new Rr(this.firestore,new Xe(this.firestore._delegate,this._userDataWriter,s._key,s._document,s.metadata,this._delegate.converter)));return Qd(this._delegate,t,r)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function Yy(n){n=R(n,$);const e=R(n.firestore,z),t=ie(e),r=new yt(e);return function py(n,e){const t=new ae;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return(r=(0,p.Z)(function*(s,i,o){try{const a=yield function(u,c){const l=I(u);return l.persistence.runTransaction("read document","readonly",h=>l.localDocuments.getDocument(h,c))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new y(m.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const u=xn(a,`Failed to get document '${i} from cache`);o.reject(u)}}),function(s,i,o){return r.apply(this,arguments)})(yield Qs(n),e,t);var r})),t.promise}(t,n._key).then(s=>new Xe(e,r,n._key,s,new zt(null!==s&&s.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===(null==e?void 0:e.source)?function Xy(n){n=R(n,$);const e=R(n.firestore,z);return Sd(ie(e),n._key,{source:"server"}).then(t=>uu(e,n,t))}(this._delegate):function Wy(n){n=R(n,$);const e=R(n.firestore,z);return Sd(ie(e),n._key).then(t=>uu(e,n,t))}(this._delegate),t.then(r=>new Rr(this.firestore,new Xe(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new Fe(this.firestore,this._delegate.withConverter(e?Qt.getInstance(this.firestore,e):null))}}function Te(n,e,t){return n.message=n.message.replace(e,t),n}function tf(n){for(const e of n)if("object"==typeof e&&!lu(e))return e;return{}}function nf(n,e){var t,r;let s;return s=lu(n[0])?n[0]:lu(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:i=>{s.next&&s.next(e(i))},error:null===(t=s.error)||void 0===t?void 0:t.bind(s),complete:null===(r=s.complete)||void 0===r?void 0:r.bind(s)}}class Rr{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Fe(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return jd(this._delegate,e._delegate)}}class Fr extends Rr{data(e){const t=this._delegate.data(e);return function vm(n,e){n||E()}(void 0!==t),t}}class Se{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new si(e)}where(e,t,r){try{return new Se(this.firestore,gt(this._delegate,function Uy(n,e,t){const r=e,s=Js("where",n);return Ar._create(s,r,t)}(e,t,r)))}catch(s){throw Te(s,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Se(this.firestore,gt(this._delegate,function By(n,e="asc"){const t=e,r=Js("orderBy",n);return ou._create(r,t)}(e,t)))}catch(r){throw Te(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Se(this.firestore,gt(this._delegate,function Gy(n){return md("limit",n),ei._create("limit",n,"F")}(e)))}catch(t){throw Te(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Se(this.firestore,gt(this._delegate,function Ky(n){return md("limitToLast",n),ei._create("limitToLast",n,"L")}(e)))}catch(t){throw Te(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Se(this.firestore,gt(this._delegate,function jy(...n){return ti._create("startAt",n,!0)}(...e)))}catch(t){throw Te(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Se(this.firestore,gt(this._delegate,function $y(...n){return ti._create("startAfter",n,!1)}(...e)))}catch(t){throw Te(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Se(this.firestore,gt(this._delegate,function zy(...n){return ni._create("endBefore",n,!1)}(...e)))}catch(t){throw Te(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Se(this.firestore,gt(this._delegate,function Qy(...n){return ni._create("endAt",n,!0)}(...e)))}catch(t){throw Te(t,"endAt()","Query.endAt()")}}isEqual(e){return ja(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function ev(n){n=R(n,ve);const e=R(n.firestore,z),t=ie(e),r=new yt(e);return function yy(n,e){const t=new ae;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return(r=(0,p.Z)(function*(s,i,o){try{const a=yield Vs(s,i,!0),u=new rd(i,a.Hi),c=u.Wu(a.documents),l=u.applyChanges(c,!1);o.resolve(l.snapshot)}catch(a){const u=xn(a,`Failed to execute query '${i} against cache`);o.reject(u)}}),function(s,i,o){return r.apply(this,arguments)})(yield Qs(n),e,t);var r})),t.promise}(t,n._query).then(s=>new pt(e,r,n,s))}(this._delegate):"server"===(null==e?void 0:e.source)?function tv(n){n=R(n,ve);const e=R(n.firestore,z),t=ie(e),r=new yt(e);return bd(t,n._query,{source:"server"}).then(s=>new pt(e,r,n,s))}(this._delegate):function Jy(n){n=R(n,ve);const e=R(n.firestore,z),t=ie(e),r=new yt(e);return Vd(n._query),bd(t,n._query).then(s=>new pt(e,r,n,s))}(this._delegate),t.then(r=>new hu(this.firestore,new pt(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=tf(e),r=nf(e,s=>new hu(this.firestore,new pt(this.firestore._delegate,this._userDataWriter,this._delegate,s._snapshot)));return Qd(this._delegate,t,r)}withConverter(e){return new Se(this.firestore,this._delegate.withConverter(e?Qt.getInstance(this.firestore,e):null))}}class vv{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Fr(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class hu{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Se(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Fr(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new vv(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Fr(this._firestore,r))})}isEqual(e){return jd(this._delegate,e._delegate)}}class An extends Se{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Fe(this.firestore,e):null}doc(e){try{return new Fe(this.firestore,void 0===e?js(this._delegate):js(this._delegate,e))}catch(t){throw Te(t,"doc()","CollectionReference.doc()")}}add(e){return function rv(n,e){const t=R(n.firestore,z),r=js(n),s=ri(n.converter,e);return Dn(t,[Ws(jt(n.firestore),"addDoc",r._key,s,null!==n.converter,{}).toMutation(r._key,H.exists(!1))]).then(()=>r)}(this._delegate,e).then(t=>new Fe(this.firestore,t))}isEqual(e){return wd(this._delegate,e._delegate)}withConverter(e){return new An(this.firestore,this._delegate.withConverter(e?Qt.getInstance(this.firestore,e):null))}}function Zt(n){return R(n,$)}class du{constructor(...e){this._delegate=new Ye(...e)}static documentId(){return new du(X.keyField().canonicalString())}isEqual(e){return(e=(0,K.m9)(e))instanceof Ye&&this._delegate._internalPath.isEqual(e._internalPath)}}class Ht{constructor(e){this._delegate=e}static serverTimestamp(){const e=function cv(){return new eu("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new Ht(e)}static delete(){const e=function uv(){return new br("deleteField")}();return e._methodName="FieldValue.delete",new Ht(e)}static arrayUnion(...e){const t=function lv(...n){return new Ly("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new Ht(t)}static arrayRemove(...e){const t=function hv(...n){return new Oy("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new Ht(t)}static increment(e){const t=function dv(n){return new Vy("increment",n)}(e);return t._methodName="FieldValue.increment",new Ht(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const wv={Firestore:Xd,GeoPoint:Zs,Timestamp:Z,Blob:kr,Transaction:Jd,WriteBatch:ef,DocumentReference:Fe,DocumentSnapshot:Rr,Query:Se,QueryDocumentSnapshot:Fr,QuerySnapshot:hu,CollectionReference:An,FieldPath:du,FieldValue:Ht,setLogLevel:function yv(n){!function ym(n){tt.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};!function Iv(n){(function _v(n,e){n.INTERNAL.registerComponent(new pu.wA("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),s=t.getProvider("firestore").getImmediate();return e(r,s)},"PUBLIC").setServiceProps(Object.assign({},wv)))})(n,(e,t)=>new Xd(e,t,new pv)),n.registerVersion("@firebase/firestore-compat","0.3.0")}(mf.Z);var wt=O(3385),xv=O(6217);function rf(n,e){return function Ev(n,e=ui.z){return new ci.y(t=>{let r;return null!=e?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{null!=r&&r()}})}(n,e)}function fu(n,e){return rf(n,e).pipe((0,De.U)(t=>({payload:t,type:"query"})))}function ii(n,e){return fu(n,e).pipe((0,Ke.O)(void 0),hi(),(0,De.U)(([t,r])=>{const s=r.payload.docChanges(),i=s.map(o=>({type:o.type,payload:o}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(r.payload.metadata)&&r.payload.docs.forEach((o,a)=>{const u=s.find(l=>l.doc.ref.isEqual(o.ref)),c=null==t?void 0:t.payload.docs.find(l=>l.ref.isEqual(o.ref));u&&JSON.stringify(u.doc.metadata)===JSON.stringify(o.metadata)||!u&&c&&JSON.stringify(c.metadata)===JSON.stringify(o.metadata)||i.push({type:"modified",payload:{oldIndex:a,newIndex:a,type:"modified",doc:o}})}),i}))}function sf(n,e,t){return ii(n,t).pipe((0,di.R)((r,s)=>function Sv(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=function bv(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return mu(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return mu(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return mu(n,e.oldIndex,1)}return n}(n,r))}),n}(r,s.map(i=>i.payload),e),[]),(0,df.x)(),(0,De.U)(r=>r.map(s=>({type:s.type,payload:s}))))}function mu(n,e,t,...r){const s=n.slice();return s.splice(e,t,...r),s}function of(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}O(9260);class af{constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=ii(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,De.U)(r=>r.filter(s=>e.indexOf(s.type)>-1)))),t.pipe((0,Ke.O)(void 0),hi(),(0,gu.h)(([r,s])=>s.length>0||!r),(0,De.U)(([r,s])=>s),ne.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,di.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=of(e);return sf(this.query,t,this.afs.schedulers.outsideAngular).pipe(ne.iC)}valueChanges(e={}){return fu(this.query,this.afs.schedulers.outsideAngular).pipe((0,De.U)(t=>t.payload.docs.map(r=>e.idField?Object.assign(Object.assign({},r.data()),{[e.idField]:r.id}):r.data())),ne.iC)}get(e){return(0,Me.D)(this.query.get(e)).pipe(ne.iC)}add(e){return this.ref.add(e)}doc(e){return new uf(this.ref.doc(e),this.afs)}}class uf{constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const r=this.ref.collection(e),{ref:s,query:i}=cf(r,t);return new af(s,i,this.afs)}snapshotChanges(){return function Tv(n,e){return rf(n,e).pipe((0,Ke.O)(void 0),hi(),(0,De.U)(([t,r])=>r.exists?null!=t&&t.exists?{payload:r,type:"modified"}:{payload:r,type:"added"}:{payload:r,type:"removed"}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(ne.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,De.U)(({payload:t})=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return(0,Me.D)(this.ref.get(e)).pipe(ne.iC)}}class Cv{constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?ii(this.query,this.afs.schedulers.outsideAngular).pipe((0,De.U)(t=>t.filter(r=>e.indexOf(r.type)>-1)),(0,gu.h)(t=>t.length>0),ne.iC):ii(this.query,this.afs.schedulers.outsideAngular).pipe(ne.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,di.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=of(e);return sf(this.query,t,this.afs.schedulers.outsideAngular).pipe(ne.iC)}valueChanges(e={}){return fu(this.query,this.afs.schedulers.outsideAngular).pipe((0,De.U)(r=>r.payload.docs.map(s=>e.idField?Object.assign({[e.idField]:s.id},s.data()):s.data())),ne.iC)}get(e){return(0,Me.D)(this.query.get(e)).pipe(ne.iC)}}const Dv=new q.OlP("angularfire2.enableFirestorePersistence"),Av=new q.OlP("angularfire2.firestore.persistenceSettings"),Nv=new q.OlP("angularfire2.firestore.settings"),kv=new q.OlP("angularfire2.firestore.use-emulator");function cf(n,e=(t=>t)){return{query:e(n),ref:n}}let Rv=(()=>{class n{constructor(t,r,s,i,o,a,u,c,l,h,d,g,v,x,b,G,W){this.schedulers=u;const L=(0,Or.on)(t,a,r),te=l;h&&(0,wt.nw)(L,a,d,v,x,b,g,G),[this.firestore,this.persistenceEnabled$]=(0,Or.cc)(`${L.name}.firestore`,"AngularFirestore",L.name,()=>{const V=a.runOutsideAngular(()=>L.firestore());if(i&&V.settings(i),te&&V.useEmulator(...te),s&&!(0,ff.PM)(o)){const P=()=>{try{return(0,Me.D)(V.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(ce){return typeof console<"u"&&console.warn(ce),(0,Lr.of)(!1)}};return[V,a.runOutsideAngular(P)]}return[V,(0,Lr.of)(!1)]},[i,te,s])}collection(t,r){let s;s="string"==typeof t?this.firestore.collection(t):t;const{ref:i,query:o}=cf(s,r),a=this.schedulers.ngZone.run(()=>i);return new af(a,o,this)}collectionGroup(t,r){const s=r||(o=>o),i=this.firestore.collectionGroup(t);return new Cv(s(i),this)}doc(t){let r;r="string"==typeof t?this.firestore.doc(t):t;const s=this.schedulers.ngZone.run(()=>r);return new uf(s,this)}createId(){return this.firestore.collection("_").doc().id}}return n.\u0275fac=function(t){return new(t||n)(q.LFG(Or.Dh),q.LFG(Or.xv,8),q.LFG(Dv,8),q.LFG(Nv,8),q.LFG(q.Lbi),q.LFG(q.R0b),q.LFG(ne.HU),q.LFG(Av,8),q.LFG(kv,8),q.LFG(wt.zQ,8),q.LFG(wt.Qv,8),q.LFG(wt.L6,8),q.LFG(wt._Q,8),q.LFG(wt.rT,8),q.LFG(wt.lh,8),q.LFG(wt.f7,8),q.LFG(xv.nm,8))},n.\u0275prov=q.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})(),Fv=(()=>{class n{constructor(t,r){this.authService=t,this.firestore=r,this.habitaciones=[1,2,3,4,5,6,7,8,9,10],this.precioHabitaciones=[2300,1200,1500,3100,4e3,2500,1300,1300,1300,2e3],this.claveHabitaciones=[125478,365214,364128,259436,256478,125946,231524,154758,456325,121236],this.huespedes=[{token:"9895257528",nombre:"Bradley Addiel Gonz\xe1lez Flores",telefono:"3222131135",fecha_ingreso:"2022-11-20",fecha_salida:"2022-11-24",habitacion:1,anticipo:600},{token:"1245257528",nombre:"Pedro Avila",telefono:"3111950830",fecha_ingreso:"2022-11-25",fecha_salida:"2022-11-28",habitacion:3,anticipo:300}]}getHuespedes(){return this.firestore.collection("huespedes").snapshotChanges().pipe((0,De.U)(t=>t.map(r=>{const s=r.payload.doc.data();return Object.assign({id:r.payload.doc.id},s)})))}nuevoHuesped(t){this.firestore.collection("huespedes").add(t)}getHabitaciones(){return this.habitaciones}getHuespedId(t){return this.firestore.collection("huespedes").doc(t).valueChanges()}crearToken(){let t=!1;const r=Math.floor(9e9*Math.random())+1e9+"";return this.huespedes.map(s=>{s.token===r&&(t=!0,this.crearToken())}),r}borrarHuesped(t){this.firestore.collection("huespedes").doc(t).delete()}getHuespedToken(t){let r;return r=this.huespedes.find(s=>s.id===t),r}validarFecha(t,r){return!(t>r)}validRoomHuesped(t,r){const s=[];this.huespedes.forEach((i,o)=>{r===i.habitacion&&s.push(o)});for(let i=0;i<s.length;i++){const o=this.huespedes[s[i]];if(o.fecha_ingreso<=t&&o.fecha_salida>=t)return!1}return!0}getPrecioHabitaciones(){return this.precioHabitaciones}getPrecioHabitacion(t){let r;return r=this.huespedes.find(s=>s.token===t),this.precioHabitaciones[+r.habitacion-1]}getClaveHabitaciones(){return this.claveHabitaciones}getClaveHabitacion(t){let r;return r=this.huespedes.find(s=>s.token===t),this.claveHabitaciones[+r.habitacion-1]}}return n.\u0275fac=function(t){return new(t||n)(q.LFG(ai.$),q.LFG(Rv))},n.\u0275prov=q.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})()}}]);